!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/forms"),require("@angular/router"),require("inet-core"),require("moment"),require("ngx-bootstrap"),require("@fullcalendar/core"),require("@fullcalendar/daygrid"),require("@fullcalendar/timegrid"),require("@fullcalendar/interaction"),require("rxjs/operators"),require("rxjs"),require("@angular/common/http"),require("@angular/common")):"function"==typeof define&&define.amd?define("inet-calendar",["exports","@angular/core","@angular/forms","@angular/router","inet-core","moment","ngx-bootstrap","@fullcalendar/core","@fullcalendar/daygrid","@fullcalendar/timegrid","@fullcalendar/interaction","rxjs/operators","rxjs","@angular/common/http","@angular/common"],t):t((e=e||self)["inet-calendar"]={},e.ng.core,e.ng.forms,e.ng.router,e.inetCore,e.moment_,e.ngxBootstrap,e.core$1,e.dayGridPlugin,e.timeGridPlugin,e.interactionPlugin,e.rxjs.operators,e.rxjs,e.ng.common.http,e.ng.common)}(this,(function(e,t,n,i,r,a,o,s,l,d,c,u,p,h,f){"use strict";l=l&&l.hasOwnProperty("default")?l.default:l,d=d&&d.hasOwnProperty("default")?d.default:d,c=c&&c.hasOwnProperty("default")?c.default:c;var g=["à","á","ạ","ả","ã","â","ầ","ấ","ậ","ẩ","ẫ","ă","ằ","ắ","ặ","ẳ","ẵ","è","é","ẹ","ẻ","ẽ","ê","ề","ế","ệ","ể","ễ","ì","í","ị","ỉ","ĩ","ò","ó","ọ","ỏ","õ","ô","ồ","ố","ộ","ổ","ỗ","ơ","ờ","ớ","ợ","ở","ỡ","ù","ú","ụ","ủ","ũ","ư","ừ","ứ","ự","ử","ữ","ỳ","ý","ỵ","ỷ","ỹ","đ","À","Á","Ạ","Ả","Ã","Â","Ầ","Ấ","Ậ","Ẩ","Ẫ","Ă","Ằ","Ắ","Ặ","Ẳ","Ẵ","È","É","Ẹ","Ẻ","Ẽ","Ê","Ề","Ế","Ệ","Ể","Ễ","Ì","Í","Ị","Ỉ","Ĩ","Ò","Ó","Ọ","Ỏ","Õ","Ô","Ồ","Ố","Ộ","Ổ","Ỗ","Ơ","Ờ","Ớ","Ợ","Ở","Ỡ","Ù","Ú","Ụ","Ủ","Ũ","Ư","Ừ","Ứ","Ự","Ử","Ữ","Ỳ","Ý","Ỵ","Ỷ","Ỹ","Đ"],v=["a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","e","e","e","e","e","e","e","e","e","e","e","i","i","i","i","i","o","o","o","o","o","o","o","o","o","o","o","o","o","o","o","o","o","u","u","u","u","u","u","u","u","u","u","u","y","y","y","y","y","d","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","E","E","E","E","E","E","E","E","E","E","E","I","I","I","I","I","O","O","O","O","O","O","O","O","O","O","O","O","O","O","O","O","O","U","U","U","U","U","U","U","U","U","U","U","Y","Y","Y","Y","Y","D"],m=function(e){return e.replace(/[^\u0000-\u007E]/g,(function(e){var t=g.indexOf(e);return t<0?e:v[t]}))},y={firstDay:1,getWeekRange:function(e,t){var n=this.getDateStartWeek(e,t),i=new Date(n);return i.setDate(i.getDate()+6),{startWeek:n,endWeek:i}},getDayIndexOnWeek:function(e,t){return(void 0===t||t<0)&&(t=this.firstDay),e.getDay()<t?7-e.getDay()-t:e.getDay()-t},getDateStartWeek:function(e,t){var n=this.getDayIndexOnWeek(e,t);return(e=new Date(e.getFullYear(),e.getMonth(),e.getDate())).setDate(e.getDate()-n),e},getDateEndWeek:function(e,t){var n=this.getDateStartWeek(e,t);return n.setDate(n.getDate()+6),n},dayOfYear:function(e){var t=new Date(e.getFullYear(),0,1);return t.setTime(t.getTime()-1),Math.ceil((e.getTime()-t.getTime())/864e5)},getWeek:function(e,t){new Date(e.getFullYear(),0,1);var n=this.getDateStartWeek(e,t),i=this.dayOfYear(n);return Math.ceil(i/7)},getDateFromWeek:function(e,t){return new Date(t,0,1+7*(e-1))},dateIsToday:function(e){var t=new Date,n=new Date(e);return t.setHours(0,0,0,0),n.setHours(0,0,0,0),t.getTime()===n.getTime()},weekIsToday:function(e){return this.getWeek(e)===this.getWeek(new Date)},isSameWeek:function(e,t){return this.getWeek(e)===this.getWeek(t)}},E={getUrl:function(e,t,n){if(e.indexOf("://")>-1)return e;if(e=(t=t||iNet.getUrl("{0}")).replace("{0}",e),n){var i=e.split("/");i[4]=n,e=i.join("/")}return e},getPUrl:function(e,t,n){return this.getUrl(e,t,n||iNet.firmPrefix)},sendRequest:function(e){return $.ajax(e)},postForm:function(e){if((e=$.extend({},e,{type:"post",cache:!1,contentType:!1,processData:!1})).data&&e.data.toString().indexOf("FormData")<0){var t=new FormData;for(var n in e.data)t.append(n,e.data[n]);e.data=t}return this.sendRequest(e)}};window.eNet&&(E.sendRequest=window.eNet.ajaxSecure);var _={ALIAS:"alias",ORGAN:"org",USER:"user"},b=[{name:"DATE_TIME_FORMAT",value:"DD/MM/YYYY HH:mm",description:"Định dạng hiển thị ngày và thời gian"},{name:"DATE_FORMAT",value:"DD/MM/YYYY",description:"Định dạng hiển thị ngày"},{name:"TIME_FORMAT",value:"HH:mm",description:"Định dạng hiển thị thời gian"},{name:"TIME_NEW_UPDATE",value:"12",description:"Thời gian hiển thị lịch mới cập nhật: giờ"},{name:"NOTE_LAST_UPDATE",value:!0,description:"Hiển thị thời gian sửa đổi cuối cùng: true | false"},{name:"EVENT_BETWEEN_UNIT",value:!0,description:"Lịch giữa các đơn vị: true | false"},{name:"PUBLISH_VIEW",value:"date",description:"[Trang ban hành] Chế độ hiển thị mặc định: week | date"},{name:"TV_VIEW",value:"date",description:"[Trang tivi] Chế độ hiển thị: week | date"},{name:"TV_TRANS_VELOCITY",value:"30",description:"[Trang tivi] Tốc độ chạy của lịch trên mỗi pixcel - millisecond"},{name:"EMBED_VIEW",value:"date",description:"[Trang nhúng] Chế độ hiển thị mặc định: week | date"},{name:"EMBED_VIEW_PAST",value:!0,description:"[Trang nhúng] Hiển thị những lịch đã diễn ra: true | false"},{name:"PERSON_VIEW",value:"listWeek",description:"[Trang lịch] Chế độ hiển thị mặc định: agendaWeek | agendaDay | listWeek"},{name:"PERSON_CREATE_TYPE",value:"COMMUNITY",description:"[Trang lịch] Loại lịch mặc định khi tạo: COMMUNITY (cộng đồng) | ORGANIZATION (nội bộ)"},{name:"INVITATION_SUPPORT",value:!0,description:"Hỗ trợ thư mời hợp"},{name:"DEPARTMENT_VIEW_OTHER",value:!0,description:"Xem lịch của phòng ban khác: true"},{name:"DEPARTMENT_APPROVE_OTHER",value:!1,description:"Duyệt lịch của phòng ban khác: false"},{name:"CAR_TYPE_CREATE",value:"COMMUNITY",description:"Loại lịch mặc định khi tạo lịch xe: COMMUNITY | ORGANIZATION"},{name:"CALENDAR_INCLUDE_CAR",value:"false",description:"Hiển thị lịch bao gồm lich xe"},{name:"EDIT_EVENT_PAST",value:!1,description:"Cho phép cập nhật nội dung lịch đã diễn ra: false"},{name:"PERSONAL_CAN_PUBLISH",value:!1,description:"[Lịch cá nhân] Cho phép ban hành: false"},{name:"PEOPLE_EVENT_ENABLE",value:!1,description:"Cho phép tạo lịch tiếp dân"},{name:"PERSONAL_EVENT_ENABLE",value:!1,description:"Cho phép tạo lịch cá nhân"},{name:"CAR_EVENT_ENABLE",value:!1,description:"Cho phép tạo lịch xe"},{name:"ATTENDEE_DISPLAY_MAX_LENGTH",value:"0",description:"Độ dài hiển thị tối đa của thành phần"},{name:"VIEW_BY_LEADER",value:!0,description:"Xem lịch theo danh sách lãnh đạo"},{name:"MOBILE_VIEW_BY_LEADER",value:!1,description:"[Mobile] Mặc định xem lịch theo danh sách lãnh đạo"},{name:"MOBILE_VIEW_BY_LEADER_ENABLE",value:!1,description:"[Mobile] Xem lịch theo danh sách lãnh đạo"},{name:"PUBLISH_EVENT_AFTER_CREATE",value:!1,description:"Ban hành lịch sau khi tạo"},{name:"CHECK_DUPLICATE_BEFORE_PUBLISH",value:!1,description:"Kiểm tra lịch trùng trước khi ban hành"},{name:"SUBJECT_DISPLAY_MAX_LENGTH",value:"0",description:"Độ dài hiển thị tối đa của nội dung lịch"},{name:"PREFIX_ATTENDEE_NAME",value:"",description:"Tiền tố hiển thị trước tên người dùng khi tạo lịch"},{name:"WORK_TIME_START",value:"7:00",description:"Thời gian bắt đầu làm việc"},{name:"WORK_TIME_END",value:"17:00",description:"Thời gian kết thúc làm việc"},{name:"NOTIFY_TO_ATTENDEE_ENABLE",value:"false",description:"Cho phép người duyệt lịch gửi thông báo nhắc nhở cho người nhận"}];var w={COMMUNITY:"COMMUNITY",ORGANIZATION:"ORGANIZATION",DEPARTMENT:"DEPARTMENT"},x={IMPORTANT:"IMPORTANT",CAR:"CAR",INVITATION:"INVITATION",PERSONAL:"PERSONAL"},D={PERSONAL:"fa fa-user",IMPORTANT:"fa fa-star",CAR:"fa fa-car",INVITATION:"fa fa-envelope"},T={PREPARER:"PREPARER",OBSERVER:"OBSERVER",CHAIRMAN:"CHAIRMAN",MEMBER:"MEMBER",CREATOR:"CREATOR"},I={MEET_PEOPLE:"COMMUNITY;MEET_PEOPLE",PERSONAL:"ORGANIZATION;PERSONAL"},O={CREATE:0,PUBLISH:1,SENT:2,CANCEL:3,VERIFY:4,OTHER:5};O[O.CREATE]="CREATE",O[O.PUBLISH]="PUBLISH",O[O.SENT]="SENT",O[O.CANCEL]="CANCEL",O[O.VERIFY]="VERIFY",O[O.OTHER]="OTHER";var R=function(){function e(e){this.carDefault={name:"Mặc định",uuid:""},this.carRef="CAL_BUILDER_CAR",this.driverRef="CAL_BUILDER_DRIVER",this.subFirmDict=e}return e.prototype.loadCars=function(e){this._loadList(this.carRef,e)},e.prototype.createOrUpdateCars=function(e,t){var n=this;e.uuid?this.subFirmDict.update(e,(function(e){return n.parseJsonValue(e,t)})):(e.name=this.carRef,e.reference=this.carRef,this.subFirmDict.create(e,(function(e){return n.parseJsonValue(e,t)})))},e.prototype.loadDrivers=function(e){this._loadList(this.driverRef,e)},e.prototype.createOrUpdateDrivers=function(e,t){var n=this;e.uuid?this.subFirmDict.update(e,(function(e){return n.parseJsonValue(e,t)})):(e.name=this.driverRef,e.reference=this.driverRef,this.subFirmDict.create(e,(function(e){return n.parseJsonValue(e,t)})))},e.prototype._loadList=function(e,t){var n=this;this.subFirmDict.list(e,(function(e){return n.parseJsonValue(e[0],t)}))},e.prototype.parseJsonValue=function(e,t){var n=[];try{n=JSON.parse(e.value)}catch(e){}t(n,e)},e}();var C=function(){function e(){}return e.prototype.create=function(e,t){$.ajax({type:"post",url:this.getUrl("subfirm/dictionary/create"),data:e,success:function(e){return t(e)},error:function(){return t(null)}})},e.prototype.update=function(e,t){e.dictID=e.dictID||e.uuid,$.ajax({type:"post",url:this.getUrl("subfirm/dictionary/update"),data:e,success:function(e){return t(e)},error:function(){return t(null)}})},e.prototype.remove=function(e,t){e.dictID=e.dictID||e.uuid,$.ajax({url:this.getUrl("subfirm/dictionary/remove"),data:e,success:function(e){return t(e)},error:function(){return t(null)}})},e.prototype.list=function(e,t){$.ajax({url:this.getUrl("subfirm/dictionary/list"),data:{reference:e},success:function(e){return t(e&&e.items||[])},error:function(){return t([])}})},e.prototype.getUrl=function(e){return iNet.getPUrl(e)},e}();var k={NEEDS_ACTION:"NEEDS_ACTION",ACCEPTED:"ACCEPTED",DECLINED:"DECLINED",TENTATIVE:"TENTATIVE",DELEGATED:"DELEGATED",COMPLETED:"COMPLETED",IN_PROCESS:"IN_PROCESS",NONE:"NONE",OTHERS:"OTHERS"},M=a;window.moment=M;var A=function(){function e(){var e=this;this.TIME_NEW_UPDATE=12,this.roleUrl="xschedule/page/role",this.MODE=O,this.ROLE=T,this.calSubType=I,this.calCategory=x,this.vnToLatin=m,this.dateUtils=y,this.calAttendeeType=_,this.calAttendeeState=k,this.calType=w,this.subFirmDic=new C,this.carUtils=new R(this.subFirmDic),this.configs=b,this.resources={days:["Chủ nhật","Thứ hai","Thứ ba","Thứ tư","Thứ năm","Thứ sáu","Thứ bảy"],statuses:["Mới tạo","Ban hành","Chờ duyệt","Đã hủy","Thông qua","Lịch đơn vị khác"],allDay:"Cả ngày",hour:"giờ",minute:"phút"},this._userRoles={},this._mapEvents={},this._queue={},this._organs=[],this._myOrgans=[],this.typeIsDepartment=function(e){return e===w.DEPARTMENT},this.typeIsCommunity=function(e){return e===w.COMMUNITY},this.typeIsOrganization=function(e){return e===w.ORGANIZATION},this.catIsInvitation=function(e){return x.INVITATION===e},this.catIsPersonal=function(e){return x.PERSONAL===e},this.catIsCar=function(e){return x.CAR===e},this.catIsImportant=function(e){return x.IMPORTANT===e},this.formatDateStr=function(t){return e.formatDate(t,e.getConfigValue("DATE_FORMAT"))},this.formatTimeStr=function(t){return e.formatDate(t,e.getConfigValue("TIME_FORMAT"))},this.formatDateTimeStr=function(t){return e.formatDate(t,e.getConfigValue("DATE_TIME_FORMAT"))},this.formatDate=function(e,t){return M(e).format(t)},this.getEventStatus=function(t){return e.resources.statuses[t]},this.isCreate=function(e){return e===O.CREATE},this.isPublish=function(e){return e===O.PUBLISH},this.isSent=function(e){return e===O.SENT},this.isCancel=function(e){return e===O.CANCEL},this.isOther=function(e){return e===O.OTHER}}return e.prototype._applyConfig=function(){var e=this;if(iNet.apply(this,y),window.xCalendarConfigList&&window.xCalendarConfigList.length>0&&window.xCalendarConfigList.forEach((function(t){var n=e.getConfigObj(t.name);n?$.extend(n,t):e.configs.push(t)})),window.xCalendarConfigCustoms)for(var t in window.xCalendarConfigCustoms){var n=this.getConfigObj(t);n&&(n.value=window.xCalendarConfigCustoms[t])}window.xcalendarResources&&(this.resources=window.xcalendarResources),this.configs.forEach((function(e){"false"===e.value&&(e.value=!1)}))},e.prototype.getConfigValue=function(e){var t=this.getConfigObj(e);return t&&t.value},e.prototype.getConfigObj=function(e){for(var t=0;t<this.configs.length;t++)if(this.configs[t].name===e)return this.configs[t]},e.prototype.addQueue=function(e,t,n){var i=this;this._queue[e]=this._queue[e]||[],this._queue[e].push(n),1===this._queue[e].length&&new Promise((function(e){t(e)})).then((function(t){i._queue[e].forEach((function(e){e&&e(t)})),delete i._queue[e]}))},e.prototype.ready=function(e,t){var n=this;this._loadOrgans((function(t){e(t,n._getOrganOnInit())}),t)},e.prototype.cacheSessionStorage=function(e,t){try{if(!t){var n=sessionStorage.getItem(e);if(n){if(n=JSON.parse(n),(new Date).getTime()-n.time<3e5)return n.data;sessionStorage.removeItem(e)}return!1}sessionStorage.setItem(e,JSON.stringify({time:(new Date).getTime(),data:t})),localStorage.removeItem(e)}catch(e){}},e.prototype.cacheDataTemp=function(e,t){if(this._cacheStore=this._cacheStore||{},void 0===t)return this._cacheStore[e];this._cacheStore[e]=t},e.prototype.setOrgId=function(e){this.orgid=e,this._cacheOrgId(e)},e.prototype.getOrgId=function(){return this.orgid||this._cacheOrgId()||iNet.organId},e.prototype._cacheOrgId=function(e){var t="xcalendar_orgid";try{if(!e)return localStorage.getItem(t);localStorage.setItem(t,e)}catch(e){}},e.prototype.getHourMinute=function(e){return e.getTime?60*e.getHours()+e.getMinutes():(e=e.split(":"),60*Number(e[0])+Number(e[1]))},e.prototype.create=function(e,t,n){var i=this;return this.postForm({url:"calbuilder/element/create",data:e,success:function(e){e&&e.uuid&&i.indexEvent(e),t(e)}},n)},e.prototype.updateEventByRole=function(e,t,n){var i=this,r=e&&e.orgid||this.getOrgId();this.loadRole(r,(function(){var a=i.getEventByObjectId(e&&e.element);i.isReviewer(r)?i.reviewUpdate(e,t,n):i.isOwnReviewer(r)&&a&&i.meIsCreator(a)?i.ownerReviewUpdate(e,t,n):i.update(e,t,n)}),n)},e.prototype.update=function(e,t,n){var i=this;return this.postForm({url:"calbuilder/element/update",data:e,success:function(e){e&&e.uuid&&i.indexEvent(e),t&&t(e)}},n)},e.prototype.reviewUpdate=function(e,t,n){var i=this;return this.postForm({url:"calbuilder/reviewupdate",data:e,success:function(e){e&&e.uuid&&i.indexEvent(e),t&&t(e)}},n)},e.prototype.ownerReviewUpdate=function(e,t,n){var i=this;return this.postForm({url:"calbuilder/owner/reviewupdate",data:e,success:function(e){e&&e.uuid&&i.indexEvent(e),t&&t(e)}},n)},e.prototype.remove=function(e,t,n){return this.sendRequest({url:"calbuilder/element/delete",data:e,success:t},n)},e.prototype.cancel=function(e,t,n){var i=this,r=e&&e.orgid||this.getOrgId();this.loadRole(r,(function(){i.isReviewer(r)?i.reviewCancel(e,t,n):i.isOwnReviewer(r)&&i.ownerReviewCancel(e,t,n)}),n)},e.prototype.reviewNotify=function(e,t,n){return this.sendRequest({type:"post",url:"calbuilder/reviewnotify",data:e,success:t},n)},e.prototype.reviewCancel=function(e,t,n){var i=this;return this.sendRequest({url:"calbuilder/reviewcancel",data:e,success:function(e){e&&e.uuid&&i.indexEvent(e),t&&t(e)}},n)},e.prototype.ownerReviewCancel=function(e,t,n){var i=this;return this.sendRequest({url:"calbuilder/owner/reviewcancel",data:e,success:function(e){e&&e.uuid&&i.indexEvent(e),t&&t(e)}},n)},e.prototype.deleteAttachment=function(e,t,n){var i=this;return this.sendRequest({type:"post",url:"calbuilder/file/delete",data:e,success:function(e){t&&t(i.indexEvent(e))}},n)},e.prototype.loadOrganMembers=function(e,t,n){return e=e||this.getOrgId(),this.searchAttendee({orgid:e},t,n)},e.prototype.searchAttendee=function(e,t,n){this._searchAttendee(e,(function(e){e.sort((function(e,t){return e.fullname.localeCompare(t.fullname)})),t(e)}),n)},e.prototype._searchAttendee=function(e,t,n){var i=this;return this.sendRequest({url:"calbuilder/attendee/search",data:e,success:function(e){var n=e&&e.elements||[];(n=n.filter((function(e){return!e.alias}))).forEach((function(e){return i._indexAccount(e)})),t(n)},error:function(){t([])}},n,!0)},e.prototype._indexAccount=function(e){return e._index=m(e.fullname.toLowerCase())+" "+e.username.split("@")[0],e.display=this.insertPrefixAttendee(e.fullname||e.username),e},e.prototype.loadDepartments=function(e,t,n){return this.sendRequest({url:"calbuilder/department/list",data:e,success:function(e){(e=e&&e.items||[]).sort((function(e,t){return e.order-t.order})),t(e)},error:function(){t([])}},n,!0)},e.prototype.getMyOrg=function(e,t){var n=this,i="cal_my_organs";if(localStorage.removeItem(i),i+=iNet.usercode,this._myOrgans=this._myOrgans.length&&this._myOrgans||this.cacheSessionStorage(i)||[],this._myOrgans.length>0)return e(this._myOrgans);this.sendRequest({url:"plugin/organization/list",success:function(t){var r=n._convertOrg(t&&t.elements||[]);r.length>0&&(r=n.visibleMyOrgans(r),n._myOrgans=r,n.cacheSessionStorage(i,r)),e(r)},error:function(){return e([])}},t,!0)},e.prototype.visibleMyOrgans=function(e){var t=this;return e.filter((function(e){var n=t.getOrgById(e.firmUUID);return n&&!!n.groupType}))},e.prototype.getAllOrg=function(e,t){var n=this,i="cal_organ_list";return localStorage.removeItem(i),i+=iNet.usercode,this._organs=this._organs.length&&this._organs||this.cacheSessionStorage(i)||[],this._organs.length>0?e(this._organs):this.sendRequest({data:{pageSize:-1},url:"plugin/organization/search",success:function(t){var r=n._convertOrg(t&&t.items||[]);r.length>0&&(r=n.visibleOrgans(r),n._organs=r,n.cacheSessionStorage(i,n._organs)),e(r)},error:function(){return e([])}},t,!0)},e.prototype.visibleOrgans=function(e){return e.filter((function(e){return!!e.groupType}))},e.prototype._loadOrgans=function(e,t){var n=this;this._organs&&this._organs.length>0?e(this._organs.slice()):this.getAllOrg((function(i){n.loadRole("",(function(r){n.isAuth=!!r.isAuth,r.isAuth?n.getMyOrg((function(t){for(var n=t.length-1;n>=0;n--)for(var r=t[n],a=0;a<i.length;a++){var o=i[a];if(o.firmUUID===r.firmUUID){i.splice(a,1),o.myOrg=!0,i.unshift(o);break}}e(i)}),t):e(i)}),t)}),t)},e.prototype.getTreeOrg=function(e,t){var n=this;this._loadOrgans((function(t){var i=[];t.forEach((function(e){e.children=[]})),t.forEach((function(e){if(e.parentID){var t=n.getOrgById(e.parentID);t&&t.children.push(e)}else i.push(e)})),i.data=t,e&&e(i)}),t)},e.prototype.indexOrgSearch=function(e){e._index=m([e.firmName,e.firmUUID,e.firmPrefix].join(" ").toLowerCase())},e.prototype.isMyOrg=function(e){var t=this.getOrgById(e);return t&&t.myOrg},e.prototype.loadEvent=function(e,t,n){var i=this;return this.sendRequest({type:"post",url:"calbuilder/element/load",data:e,success:function(r){r&&r.uuid?(i.indexEvent(r),t&&t(r)):i.loadRole(e.orgid,(function(){i.isReviewer(e.orgid)?i.loadEventReview(e,t,n):t&&t(r)}))}},n)},e.prototype.updateState=function(e,t,n){return e.notes&&(e.notes=this.formatTextUpdate(e.notes)),this.loadEvent(e,t,n)},e.prototype.loadEventReview=function(e,t,n){var i=this;return this.sendRequest({url:"calbuilder/reviewload",data:e,success:function(e){e&&e.uuid&&i.indexEvent(e),t&&t(e)}},n)},e.prototype.loadGroupEvent=function(e,t,n){var i=this;return this.sendRequest({url:"calbuilder/element/group",data:e,success:function(e){return t(i.modifyEvent(e&&e.items||[]))}},n)},e.prototype.loadOrgEvents=function(e,t,n){this._loadOnDifferYear(this._loadOrgEvents,e,t,n)},e.prototype._loadOrgEvents=function(e,t,n){var i=this;return this.sendRequest({type:"post",url:"calbuilder/mainboard/view",data:e,success:function(e){return t(i.modifyEvent(e&&e.items||[]))}},n)},e.prototype.loadCommunityEvents=function(e,t,n){this._loadOnDifferYear(this._loadCommunityEvents,e,t,n)},e.prototype._loadCommunityEvents=function(e,t,n){var i=this;return this.sendRequest({type:"post",url:"calbuilder/mainboard/published",data:e,success:function(e){return t(i.modifyEvent(e&&e.items||[]))},useOrgId:!0},n)},e.prototype.loadAllPublishEvents=function(e,t,n){this._loadOnDifferYear(this._loadAllPublishEvents,e,t,n)},e.prototype._loadAllPublishEvents=function(e,t,n){var i=this;return this.sendRequest({type:"post",url:"calbuilder/mainboard/published",data:e,success:function(e){return t(i.modifyEvent(e&&e.items||[]))},removeOrgId:!0},n)},e.prototype.loadPublishEvents=function(e,t,n){var i=this;this.loadRole(e.orgid,(function(){i.isMyOrg(e.orgid)?i.loadOrgEvents(e,t,n):i.loadCommunityEvents(e,t,n)}),n)},e.prototype.getReviewEvents=function(e,t,n){this._loadOnDifferYear(this._getReviewEvents,e,t,n)},e.prototype._getReviewEvents=function(e,t,n){var i=this;return this.sendRequest({type:"post",url:"calbuilder/reviewlist",data:e,success:function(e){return t(i.modifyEvent(e&&e.items||[]))}},n)},e.prototype.getViewEvents=function(e,t,n){this._loadOnDifferYear(this._getViewEvents,e,t,n)},e.prototype._getViewEvents=function(e,t,n){var i=this;return this.sendRequest({type:"post",url:"calbuilder/viewlist",data:e,success:function(e){return t(i.modifyEvent(e&&e.items||[]))}},n)},e.prototype.reviewSearchEvents=function(e,t,n){this._loadOnDifferYear(this._reviewSearchEvents,e,t,n)},e.prototype._reviewSearchEvents=function(e,t,n){var i=this;return this.sendRequest({type:"post",url:"calbuilder/reviewsearch",data:e,success:function(e){return t(i.modifyEvent(e&&e.items||[]))}},n)},e.prototype.getOwnEvents=function(e,t,n){this._loadOnDifferYear(this._getOwnEvents,e,t,n)},e.prototype._getOwnEvents=function(e,t,n){var i=this;return this.sendRequest({type:"post",url:"calbuilder/element/list",data:e,success:function(e){return t(i.modifyEvent(e&&e.items||[]))}},n)},e.prototype.getListEvents=function(e,t,n){var i=this,r=[];e.orgid=e.orgid||this.getOrgId(),this.loadRole(e.orgid,(function(){r.push(new Promise((function(t){var r=$.extend({},n);r.error=function(){t([])},i.getOwnEvents(e,t,r)}))),i.isReviewer(e.orgid)?r.push(new Promise((function(t){var r=$.extend({},n);r.error=function(){t([])},i.getReviewEvents(e,t,r)}))):i.isViewer(e.orgid)&&r.push(new Promise((function(t){var r=$.extend({},n);r.error=function(){t([])},i.getViewEvents(e,t,r)}))),Promise.all(r).then((function(e){var n=[];e.forEach((function(e){return n=n.concat(e||[])})),n=i.removeEventDuplicate(n),t(i.modifyEvent(n))}))}),n)},e.prototype.modifyEvent=function(e){var t=this;if(e)return this.removeEventDuplicate(e),e.forEach((function(e){return t.indexEvent(e)})),this.sortEvents(e),e},e.prototype.removeEventDuplicate=function(e){if(e.length>1)for(var t=1;t<e.length;t++)for(var n=t-1;n>=0;n--)if(e[t].uuid===e[n].uuid&&e[t].day===e[n].day){e.splice(t,1),--t;break}return e},e.prototype.sortEvents=function(e){return this.sortEventStart(e),this.sortEventPriority(e),e},e.prototype.sortEventStart=function(e){return this._sort(e,"from"),e},e.prototype.sortEventPriority=function(e){for(var t=0;t<e.length;t++){var n=e[t];n._order=Number(n._order)||0,n._order>0&&(i(n),t=e.indexOf(n))}function i(t){if(0!==t._order){var n=e.indexOf(t);if(n>0){var r=e[n-1];t.day===r.day&&(0===r._order||t._order<r._order)&&(e[n]=r,e[n-1]=t,i(t))}}}return e},e.prototype._sort=function(e,t){for(var n=1;n<e.length;n++)if(0!==n){var i=e[n],r=e[n-1];i[t]<r[t]&&(e[n]=r,e[n-1]=i,n-=2)}},e.prototype.searchEventsByKeywords=function(e,t){return t&&t.length>0?e.filter((function(e){for(var n=0;n<t.length;n++)if(e._index.indexOf(t[n])<0)return!1;return!0})):e.slice()},e.prototype.indexEvent=function(e){return e.objectId=e.uuid+e.mode+e.day,this._mapEvents[e.objectId]=e,this._mapEvents[e.uuid]=e,e._indexed||(this.indexEventMembers(e),window.beforeIndexEvent&&window.beforeIndexEvent(e),e.subjectDisplay=this.formatTextDisplay(e.subject||""),e.locationDisplay=this.formatTextDisplay(e.location||""),this.indexRepeat(e),this.indexEventAttribute(e),this.indexEventDate(e),this.indexEventSearch(e),this.indexCustom(e),e.category=e.category||"",e.categoryIcon=D[e.category],e.department=e.departID,e._indexed=!0),e},e.prototype.indexEventMembers=function(e){var t=this,n={};for(var i in T)n[i]=[];e.members=e.members||[],e.attendees=[],e.members.forEach((function(i){i.name=t.attendeeDisplay(i),i.value=t.attendeeValue(i),i.alias?i.type=_.ALIAS:i.username?i.type=_.USER:i.type=_.ORGAN,n[i.role]=n[i.role]||[],n[i.role].push(i),i.role===T.CREATOR?(e.creator=i.username,e.fullname=i.fullname,e.isCreator=t.usernameIsMe(e.creator),e.creatorStr=e.fullname+"("+e.creator+")"):e.attendees.push(i)})),e.chairmanStr=this._groupMember2String(n.CHAIRMAN),e.memberStr=this._groupMember2String(n.MEMBER),e.prepareStr=this._groupMember2String(n.PREPARER),e.watcherStr=e.observerStr=this._groupMember2String(n.OBSERVER),e.membersDecode=n},e.prototype._groupMember2String=function(e){var t="",n=this.groupAttendeeByOrgan(e);for(var i in n){var r=n[i],a=r.filter((function(e){return e.type===_.ORGAN}))[0];a&&(t+="<b>"+a.organName+"</b>: "),r.forEach((function(e){e.type!==_.ORGAN&&(t+=e.name+", ")})),t=t.slice(0,-2),t+="<br>"}return t.slice(0,-4)},e.prototype.indexEventAttribute=function(e){for(var t in e.attribute)e["_"+t]=e.attribute[t];e._order=Number(e._order)||0,e._subType&&(e.type=e._subType)},e.prototype.initEvent=function(e){return e=$.extend({},e),this._initEventDate(e),e.startTime=e.from.format("H:i"),e.toTime=e.to.format("H:i"),e},e.prototype._initEventDate=function(e){if(e){var t=void 0;e&&e.uuid&&(t=new Date(e.year,0,e.day)).getTime()&&(e.from=new Date(t.getTime()+60*e.startTime*1e3),e.to=new Date(t.getTime()+60*e.toTime*1e3)),t&&t.getTime()||((t=new Date).setHours(t.getHours()+1,0,0,0),e.from=t,(t=new Date(t)).setHours(t.getHours()+1),e.to=t)}},e.prototype.indexEventDate=function(e){this._initEventDate(e),e.allDay="true"===e._allday,e.timeStr=this.formatDateStr(e.from),e.allDay?(e.startTimeStr=e.toTimeStr=this.resources.allDay,e.hourStr=this.resources.allDay):(e.startTimeStr=this.formatTimeStr(e.from),e.toTimeStr=this.formatTimeStr(e.to),e.hourStr=e.startTimeStr+" - "+e.toTimeStr),e.timeStr+="; "+e.hourStr,e.start=e.from,e.end=e.to,e.createTime&&(e.createDate=new Date(e.createTime),e.createDateStr=this.formatDateTimeStr(e.createDate)),e.updateTime&&(e.updateDate=new Date(e.updateTime),e.updateDateStr=this.formatDateTimeStr(e.updateDate));var t=(new Date).getTime()-(e.updateTime||e.createTime);(t/=36e5)<0&&(t=0),t<=this.TIME_NEW_UPDATE&&(e.recentUpdated=!0,e.lastUpdateStr=this.getTextForMinutes(60*t))},e.prototype.indexEventSearch=function(e){e._index="",e._members=[],e.subject&&(e._index=m(e.subject.toLowerCase())),e.location&&(e._index+=" "+m(e.location.toLowerCase()));for(var t=0;t<e.members.length;t++){var n=e.members[t];n.fullname&&(e._index+=" "+m(n.fullname.toLowerCase())),n.username&&(e._index+=" "+n.username.toLowerCase(),n.role!==T.CREATOR&&e._members.push(n.username))}e.attachments&&e.attachments.forEach((function(t){t.orgid=e.firmUUID}))},e.prototype.indexRepeat=function(e){if(e.rrule){var t={};e.rrule.split(";").forEach((function(e){"FREQ"===(e=e.split("="))[0]?t.type=t.rrule=t.rrmode=e[1]:"BYDAY"===e[0]&&(t.wkdays=e[1].split(","))})),e.lstart&&(t.lstart=new Date(e.lstart)),e.until&&(t.until=new Date(e.until)),e.repeat=t}},e.prototype.indexCustom=function(e){},e.prototype.isReviewer=function(e){return e=e||this.getOrgId(),this._userRoles[e]&&!!this._userRoles[e].reviewer},e.prototype.isOwnReviewer=function(e){return e=e||this.getOrgId(),this._userRoles[e]&&!!this._userRoles[e].own_reviewer},e.prototype.isViewer=function(e){return e=e||this.getOrgId(),this._userRoles[e]&&!!this._userRoles[e].viewer},e.prototype.getQueryParams=function(e){var t={};return(e=e||location.search).replace("?","").split("&").forEach((function(e){if(e){var n=e.indexOf("=");n>-1&&(t[e.slice(0,n)]=e.slice(n+1))}})),t},e.prototype.buildQueryString=function(e){var t="";for(var n in e)t+=n+"="+encodeURIComponent(e[n])+"&";return t.slice(0,-1)},e.prototype.getUserAvatar=function(e,t){return E.getUrl("system/userprofile/photo",t)+"?usercode="+e+"&thumbnail=50"},e.prototype.getPermissionOnEvent=function(e,t,n,i){var r=this,a=e.mode;if(this.isOther(a))t();else{if(!e.uuid)return t({save:!0,saveCreate:!0});n=n||this.getOrgId()||e.firmUUID,this.loadRole(n,(function(){var i;r.indexEvent(e);var o=r.isReviewer(n)||r.isOwnReviewer(n)&&r.canOwnReviewEvent(e),s=!r.isCreate(a)&&!r.isCancel(a)&&o;if(e.firmUUID===n){var l=r.canUpdateOwnEvent(e);i=e.type!==I.PERSONAL||r.getConfigValue("PERSONAL_CAN_PUBLISH")?{save:l||s,approve:o&&(r.isSent(a)||l),reject:o&&r.isSent(a),send:l&&!o,revert:r.isSent(a)&&e.isCreator||(r.isCancel(a)||r.isPublish(a))&&o,cancel:o&&r.isPublish(a),delete:l}:{save:l,delete:l}}else i={},r.isPublish(e.mode)&&r.hasFirmAttendee(e,n)&&r.canExternalUpdateEvent(e,n)&&(i={updateAttendee:!0});i.print=!0,i.exportInvitation=r.catIsInvitation(e.category)&&e._templateId,t(i)}),i)}},e.prototype.canUpdateOwnEvent=function(e){return e.isCreator&&this.isCreate(e.mode)},e.prototype.canReviewEvent=function(e){return this.isReviewer(e.firmUUID)},e.prototype.canOwnReviewEvent=function(e){return this.isOwnReviewer(e.firmUUID)&&e.isCreator},e.prototype.canUpdateAttendee=function(e,t){return this.isFirmEvent(e,t)&&(this.canUpdateOwnEvent(e)||this.canOwnReviewEvent(e)||this.canReviewEvent(e))},e.prototype.canExternalUpdateEvent=function(e,t){return this.isPublish(e.mode)&&!this.isFirmEvent(e,t)&&this.isReviewer(t)},e.prototype.isFirmEvent=function(e,t){return e.firmUUID===t},e.prototype.searchAnyAttendee=function(e,t,n){var i=this;this.searchUserAsAttendee(e,(function(n){i.searchOrganAsAttendee(e,(function(e){e.forEach((function(e){return n.push(e)})),t(n)}))}),n)},e.prototype.searchUserAsAttendee=function(e,t,n){var i=this,r=e.orgid||this.getOrgId(),a=this.getOrgNameById(r);this.loadOrganMembers(r,(function(n){var o=e.keyword||"",s=e.limit||-1,l=[];o=m(o).toLowerCase();for(var d=0;d<n.length;d++){var c=n[d];if(!o||c._index.indexOf(o)>-1){var u=i.memberToAttendee(c);if(u.organId=r,u.organName=a,l.push(u),s>0&&l.length>=s)break}}t(l)}),n)},e.prototype.searchOrganAsAttendee=function(e,t,n){var i=this;this.loadOrgByKeyword(e,(function(e){t(e.map((function(e){return i.organToAttendee(e)})))}),n)},e.prototype.insertPrefixAttendee=function(e){return this.getConfigValue("PREFIX_ATTENDEE_NAME")?this.getConfigValue("PREFIX_ATTENDEE_NAME")+e:e},e.prototype.memberToAttendee=function(e){return{username:e.username,fullname:e.fullname,display:this.insertPrefixAttendee(e.fullname),type:_.USER}},e.prototype.organToAttendee=function(e){return{organId:e.firmUUID,organName:e.firmName,type:_.ORGAN}},e.prototype.aliasToAttendee=function(e,t){return{alias:e,organId:t=t||this.getOrgId(),organName:this.getOrgNameById(t),type:_.ALIAS}},e.prototype.loadAttendeeByName=function(e,t,n){var i=this;if(!e||!e.keyword)return t([]);e.limit=e.limit||5,this.loadUserByKeyword(e,(function(n){i.loadOrgByKeyword(e,(function(e){t(n.concat(e))}))}),n)},e.prototype.loadUserByKeyword=function(e,t,n){this.searchAttendee({orgid:e.orgid},(function(n){for(var i=[],r=m(e.keyword.toLowerCase()),a=0;a<n.length;a++){var o=n[a];if(o._index.indexOf(r)>-1&&(i.push({name:o.fullname,value:o.username,type:_.USER,member:o}),i.length>=e.limit))break}t(i)}),n)},e.prototype.loadOrgByKeyword=function(e,t,n){var i=[];this._loadOrgans((function(n){for(var r=m(e.keyword).toLowerCase(),a=0;a<n.length;a++){var o=n[a];if(o._index.indexOf(r)>-1&&(i.push(o),i.length>=e.limit))break}t(i)}),n)},e.prototype.getFileUrl=function(e,t,n){if(!e)return"";var i,r=e.orgid||this.getOrgId(),a=this._userRoles[r];return a&&a.isAuth&&this.isMyOrg(r)?i="calbuilder/binary/view":this.hasFirmAttendee(n,this.getOrgId())?(r=this.getOrgId(),i="calbuilder/binary/view"):i="calbuilder/mainboard/binary/view",this.getUrlByOrgId(i,r,t)+"?fileID="+e.uuid+"&element="+e.folder+"&orgid="+r},e.prototype.getFileViewUrl=function(e,t,n){var i=this.getFileUrl(e,t,n);return e.file&&"pdf"===e.file.slice(-3).toLowerCase()&&(i+="&view=pdf&t="+(new Date).getTime()),i},e.prototype.hasFirmAttendee=function(e,t){if(e&&t)for(var n=0;n<e.members.length;n++){var i=e.members[n];if(i.type===_.ORGAN&&i.organId===t)return!0}},e.prototype.getOrgByUid=function(e){for(var t=0;t<this._organs.length;t++)if(this._organs[t].uuid===e)return this._organs[t]},e.prototype.getOrgById=function(e){for(var t=0;t<this._organs.length;t++)if(this._organs[t].firmUUID===e)return this._organs[t]},e.prototype.getOrgNameById=function(e){var t=this.getOrgById(e);return t&&t.firmName||""},e.prototype.getOrgByPrefix=function(e){for(var t=0;t<this._organs.length;t++)if(this._organs[t].firmPrefix===e)return this._organs[t]},e.prototype.getUrlByOrgId=function(e,t,n){var i=this.getOrgById(t);return E.getUrl(e,n,i&&i.firmPrefix)},e.prototype.loadRole=function(e,t,n){var i=this;if(e=e||this.getOrgId(),this._userRoles[e])return t(this._userRoles[e]);this.sendRequest({url:this.roleUrl,data:{orgid:e},success:function(n){try{(n=JSON.parse(n)).isAuth&&(i._userRoles[e]=n,iNet.usercode=n.usercode),t(n)}catch(e){t({})}},error:function(){t({})}},n,!0)},e.prototype.loadRoles=function(e,t,n){var i=this,r=[];e.forEach((function(e){r.push(new Promise((function(t){i.loadRole(e,t,n)})))})),Promise.all(r).then((function(e){return t(e)}))},e.prototype.generateEventWeekView=function(e,t,n){for(var i=[],r=y.getDateStartWeek(t,n),a=function(t){var n=y.dayOfYear(r);i.push(o.generateEventView(e.filter((function(e){return e.day===n})),r)),r.setDate(r.getDate()+1)},o=this,s=0;s<7;s++)a();return i},e.prototype.getLastUpdateSegEvents=function(e){var t;return e.forEach((function(e){e.items.forEach((function(e){var n=e.updateDate||e.createDate;(!t||t<n)&&(t=n)}))})),t},e.prototype.generateEventView=function(e,t){return t=new Date(t),{day:y.dayOfYear(t),display:this.getDisplayByDay(t.getDay()),dayStr:this.formatDateStr(t),isToday:y.dateIsToday(t),date:t,items:e}},e.prototype.getDisplayByDay=function(e){return this.resources.days[e]},e.prototype.buildMembers=function(e,t){return e.forEach((function(e){return e.role=t||T.MEMBER})),e},e.prototype.groupAttendeeByOrgan=function(e){var t={};return e.forEach((function(e){t[e.organId]=t[e.organId]||[],t[e.organId].push(e)})),t},e.prototype.groupAttendeeByOrganRole=function(e,t,n,i,r){var a=this;if(t.length<1)return i([]);var o=this.groupAttendeeByOrgan(t),s=Object.keys(o);s.indexOf(n)<0&&s.push(n),this.loadRoles(s,(function(){var t=!e.uuid||a.canUpdateAttendee(e,n),r=[];Object.keys(o).forEach((function(i){var s=i===n,l=s&&a.canExternalUpdateEvent(e,i),d=o[i];r.push({organId:i,organName:a.getOrgNameById(i),internalUpdate:t,externalUpdate:l,updateAttendee:t||l,attendees:d,canRemoveAttendee:function(e){return t||l&&e.type!==_.ORGAN},canUpdateState:function(e){return void 0!==e.readTime&&s&&a.attendeeIsMe(e)}})})),i(r)}),r)},e.prototype.buildMemberStr=function(e){return e.members=e.members||[],e.members.map((function(e){return e.name})).join(",")},e.prototype.buildMemberShow=function(e){return(e||[]).map((function(e){return e.name})).join(";")},e.prototype.modifyDataUpdate=function(e,t){var n=this,i=[];if(e.attendee){var r=e.attendee.filter((function(e){return void 0===e.readTime}));if(t&&t.uuid){var a=e.attendee.filter((function(e){return void 0!==e.readTime}));t.members.forEach((function(e){e.role!==T.CREATOR&&a.indexOf(e)<0&&i.push(n.attendeeRemoveJson(e))}))}r.forEach((function(e){return i.push(n.attendeeAddJson(e))}))}return e.subject&&(e.subject=this.formatTextUpdate(e.subject)),e.location&&(e.location=this.formatTextUpdate(e.location)),e.attendee=JSON.stringify(i),this.getConfigValue("PERSONAL_CAN_PUBLISH")||e.type!==I.PERSONAL||(e.mode=O.CREATE),e.type===I.MEET_PEOPLE||e.type===I.PERSONAL?(e._subType=e.type,e.type=e.type.split(";")[0]):e._subType="",e},e.prototype.attendeeAddJson=function(e){var t={organId:e.organId,organName:e.organName,role:e.role||T.MEMBER};switch(e.type){case _.USER:t.members=e.username+":"+e.fullname,t.display=e.display;break;case _.ORGAN:this.getConfigValue("EVENT_BETWEEN_UNIT")&&(t.firms=e.organId+":"+e.organName);break;default:t.alias=e.alias||e.organName}return t},e.prototype.attendeeRemoveJson=function(e){var t={organId:e.organId};switch(e.type){case _.USER:t.members=e.username+":REMOVE";break;case _.ORGAN:t.firms=e.organId+":REMOVE";break;default:t.alias=e.alias+":REMOVE"}return t},e.prototype._convertOrg=function(e){e=e||[];for(var t=0;t<e.length;t++){var n=e[t];n.firmName=n.orgName||n.name,n.firmPrefix=n.uriPrefix||n.prefix,n.firmUUID=n.organId||n.organiId||"",this.indexOrgSearch(n)}return e.sort((function(e,t){return e.firmName.localeCompare(t.firmName)})),e},e.prototype.viewEventOnModal=function(e){var t=this;this._mapEvents[e]&&iNet.plugins.ready((function(n){n.xcalendar&&n.xcalendar.openView(t._mapEvents[e])}))},e.prototype.getEventByObjectId=function(e){return this._mapEvents[e]},e.prototype.getTextForMinutes=function(e){return(e=parseInt(e)||1)>=60?Math.round(e/60)+" "+this.resources.hour:e+" "+this.resources.minute},e.prototype.groupEventBySession=function(e){var t={allday:[],morning:[],afternoon:[],evening:[]};for(var n in e.forEach((function(e){e.allDay?t.allday.push(e):e.from.getHours()<12?t.morning.push(e):e.from.getHours()<18?t.afternoon.push(e):t.evening.push(e)})),t)this.sortEvents(t[n]);return t},e.prototype.groupEventByPerson=function(e,t,n){var i=this,r={persons:[],segEvents:this.generateEventWeekView(e,n)},a=r.segEvents.map((function(e){return e.items}));return t.forEach((function(e){var t=a.map((function(t){return t.filter((function(t){return i.memberIsAttendee(t,e.name)}))}));r.persons.push({person:e,eventDays:t})})),r},e.prototype.groupEventByLeaders=function(e,t,n,i){var r=this;this.loadLeaders(t,(function(t){var i=[],a=[];t.forEach((function(e){return i.push({username:e.name,fullname:e.value,events:[]})})),e.forEach((function(e){for(var t,n=0;n<i.length;n++){var o=i[n];r.memberIsAttendee(e,o.username)&&(t=!0,o.events.push(e))}t||a.push(e)})),n(i,a)}),i,!0)},e.prototype.meIsCreator=function(e){for(var t=e.members.length-1;t>=0;t--)if(e.members[t].role===T.CREATOR&&this.attendeeIsMe(e.members[t]))return!0;return!1},e.prototype.attendeeIsMe=function(e){return this.usernameIsMe(e.username)},e.prototype.attendeeDisplay=function(e){return e.alias||e.display||e.fullname||e.username||e.organName},e.prototype.attendeeValue=function(e){return e.alias||e.username||e.organId},e.prototype.formatTextDisplay=function(e){var t=this.formatTextUpdate(e);return t=t.replace(/\n/g,"<br>")},e.prototype.formatTextUpdate=function(e){var t=$("<div>").html(e);return t.find("style,script").remove(),t.html()},e.prototype.memberIsAttendee=function(e,t){for(var n=0;n<e.members.length;n++)if(e.members[n].username===t)return!0},e.prototype.getAttendeeByUsername=function(e,t){for(var n=0;n<e.members.length;n++)if(e.members[n].username===t)return e.members[n]},e.prototype.getAttendeeIsMe=function(e){for(var t=0;t<e.members.length;t++){var n=e.members[t];if(n.role!==T.CREATOR&&this.usernameIsMe(n.username))return n}},e.prototype.eventIsViewed=function(e){var t=this.getAttendeeIsMe(e);return!t||t.readTime},e.prototype.usernameIsMe=function(e){return e===iNet.usercode},e.prototype.sendRequest=function(e,t,n){var i=this,r=this._buildAjaxOptions(e,t);if(!n)return E.sendRequest(r);var a=r.url;r.data&&Object.keys(r.data).length>0&&(a+=JSON.stringify(r.data));var o=this.cacheDataTemp(a);if(o)return r.success(o);this.addQueue(a,(function(e){var t=$.extend({},r);t.success=function(t){i.cacheDataTemp(a,t),e(t)},t.error=function(t){e(null,t)},E.sendRequest(t)}),(function(e,t){t?r.error&&r.error(t):r.success&&r.success(e)}))},e.prototype.postForm=function(e,t){return E.postForm(this._buildAjaxOptions(e,t))},e.prototype._buildAjaxOptions=function(e,t){var n=$.extend({},e,t),i=n.data&&n.data.orgid||this.getOrgId(),r=this.getOrgById(i),a=r&&r.firmPrefix===iNet.path.slice(1);return!n.removeOrgId&&(a||n.useOrgId)?(n.data=n.data||{},n.data.orgid=i):n.data&&delete n.data.orgid,n.url=this.getUrlByOrgId(n.url,i,n.domain),n},e.prototype._getOrganOnInit=function(){var e,t=this.getQueryParams();if(t.orgid&&(this.setOrgId(t.orgid),e=this.getOrgById(t.orgid)),e||"smartcloud"===iNet.firmPrefix||(e=this.getOrgByPrefix(iNet.firmPrefix)),!e){var n=this.getOrgId()||iNet.organId;e=this.getOrgById(n)}return e||(e=this.getOrgByPrefix(iNet.path.slice(1))),e||(e=this._myOrgans&&this._myOrgans[0]||this._organs&&this._organs[0]),e&&this.setOrgId(e.firmUUID),e},e.prototype.groupEventByCar=function(e,t){var n=[];return e.forEach((function(e){n.push({car:e,events:[]})})),t.forEach((function(e){var t=n[0];if(e._carUUID)for(var i=0;i<n.length;i++)n[i].car.uuid===e._carUUID&&(t=n[i]);t.events.push(e)})),n},e.prototype.filterMeetPeopleEvents=function(e){return e.filter((function(e){return e._subType===I.MEET_PEOPLE}))},e.prototype._loadOnDifferYear=function(e,t,n,i){var r=this;if(!t.from||!t.to||t.from<=t.to)e.apply(this,[t,n,i]);else{var a=[],o=new Date(t.year+1,0);o.setTime(o.getTime()-1);var s=$.extend({},t),l=$.extend({},i);s.to=y.dayOfYear(o),a.push(new Promise((function(t){e.apply(r,[s,t,l])})));var d=$.extend({},t),c=$.extend({},i);d.year=t.year+1,d.from=1,a.push(new Promise((function(t){e.apply(r,[d,t,c])}))),Promise.all(a).then((function(e){var t=[].concat.apply([],e);r.removeEventDuplicate(t),n(t)}))}},e.prototype.loadMonthEvents=function(e,t,n,i){var r,a;(t=new Date(t)).setDate(1),r=y.getDateStartWeek(t),t.setMonth(t.getMonth()+1),t.setTime(t.getTime()-1),a=y.getDateEndWeek(t),e=$.extend({},e,this.getRangeParams(r,a)),this.isMyOrg(e.orgid)?this.getListEvents(e,n,i):this.loadPublishEvents(e,n,i)},e.prototype.getExportUrl=function(e,t){if(e&&e.uuid&&e._templateId)return this.getUrlByOrgId("calbuilder/invitation/export",e.firmUUID,t)+"?templateID="+e._templateId+"&element="+e.uuid},e.prototype.getWeekParams=function(e){var t=y.getWeekRange(e);return this.getRangeParams(t.startWeek,t.endWeek)},e.prototype.getRangeParams=function(e,t){return{year:e.getFullYear(),from:y.dayOfYear(e),to:y.dayOfYear(t)}},e.prototype.dateEqualWeekParams=function(e,t){var n=this.getWeekParams(e);return e&&t&&n.year===t.year&&n.from===t.from&&n.to===t.to},e.prototype.eventIsOnRange=function(e,t){return t.startTime>=e.startTime&&t.startTime<e.toTime||t.toTime<=e.toTime&&t.toTime>e.startTime||t.startTime<=e.startTime&&t.toTime>=e.toTime},e.prototype.verifyDuplicateEvents=function(e,t,n){var i=this,r=[];this.loadPublishEvents({year:e.year,day:e.day,orgid:e.orgid||this.getOrgId()},(function(n){var a=[];n=i.catIsCar(e.category)?n.filter((function(e){return i.catIsCar(e.category)})):n.filter((function(e){return!i.catIsCar(e.category)}));var o=function(e){var t={username:e,events:[]};n.forEach((function(n){var r=i.getAttendeeByUsername(n,e);r&&(t.fullname=r.fullname,t.events.push(n),a.push(n))})),t.events.length>0&&r.push(t)};n=n.filter((function(t){return t.mode===O.PUBLISH&&t.uuid!==e.element&&i.eventIsOnRange(t,e)})),e.attendee&&e.attendee.forEach((function(e){return o(e.username)}));for(var s=!1,l=0;l<r.length;l++)if(r[l].username===iNet.usercode){s=!0;break}s||o(iNet.usercode),r.allEvents=i.removeEventDuplicate(a),t(r)}),n)},e.prototype.needVerifyDuplicate=function(e,t){var n=t.mode===O.PUBLISH,i=!n&&Number(e.mode)===O.PUBLISH,r=t.uuid&&(e.startTime&&t.startTime!==e.startTime||e.toTime&&t.toTime!==e.toTime||e.day&&t.day!==e.day)&&n;return i||r},e.prototype.subjectDisplayWithMaxLength=function(e){var t=Number(this.getConfigValue("SUBJECT_DISPLAY_MAX_LENGTH"))||0;if(t>0&&t<e.subject.length){var n=e.subject.substr(0,t);return n=this.formatTextDisplay(n),n+="...",this.formatTextDisplay(n)}return e.subjectDisplay},e.prototype.dictCreate=function(e,t,n){return this.sendRequest({type:"post",url:"subfirm/dictionary/create",data:e,success:t},n)},e.prototype.dictUpdate=function(e,t,n){return e.dictID=e.dictID||e.uuid,this.sendRequest({type:"post",url:"subfirm/dictionary/update",data:e,success:t},n)},e.prototype.dictRemove=function(e,t,n){return e.dictID=e.dictID||e.uuid,this.sendRequest({type:"post",url:"subfirm/dictionary/remove",data:e,success:t},n)},e.prototype.dictList=function(e,t,n,i){return this.sendRequest({type:"post",url:"subfirm/dictionary/list",data:e,success:function(e){return t(e&&e.items||[])},error:function(){return t([])}},n,i)},e.prototype.loadLeaders=function(e,t,n,i){var r={orgid:e||this.getOrgId(),reference:"CAL_BUILDER_LEADER"};this.dictList(r,(function(e){e.sort((function(e,t){return t.order-e.order})),t(e)}),n,i)},e.prototype.leaderCreateOrUpdate=function(e,t,n){e.uuid?this.dictUpdate(e,t,n):(e.reference="CAL_BUILDER_LEADER",this.dictCreate(e,t,n))},e.prototype.leaderRemove=function(e,t,n){this.dictRemove(e,t,n)},e}();var S=new A;S._applyConfig();var N=function(){function e(e){this.calendarService=e,this.onDelete=new t.EventEmitter,this.dialogTitle="Lịch công tác",this.dialogContent=""}return e.prototype.ngAfterViewInit=function(){this._initDialogDelete()},e.prototype.ngOnDestroy=function(){this._destroyDialogDelete()},e.prototype.hide=function(){this.confirmDialog.hide()},e.prototype.delete=function(){var e=this;this.calendarService.removeEvent({element:this.calEvent.uuid,orgid:this.calEvent.firmUUID},(function(){e.hide(),e.onDelete.emit()}))},e.prototype.show=function(){this.dialogContent='Bạn có đồng ý xóa sự kiện <b>"'+this.calEvent.subject+'"</b> không?',this.confirmDialog.show()},e.prototype._initDialogDelete=function(){this._$dialogDelete=$(this.dialogDelete.nativeElement).hide(),this.hide=this.hide.bind(this),document.body.addEventListener("click",this.hide),this._$dialogDelete.on("click",(function(e){return e.stopPropagation()})),$(document.body).append(this._$dialogDelete)},e.prototype._destroyDialogDelete=function(){document.body.removeEventListener("click",this.hide),this._$dialogDelete.remove()},e.decorators=[{type:t.Component,args:[{selector:"calendar-dialog-delete",template:'<div #dialogDelete class="modal fade" bsModal #confirmDialog="bs-modal" tabindex="-1" role="dialog" aria-hidden="true">\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h4 class="modal-title pull-left"> {{dialogTitle}}</h4>\n                <button type="button" class="close pull-right" aria-label="Close" (click)="hide()">\n                    <span aria-hidden="true">&times;</span>\n                </button>\n            </div>\n            <div class="modal-body" [innerHTML]="dialogContent">\n            </div>\n            <div class="modal-footer">\n                <div class="text-right">\n                    <button type="button" class="btn btn-lg btn-danger btn-sm" (click)="delete()">\n                        <i class="fa fa-trash"></i> Xóa\n                    </button>\n                    <button type="button" class="btn btn-lg btn-default ml-2 btn-sm" (click)="hide()">\n                        <i class="fa fa-times"></i> Đóng\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>',styles:[""]}]}],e.ctorParameters=function(){return[{type:F}]},e.propDecorators={calEvent:[{type:t.Input}],onDelete:[{type:t.Output}],confirmDialog:[{type:t.ViewChild,args:[o.ModalDirective]}],dialogDelete:[{type:t.ViewChild,args:["dialogDelete"]}]},e}();var P=a;P.locale("vi");var U=function(){function e(){}return e.getRepeatText=function(t){for(var n="",i=0;i<e.repeatTypes.length;i++)e.repeatTypes[i].value===t.rrmode&&(n=e.repeatTypes[i].label);return"WEEKLY"===t.rrmode&&(n+=" - "+e._getTextRepeatWeek(t.wkdays)),n},e._getTextRepeatWeek=function(t){return t?e.weekDays.filter((function(e){return t.indexOf(e.value)>-1})).map((function(e){return e.title})).join(", "):""},e.displayDay=function(e){var t=P(e).format("dddd, d MMMM");return(new Date).getFullYear()!==e.getFullYear()&&(t+=" năm "+e.getFullYear()),t.slice(0,1).toUpperCase()+t.slice(1)},e.displayDate=function(e){return P(e).format("[Ngày] LL")},e.displayWeek=function(e){return P(e).format("[Tuần] w [năm] Y")},e.displayMonth=function(e){return P(e).format("[Tháng] MM [năm] Y")},e.displayTime=function(e){return P(e).format("HH:mm")},e.computePosByPoint=function(e,t,n){var i,r=e.getBoundingClientRect(),a=r.height/2,o=r.width/2,s={left:t.x-o,top:t.y-a};n=n||5,innerWidth<s.left+r.width+n?s.left=innerWidth-n-r.width:s.left<n&&(s.left=n),innerHeight<s.top+r.height+n?s.top=innerHeight-n-r.height:s.top<n&&(s.top=n);var l=t.pageY,d=innerHeight-t.pageX,c=t.pageX,u=innerWidth-t.pageY;switch(Math.max(l,u,d,c)){case l:i="top",s.top-=a+n;break;case d:i="bottom",s.top+=a+n;break;case c:i="left",s.left-=o+n;break;case u:i="right",s.left+=o+n}return{direction:i,position:s,elementBounds:r}},e.computePosByTargetEl=function(e,t,n,i){var r=e.getBoundingClientRect(),a=t.getBoundingClientRect(),o={},s={};i=i||10;var l={top:a.top,right:innerWidth-a.right,bottom:innerHeight-a.bottom,left:a.left},d=Math.max(l.left,l.right),c=Math.max(l.top,l.bottom);if(r.width>d&&(l.left=n.pageX,l.right=innerWidth-n.pageX),r.height>c&&(l.top=n.pageY,l.bottom=innerHeight-n.pageY),l.left>l.right?(s.left=!0,o.left=l.left-r.width):(s.right=!0,o.left=innerWidth-l.right),l.top>l.bottom?(s.top=!0,o.top=l.top-r.height):(s.bottom=!0,o.top=innerHeight-l.bottom),d*r.width>c*r.height){var u=innerHeight-l.bottom-l.top;s.top?o.top+=u:o.top-=u}else{var p=innerWidth-l.left-l.right;s.left?o.left+=p:o.left-=p}return o.left<i?o.left=i:o.left+r.width>innerWidth&&(o.left=innerWidth-r.width-i),o.top<i?o.top=i:o.top+r.height>innerHeight&&(o.top=innerHeight-r.height-i),o.top+=document.scrollingElement.scrollTop,o.left+=document.scrollingElement.scrollLeft,o},e.repeatTypes=[{label:"Hàng ngày",value:"DAILY"},{label:"Hàng tuần",value:"WEEKLY"},{label:"Hàng tháng",value:"MONTHLY"}],e.weekDays=[{label:"T2",title:"Thứ hai",value:"MO"},{label:"T3",title:"Thứ ba",value:"TU"},{label:"T4",title:"Thứ tư",value:"WE"},{label:"T5",title:"Thứ năm",value:"TH"},{label:"T6",title:"Thứ sáu",value:"FR"},{label:"T7",title:"Thứ bảy",value:"SA"},{label:"CN",title:"Chủ nhật",value:"SU"}],e}();var V=function(e){this.repeatText="",this.timeDisplay="",this.event=e,this.subject=r.HtmlUtils.formatHtmlDisplay(e.subject),this.summary=r.HtmlUtils.formatHtmlDisplay(e.summary),e.members&&(this.myAttendee=e.members.find((function(e){return"CREATOR"!==e.role&&e.username===iNet.username}))),e.repeat?this.repeatText=U.getRepeatText(e.repeat):this.repeatText="",this.timeDisplay=U.displayDay(e.start),"true"!==e.attribute._allday&&(this.timeDisplay+=" ⋅ "+U.displayTime(e.start)+" - "+U.displayTime(e.end))};var L=function(){function e(e){this.router=e,this.onChange=new t.EventEmitter}return e.prototype.ngAfterViewInit=function(){this._initModalView(),this._addScrollUpdatePos()},e.prototype.ngOnDestroy=function(){this._destroyModalView(),this._removeScrollUpdatePos()},e.prototype.editEvent=function(){this.hide(),this.router.navigate(["/calendar/event",this.calendarEvent.event.uuid||""])},e.prototype.changeEvent=function(){this.hide(),this.onChange.emit(),this._onChange()},e.prototype.viewEvent=function(e,t,n,i){var r=this;this._onChange=i,this.calendarEvent=new V(e),this.calEvent=e,this._targetEl=n,this._jsEvent=t,this._syncBodyHeight(),this._preventScrolling(),t.stopPropagation(),setTimeout((function(){return r._openModal(t,n)}),100)},e.prototype.hide=function(){this._showModal=!1,this._$modalView.hide(),this._$modalView.css("opacity",0)},e.prototype.show=function(){this._showModal=!0,this._$modalView.show()},e.prototype.removeEvent=function(){this.viewDeleteModal.show()},e.prototype._preventScrolling=function(){$(document.scrollingElement).css("overflow","hidden"),clearTimeout(this._scrollTimer),this._scrollTimer=setTimeout((function(){$(document.scrollingElement).css("overflow","")}),600)},e.prototype._syncBodyHeight=function(){this.maxHeight=innerHeight-150},e.prototype._initModalView=function(){this._$modalView=$(this.modalView.nativeElement).hide(),this.hide=this.hide.bind(this),document.body.addEventListener("click",this.hide),this._$modalView.on("click",(function(e){return e.stopPropagation()})),$(document.body).append(this._$modalView)},e.prototype._destroyModalView=function(){document.body.removeEventListener("click",this.hide),this._$modalView.remove()},e.prototype._addScrollUpdatePos=function(){this._scrollUpdatePos=this._scrollUpdatePos.bind(this),document.addEventListener("scroll",this._scrollUpdatePos,!0)},e.prototype._removeScrollUpdatePos=function(){document.removeEventListener("scroll",this._scrollUpdatePos)},e.prototype._scrollUpdatePos=function(){var e=this;this._showModal&&this._jsEvent&&this._targetEl&&(clearTimeout(this._timer),this._timer=setTimeout((function(){return e._openModal(e._jsEvent,e._targetEl)}),100))},e.prototype._openModal=function(e,t){this.show();var n=U.computePosByTargetEl(this.modalView.nativeElement,t,e),i="translate3d("+n.left+"px,"+n.top+"px,0)";this._$modalView.css({"-webkit-transition-duration":"300ms","transition-duration":"300ms",opacity:"1","-webkit-transform":i,transform:i})},e.decorators=[{type:t.Component,args:[{template:'<div #modalView class="modal-dialog popover" role="document">\n    <div class="modal-content" *ngIf="calEvent">\n            <div class="header-dialog" [ngClass]="{\'overlay\': titleOverlay}">\n                <i class="fa fa-pencil" *ngIf="calEvent.isCreator || !!calendarEvent.myAttendee" (click)="editEvent()" title="Chỉnh sửa"></i>\n                <i class="fa fa-trash" *ngIf="calEvent.isCreator" (click)="removeEvent()" title="Xóa"></i>\n                <i (click)="hide()" class="fa fa-times" title="Đóng"></i>\n            </div>\n        <div class="content-dialog" [ngStyle]="{\'max-height.px\': maxHeight}">\n                <div class="field-group">\n                    <i class="field-icon fa fa-calendar"></i>\n                    <div class="field-content">\n                        <div style="font-size:18px" [innerHTML]="calendarEvent.subject"></div>\n                        <div>{{calendarEvent.timeDisplay}}</div>\n                        <div>{{calendarEvent.repeatText}}</div>\n                    </div>\n                </div>\n                <div class="field-group" *ngIf="calEvent.memberStr">\n                    <i class="field-icon fa fa-users" title="Khách mời tham dự"></i>\n                    <div class="field-content">\n                        <calendar-attendee-list [attendees]="calEvent.attendees" [expandable]="true"></calendar-attendee-list>\n                    </div>\n                </div>\n                <div class="field-group" *ngIf="calEvent.location">\n                    <i class="field-icon fa fa-map-marker" title="Địa điểm"></i>\n                    <div class="field-content">{{ calEvent.location }}</div>\n                </div>\n                <div class="field-group" *ngIf="calendarEvent.summary">\n                    <i class="field-icon fa fa-align-left" title="Mô tả sự kiện"></i>\n                    <div class="field-content" [innerHTML]="calendarEvent.summary"></div>\n                </div>\n                <div class="field-group" *ngIf="calEvent[\'fullname\']">\n                    <i class="field-icon fa fa-user-circle" title="Người tạo"></i>\n                    <div class="field-content">{{ calEvent[\'fullname\'] }}</div>\n                </div>\n                <div class="field-group" *ngIf="calEvent?.attachments?.length">\n                    <i class="field-icon fa fa-paperclip" title="Tập tin đính kèm"></i>\n                    <div class="field-content">\n                        <calendar-attachment-list [calEvent]="calEvent"></calendar-attachment-list>\n                    </div>\n                </div>\n            </div>\n    </div>\n</div>\n<calendar-dialog-delete #dialogRemove hidden [calEvent]="calEvent" (onDelete)="changeEvent()"></calendar-dialog-delete>\n',styles:[".modal-dialog{min-width:450px;margin:0;z-index:1040!important}.modal-content{padding:0;border-radius:4px;border:0;box-shadow:1px 1px 7px 3px rgba(0,0,0,.14)}.header-dialog{padding:10px 25px;text-align:right}.header-dialog .overlay{border-bottom:1px solid #eee}.header-dialog>i{cursor:pointer;width:34px;height:34px;line-height:34px;text-align:center;font-size:18px;border-radius:50%;color:#555;margin-left:10px}.header-dialog>i:hover{background:rgba(0,0,0,.1)}.field-group{margin-bottom:20px;padding-left:14px;padding-right:5px}.field-icon{width:30px;float:left;color:#666;font-size:20px;text-align:center;margin-right:15px;margin-top:2px}.field-content{overflow:hidden;line-height:1.6}.file-attach-layout{float:left;max-width:144px;border:1px solid #fff;padding-right:5px}.file-attach-content{height:36px;line-height:36px;border-radius:2px;cursor:pointer;color:#2a6496;margin-bottom:7px}.file-attach-img{float:left;width:20px;height:20px;margin-top:6px;margin-right:10px}.file-attach-text{display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}a{color:#428bca;text-decoration:none;background:0 0}a:not([href]):hover{text-decoration:underline}.content-dialog{overflow-y:auto}"]}]}],e.ctorParameters=function(){return[{type:i.Router}]},e.propDecorators={onChange:[{type:t.Output}],modalView:[{type:t.ViewChild,args:["modalView"]}],viewDeleteModal:[{type:t.ViewChild,args:["dialogRemove"]}]},e}();a.locale("vi");var F=function(){function e(e,t,n,i){var r=this;this.suggestService=e,this.componentFactoryResolver=t,this.injector=n,this.appRef=i,this.myOrg={organId:iNet.organId,orgName:iNet.orgName,firmPrefix:iNet.firmPrefix},this.locationKeySuggestion="xcalendar_location",this._fns=[],S.roleUrl="unicorn/page/calendar/role",S.setOrgId(this.myOrg.organId),S.ready((function(){S.loadRole(r.myOrg.organId,(function(e){S.setOrgId(r.myOrg.organId),r._ready=!0,r._triggerReady()}))}))}return e.prototype.ready=function(e){this._ready?e():this._fns.push(e)},e.prototype._triggerReady=function(){this._fns.forEach((function(e){return e()})),this._fns=[]},e.prototype.searchLocation=function(e,t){if(e){var n={keyword:this.locationKeySuggestion,content:e};this.suggestService.loadSuggestion(n,t)}},e.prototype.saveLocation=function(e,t){if(e){var n={keyword:this.locationKeySuggestion,content:e};this.suggestService.saveSuggestion(n,t)}},e.prototype.createEvent=function(e,t){this.ready((function(){return S.create(e,t)}))},e.prototype.updateEvent=function(e,t){this.ready((function(){return S.update(e,t)}))},e.prototype.removeEvent=function(e,t){this.ready((function(){return S.remove(e,t)}))},e.prototype.attendeeSearch=function(e,t){this.ready((function(){return S.loadUserByKeyword(e,t)}))},e.prototype.loadAttendees=function(e){this.ready((function(){return S.searchAttendee({},e)}))},e.prototype.loadEvents=function(e,t){this.ready((function(){return S.getListEvents(e,t)}))},e.prototype.loadMonthEvents=function(e,t){this.ready((function(){return S.loadMonthEvents({},e,t)}))},e.prototype.loadEvent=function(e,t){this.ready((function(){return S.loadEvent(e,t)}))},e.prototype.deleteAttachment=function(e,t){this.ready((function(){return S.deleteAttachment(e,t)}))},e.prototype.viewEvent=function(e,t,n,i){this._initViewModal(),this._viewModalRef.instance.viewEvent(e,t,n,i)},e.prototype.hideViewModal=function(){this._viewModalRef&&this._viewModalRef.instance.hide()},e.prototype._initViewModal=function(){if(!this._viewModalRef){var e=this.componentFactoryResolver.resolveComponentFactory(L);this._viewModalRef=e.create(this.injector),this.appRef.attachView(this._viewModalRef.hostView)}},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:r.SuggestionService},{type:t.ComponentFactoryResolver},{type:t.Injector},{type:t.ApplicationRef}]},e}();var B=function(){function e(e){var n=this;this.calendarService=e,this.onChange=new t.EventEmitter,this.events=[],this.colors=["#007bff","#3CA54A","#FF9800","#EF5B49","#77901B","#7D5392","#808080"],this._date=new Date,this.calendarService.ready((function(){return n.loadTodayEvents()}))}return e.prototype.loadTodayEvents=function(){var e=this;this._date&&this.calendarService.loadEvents({day:y.dayOfYear(this._date),year:this._date.getFullYear()},(function(t){t.forEach((function(t){return e._initEventStatus(t)})),e.events=t.slice(0,3)}))},e.prototype.onViewEvent=function(e,t,n){var i=this;this.calendarService.viewEvent(e,t,n,(function(){i.loadTodayEvents(),i.onChange.emit(!0)}))},e.prototype._initEventStatus=function(e){var t=new Date;e.progressing=e.start<t&&e.end>t,e.ended=e.end<t,e.pending=e.start>t,e.progressing?(e.statusText="Đang diễn ra",e.statusColor=this.colors[0]):e.pending?(e.statusText="Chưa diễn ra",e.statusColor=this.colors[5]):(e.statusText="Kết thúc",e.statusColor=this.colors[6]),e.style={"background-color":this.colors[e.mode]}},e.decorators=[{type:t.Component,args:[{selector:"calendar-widget-today",template:'<div #viewToggle class="calendar-body">\n    <div *ngFor="let event of events" #targetEl (click)="onViewEvent(event, $event, targetEl)"\n         class="calendar-event">\n        <div class="calendar-event__state" [ngStyle]="event[\'style\']"></div>\n        <div class="calendar-event__content">\n            <div class="calendar-event__title">\n                {{event.subject}}\n                <div class="calendar-event__progress" [style.color]="event[\'statusColor\']">{{event[\'statusText\']}}</div>\n            </div>\n            <div class="calendar-event__text">\n                <i class="fa fa-clock-o calendar-event__icon"></i>\n                {{event[\'hourStr\']}}\n            </div>\n            <div *ngIf="event.location" class="calendar-event__text">\n                <i class="fa fa-map-marker calendar-event__icon"></i>\n                {{event.location}}\n            </div>\n        </div>\n    </div>\n</div>\n',styles:[".calendar-body{max-height:300px;overflow:hidden auto}.calendar-event{padding:5px 15px;color:#212121;cursor:pointer}.calendar-event:hover{background:rgba(0,0,0,.05)}.calendar-event__state{width:8px;height:8px;border-radius:50%;margin:5px 10px 0 0;float:left}.calendar-event__content{overflow:hidden}.calendar-event__title{line-height:18px;margin-bottom:3px}.calendar-event__progress{font-size:80%;text-transform:uppercase;font-weight:700}.calendar-event__text{font-size:90%;line-height:18px;color:#757575}.calendar-event__icon{width:12px}"]}]}],e.ctorParameters=function(){return[{type:F}]},e.propDecorators={onChange:[{type:t.Output}]},e}();var H=a,Y=function(){function e(e,t,n,i,r){var a=this;this.calendarService=e,this.route=t,this.router=n,this.resourceLoader=i,this.notify=r,this.viewTypes=[new W("Ngày",j.timeGridDay,{columnHeaderText:function(e){var t=H(e).format("dddd, D/M/Y");return t.slice(0,1).toUpperCase()+t.slice(1)},titleFormat:function(){return U.displayDate(a.calendar.getDate())}}),new W("Tuần",j.timeGridWeek,{titleFormat:function(){return U.displayWeek(a.calendar.getDate())}}),new W("Tháng",j.dayGridMonth,{titleFormat:function(){return U.displayMonth(a.calendar.getDate())}})],this.defaultMode=j.dayGridMonth,this.calendarConfig={plugins:[l,d,c],themeSystem:"bootstrap",firstDay:1,locale:"vi",allDaySlot:!0,allDayText:"Cả ngày",header:!1,nowIndicator:!0,navLinks:!0,editable:!0,droppable:!0,eventLimit:!0,selectable:!0,selectMirror:!0,weekends:!0,views:{},businessHours:{daysOfWeek:[1,2,3,4,5],startTime:"00:01",endTime:"23:59"},eventDrop:function(e){return a._updateEventTime(e)},eventResize:function(e){return a._updateEventTime(e)},select:function(e){return a._selectRange(e)},eventClick:function(e){return a._viewEvent(e)},eventDragStart:function(){return a._hideViewDialog()},datesRender:function(){return a._calendarChange()},height:function(){return innerHeight-59}},this._modeCache="__calendar_mode__",this._events=[],Object.assign(this.calendarConfig,this._getDataView()),this.viewTypes.forEach((function(e){e.options&&(a.calendarConfig.views[e.value]=e.options)})),H.locale(this.calendarConfig.locale.toString())}return e.prototype.ngAfterViewInit=function(){this._init(),this._hideViewDialog()},e.prototype.ngOnDestroy=function(){this.calendar.destroy(),this._routerObserver&&this._routerObserver.unsubscribe()},e.prototype._init=function(){var e=this;this.calendar=new s.Calendar(this.calendarRef.nativeElement,this.calendarConfig),this.calendar.render(),this._routerObserver=this.router.events.pipe(u.filter((function(e){return e instanceof i.NavigationEnd}))).subscribe((function(t){return e._onNavigated(t)}))},e.prototype._updateEventTime=function(e){var t,n=this;if(1!==(t=e.oldEvent?this._events[Number(e.oldEvent.id)]:this._events[Number(e.event.id)]).mode){var i=void 0;i=e.event.allDay?1439:60*e.event.end.getHours()+e.event.end.getMinutes();var r={element:t.uuid,year:e.event.start.getFullYear(),day:y.dayOfYear(e.event.start),startTime:60*e.event.start.getHours()+e.event.start.getMinutes(),toTime:i,_allday:e.event.allDay};t.repeat&&Object.assign(r,t.repeat),this.calendarService.updateEvent(r,(function(t,i){if(!t)return n.notify.showMessage("Cập nhật lịch không thành công: "+i.status,"error"),void e.revert();n.reloadEvents()}))}else e.revert()},e.prototype.createEvent=function(){var e=new Date;e.setHours(e.getHours()+1,0),this._createEvent(e,new Date(e.getTime()+36e5))},e.prototype._loadEvents=function(e){var t=this;void 0===e&&(e=!1),this._hideViewDialog(),clearTimeout(this._eventTimer),this._eventTimer=setTimeout((function(){t._loadRangeEvents(e)}),500)},e.prototype._createEvent=function(e,t,n){void 0===n&&(n=!1);var i=window.btoa(JSON.stringify({start:e.valueOf(),end:t.valueOf(),attribute:{allday:n+""}}));this.router.navigate(["/calendar/create",i]),this._hideViewDialog()},e.prototype._selectRange=function(e){this._createEvent(e.start,e.end,e.start.getTime()===e.end.getTime()-864e5)},e.prototype._calendarChange=function(){var e=this;if(this.calendar.view.type===j.dayGridDay)return this.calendar.changeView(j.timeGridDay),void setTimeout((function(){return e._calendarChange()}));setTimeout((function(){e._updateInfo(),e._loadEvents()}))},e.prototype._updateInfo=function(){var e=this;this.viewTitle=this.calendar.view.title,this.viewTypes.forEach((function(t){return t.active=t.value===e.calendar.view.type})),this._checkIsToday(),this._updateViewParams()},e.prototype._checkIsToday=function(){var e={start:this.calendar.view.activeStart,end:this.calendar.view.activeEnd};this.isToday=this._dateInRange(new Date,e)},e.prototype._loadRangeEvents=function(e){var t=this;(e||this._outOfRange())&&(this._currentRange=this._getRange(),this.calendarService.loadEvents(S.getRangeParams(this._currentRange.start,this._currentRange.end),(function(e){return t._renderEvents(e||[])})),this.calendar.removeAllEventSources())},e.prototype._getRange=function(){var e,t=new Date(this.calendar.getDate());for(t.setDate(1),t.setHours(0,0,0,0);t.getDay()!==this.calendarConfig.firstDay;)t.setDate(t.getDate()-1);return e=new Date(t.getTime()+36288e5),{start:t,end:e}},e.prototype._outOfRange=function(){return!this._currentRange||!(this._dateInRange(this.calendar.view.currentStart)&&this._dateInRange(this.calendar.view.currentEnd))},e.prototype._dateInRange=function(e,t){return e>=(t=t||this._currentRange).start&&e<=t.end},e.prototype._renderEvents=function(e){this._events=e;var t=e.map((function(e,t){var n={id:t,uuid:e.uuid,allDay:e.allDay,title:e.subject,start:e.start,end:e.end};return e.end<new Date?(n.textColor="#999",n.color="#ddd"):e.isCreator?(n.textColor="#fff",n.color="#4da0d8"):(n.textColor="#333",n.color="#99ed96"),n}));this._addEventSource(t)},e.prototype._viewEvent=function(e){var t=this,n=this._events[Number(e.event.id)];this.calendarService.viewEvent(n,e.jsEvent,e.jsEvent.currentTarget,(function(){return t.reloadEvents()}))},e.prototype._addEventSource=function(e){this.calendar.addEventSource({events:e})},e.prototype._onNavigated=function(e){var t=this._getDataView();this.calendar.changeView(t.defaultView,t.defaultDate)},e.prototype.changeView=function(e){this.calendar.changeView(e.value)},e.prototype.onPrev=function(){this.calendar.prev()},e.prototype.onNext=function(){this.calendar.next()},e.prototype.onToday=function(){this.calendar.changeView(j.timeGridDay,new Date)},e.prototype._getCalendarMode=function(e){for(var t=0;t<this.viewTypes.length;t++)if(this.viewTypes[t].value===e)return this.viewTypes[t]},e.prototype._updateViewParams=function(){var e=[this.calendar.view.type,H(this.calendar.getDate()).format("YYYY-M-D")];this.router.navigate(["/calendar/v/"+e.join("/")])},e.prototype._getDataView=function(){var e,t=this.route.snapshot.url,n=this._cacheModeView();return t.length>1&&(n=t[0].path,e=new Date(t[1].path)),e&&e.getTime()||(e=new Date),this._getCalendarMode(n)||(n=this._getCalendarMode(this.defaultMode).value),this._cacheModeView(n),{defaultView:n,defaultDate:e}},e.prototype._cacheModeView=function(e){if(void 0===e)return localStorage.getItem(this._modeCache);localStorage.setItem(this._modeCache,e)},e.prototype.reloadEvents=function(){this._hideViewDialog(),this._loadEvents(!0),this.calendarWidget.loadTodayEvents()},e.prototype._hideViewDialog=function(){this.calendarService.hideViewModal()},e.decorators=[{type:t.Component,args:[{selector:"inet-calendar",template:'<div class="calendar-app">\n    <div class="calendar-app__nav p-3">\n        <div class="d-flex align-items-center">\n            <div class="flex-grow-1" style="font-size: 16px;font-weight: 500;line-height: 18px">{{viewTitle}}</div>\n            <div class="btn-group" role="group">\n                <button (click)="onPrev()" type="button" class="btn btn-light"><i class="fa fa-chevron-left"></i></button>\n                <button (click)="onNext()" type="button" class="btn btn-light"><i class="fa fa-chevron-right"></i></button>\n            </div>\n        </div>\n        <div class="btn-group d-flex mt-3" role="group">\n            <button *ngFor="let type of viewTypes" (click)="changeView(type)"\n                    [ngClass]="{\'btn-light\': !type.active}" type="button" class="btn btn-primary flex-grow-1">\n                {{type.name}}\n            </button>\n        </div>\n        <button (click)="onToday()" [ngClass]="{\'btn-light\': !isToday}" type="button" class="btn btn-primary w-100 mt-3">Hôm nay</button>\n        <button (click)="createEvent()" type="button" class="btn btn-primary w-100 mt-3">Tạo sự kiện</button>\n        \x3c!-- <div (click)="createEvent()" class="calendar-add-btn mt-3 pt-2 pb-2 text-primary">\n            <i class="fa fa-plus mr-1"></i> Thêm sự kiện\n        </div> --\x3e\n        <div class="mt-3" style="margin-left: -15px;margin-right: -15px;">\n            <div class="ml-3 mr-3 pb-1 mb-1" style="border-bottom: 2px solid #007bff;font-weight: bold;">Sự kiện hôm nay</div>\n            <calendar-widget-today (onChange)="reloadEvents()"></calendar-widget-today>\n        </div>\n    </div>\n    <div class="calendar-app__body pr-1">\n        <div #calendarRef></div>\n    </div>\n</div>\n',styles:[".calendar-app{width:100%;height:calc(100vh - 60px);background:#fff;padding:0}.calendar-app__nav{height:100%;float:left;width:300px}.calendar-app__body{height:100%;overflow:hidden;background:rgba(0,0,0,.01)}.calendar-add-btn{cursor:pointer;font-weight:700}.calendar-add-btn:hover{opacity:.8}"]}]}],e.ctorParameters=function(){return[{type:F},{type:i.ActivatedRoute},{type:i.Router},{type:r.ResourceLoaderService},{type:r.NotificationService}]},e.propDecorators={calendarRef:[{type:t.ViewChild,args:["calendarRef"]}],calendarWidget:[{type:t.ViewChild,args:[B]}]},e}();var W=function(e,t,n){this.active=!1,this.name=e,this.value=t,this.options=n};var j={dayGridDay:"dayGridDay",timeGridDay:"timeGridDay",timeGridWeek:"timeGridWeek",dayGridMonth:"dayGridMonth"},q=function(){function e(e){this.calendarService=e,this.onRepeat=new t.EventEmitter,this.data={},this.dateFormat="DD/MM/YYYY",this.repeatTypes=U.repeatTypes,this.weekDays=U.weekDays}return e.prototype.ngAfterViewInit=function(){this.$modal=$(this.repeatModal.nativeElement),document.body.appendChild(this.repeatModal.nativeElement)},e.prototype.ngOnDestroy=function(){this.$modal.is(":visible")?this.$modal.modal("hide").on("hidden.bs.modal",(function(){$(this).remove()})):this.$modal.remove()},e.prototype.openRepeat=function(e){this.data=e||{},this.initData(),this.$modal.modal("show")},e.prototype.saveRepeat=function(){this.onRepeat.emit(this.getRepeatData())},e.prototype.changeWeekDay=function(e){e.checked=!e.checked,this.getWeekDayChecked().length<1&&(e.checked=!0)},e.prototype.changeDate=function(){this.start&&this.start.getTime()||(this.start=new Date),(!this.until||!this.until.getTime()||this.start>=this.until)&&(this.until=new Date(this.start.getFullYear(),this.start.getMonth(),this.start.getDate()),this.until.setMonth(this.until.getMonth()+1))},e.prototype.getRepeatData=function(){var e={rrmode:this.rrmode,lstart:this.start.getTime(),until:this.until.getTime(),wkdays:[]};return"WEEKLY"==e.rrmode&&(e.wkdays=this.getWeekDayChecked().map((function(e){return e.value}))),e},e.prototype.getWeekDayChecked=function(){return this.weekDays.filter((function(e){return e.checked}))},e.prototype.initData=function(){var e=this;this.rrmode=this.data.rrmode||"DAILY",this.start=new Date(this.data.lstart),this.until=new Date(this.data.until),this.changeDate(),this.data.wkdays?this.weekDays.forEach((function(t){e.data.wkdays.indexOf(t.value)>-1&&(t.checked=!0)})):this.weekDays[(this.start.getDay()+6)%7].checked=!0},e.decorators=[{type:t.Component,args:[{selector:"calendar-repeat-modal",template:'<div #repeatModal class="modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-body">\n                <div class="form-group">\n                    <label>Lặp lịch</label>\n                    <select [(ngModel)]="rrmode" class="form-control">\n                        <option *ngFor="let item of repeatTypes" [value]="item.value">{{ item.label }}</option>\n                    </select>\n                </div>\n                <div *ngIf="rrmode === \'WEEKLY\'" class="form-group" style="margin-bottom: 0;">\n                    <div class="check-box-i">\n                        <div *ngFor="let day of weekDays"\n                             [title]="day.title"\n                             (click)="changeWeekDay(day)"\n                             [ngClass]="{\'check-box-active\':day.checked}"\n                             class="check-box-item">{{ day.label }}</div>\n                    </div>\n                </div>\n                <div class="form-group">\n                    <label>Bắt đầu</label>\n                    <div class="input-group">\n                        <input\n                            class="form-control"\n                            #repeatStart="bsDatepicker"\n                            bsDatepicker\n                            [bsConfig]="{ dateInputFormat: dateFormat }"\n                            (ngModelChange)="changeDate()"\n                            [(ngModel)]="start">\n                        <div (click)="repeatStart.toggle()" class="input-group-append">\n                            <i class="fa fa-calendar input-group-text"></i>\n                        </div>\n                    </div>\n                </div>\n                <div class="form-group">\n                    <label>Kết thúc</label>\n                    <div class="input-group">\n                        <input\n                            class="form-control"\n                            #repeatUntil="bsDatepicker"\n                            bsDatepicker\n                            [bsConfig]="{ dateInputFormat: dateFormat }"\n                            (ngModelChange)="changeDate()"\n                            [(ngModel)]="until">\n                        <div (click)="repeatUntil.toggle()" class="input-group-append">\n                            <i class="fa fa-calendar input-group-text"></i>\n                        </div>\n                    </div>\n                </div>\n                <div class="form-action">\n                    <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">\n                        Đóng\n                    </button>\n                    <button type="button" class="ml-1 btn btn-primary btn-sm" data-dismiss="modal" (click)="saveRepeat()">\n                        Xong\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>',styles:[".modal-dialog{width:400px}.form-action{text-align:right;margin:15px 0}.check-box-i,.check-box-item{overflow:hidden}.check-box-item{float:left;width:30px;height:30px;line-height:30px;border-radius:50%;text-align:center;margin:0 10px 20px 0;font-size:12px;background:rgba(0,0,0,.1);cursor:pointer}.check-box-active{background:#438eb9;color:#fff}.check-box-disable{opacity:.5}"]}]}],e.ctorParameters=function(){return[{type:F}]},e.propDecorators={onRepeat:[{type:t.Output}],repeatModal:[{type:t.ViewChild,args:["repeatModal"]}],repeatStart:[{type:t.ViewChild,args:["repeatStart"]}],repeatUntil:[{type:t.ViewChild,args:["repeatUntil"]}]},e}();var G=function(){function e(){this.files=[],this.removable=!0,this.onClick=new t.EventEmitter,this.onRemove=new t.EventEmitter}return e.prototype.ngOnInit=function(){this._initFileEl()},e.prototype.clickFile=function(e,t){this.onClick.emit({file:e,event:t})},e.prototype.removeFile=function(e){var t=this.files.indexOf(e);t>-1&&(this.files.splice(t,1),this.onRemove.emit(e))},e.prototype.addFiles=function(e){for(var t=0;t<e.length;t++){var n=e[t];this._fileIsImage(n)&&(n.image=!0,this._readImageBase64(n)),this.files.push(n)}},e.prototype._initFileEl=function(){var e=this;this.fileEl&&this.fileEl.addEventListener("change",(function(t){var n=e.fileEl.files;n.length>0&&(e.addFiles(n),e.fileEl.value="")}))},e.prototype._readImageBase64=function(e){var t=new FileReader;t.readAsDataURL(e),t.onload=function(){e.url=t.result}},e.prototype._fileIsImage=function(e){return e.type&&e.type.indexOf("image")>-1},e.decorators=[{type:t.Component,args:[{selector:"file-list",template:'<ng-container *ngFor="let file of files">\n    <ng-template *ngTemplateOutlet="template ? template : fileItem; context: {file: file}">\n    </ng-template>\n</ng-container>\n<ng-template #fileItem let-file="file">\n    <div class="file-item" [title]="file.name" (click)="clickFile(file, $event)">\n        <img *ngIf="file.image; else icon" [src]="file.url" class="file-item__image">\n        <ng-template #icon>\n            <img [src]="file.name | fileIcon" class="file-item__image_type">\n            <div class="file-item__name">{{file.name}}</div>\n        </ng-template>\n        <i *ngIf="removable" (click)="removeFile(file)" class="fa fa-times file-item__remove"></i>\n    </div>\n</ng-template>',styles:[":host{display:block}.file-item{display:inline-block;text-align:center;width:80px;height:80px;border-radius:2px;position:relative;margin-right:5px;margin-bottom:5px;border:1px solid #ddd;overflow:hidden;padding:0 5px;cursor:pointer;background:#fff}.file-item__image{max-width:100%;position:absolute;left:50%;top:50%;transform:translate3d(-50%,-50%,0)}.file-item__image_type{max-width:20px;max-height:20px;margin-bottom:5px;margin-top:10px}.file-item__name{font-size:12px;line-height:13px;max-height:40px;overflow:hidden}.file-item__remove{position:absolute;right:3px;top:3px;cursor:pointer;width:24px;height:24px;line-height:24px;border-radius:50%;background:rgba(0,0,0,.2);color:#fff;text-align:center;font-size:12px}.file-item__remove:hover{background:rgba(0,0,0,.5)}"]}]}],e.propDecorators={fileEl:[{type:t.Input}],files:[{type:t.Input}],removable:[{type:t.Input}],template:[{type:t.Input}],onClick:[{type:t.Output}],onRemove:[{type:t.Output}]},e}();var z=function(){function e(e,t){this.calendarService=e,this.modalService=t,this.files=[]}return e.prototype.ngOnChanges=function(e){e.calEvent&&this._attachmentToFiles()},e.prototype.ngOnDestroy=function(){this.modalRef&&this.modalRef.hide()},e.prototype.viewAttachment=function(e,t){window.open(S.getFileViewUrl(e.data,null,t))},e.prototype.removeAttachment=function(e,t){e.id?(this._file=e,this.confirmMessage='Tệp tin <b>"'+e.name+'"</b> sẽ bị xoá?',this.modalRef=this.modalService.show(t)):this.fileList.removeFile(e)},e.prototype.removeFile=function(){this._file&&(this.modalRef.hide(),this.calendarService.deleteAttachment({fileID:this._file.id,element:this.calEvent.uuid},(function(){})),this.fileList.removeFile(this._file),this._file=null)},e.prototype._attachmentToFiles=function(){this.calEvent&&this.calEvent.attachments?this.files=this.calEvent.attachments.map((function(e){return{name:e.file,type:e.mimetype,size:e.size,id:e.gridfsUUID,data:e}})):this.files=[]},e.decorators=[{type:t.Component,args:[{selector:"calendar-attachment-list",template:'<file-list [template]="fileItem" [files]="files" [fileEl]="fileEl" [removable]="removable"></file-list>\n<ng-template #fileItem let-file="file">\n    <div class="file-item" [title]="file.name">\n        <img [src]="file.name | fileIcon" class="file-item__image">\n        <div class="file-item__name text-primary" (click)="viewAttachment(file, $event)">{{file.name}}</div>\n        <i *ngIf="removable" (click)="removeAttachment(file, template)"\n           class="fa fa-trash file-item__remove text-danger"></i>\n    </div>\n</ng-template>\n<ng-template #template>\n    <div class="modal-header">\n        <h4 class="modal-title pull-left">Thông báo</h4>\n        <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">\n            <span aria-hidden="true">&times;</span>\n        </button>\n    </div>\n    <div class="modal-body" [innerHTML]="confirmMessage"></div>\n    <div class="modal-footer">\n        <button type="button" class="btn btn-danger" (click)="removeFile()">Xóa</button>\n        <button type="button" class="btn btn-secondary" (click)="modalRef.hide()">Đóng</button>\n    </div>\n</ng-template>',styles:[".file-item{height:24px;line-height:24px;overflow:hidden;font-size:13px;cursor:pointer;margin-bottom:5px}.file-item__image{float:left;width:24px;height:24px;margin-right:10px}.file-item__name{float:left;max-width:80%;white-space:nowrap;overflow:hidden}.file-item__remove{width:24px;height:24px;line-height:24px;text-align:center}"]}]}],e.ctorParameters=function(){return[{type:F},{type:o.BsModalService}]},e.propDecorators={calEvent:[{type:t.Input}],fileEl:[{type:t.Input}],removable:[{type:t.Input}],fileList:[{type:t.ViewChild,args:[G]}]},e}();var K=a,J=function(){function e(e,t,n,i,r){var a=this;this.route=e,this.calendarService=t,this.notify=n,this.router=i,this.http=r,this.event={},this.formData={title:"",date:"",startTime:"",toTime:"",location:"",summary:"",state:"",notes:"",repeat:!1,_allday:""},this.attendees=[],this._attendees=[],this.attendeeSearch=new p.Observable((function(e){var t=a.attendeeModal.trim();t?(t=m(t),e.next(a._attendees.filter((function(e){return e._index.indexOf(t)>-1})).slice(0,10))):e.next([])})).pipe(u.debounceTime(200),u.distinctUntilChanged()),this.locationSearch=new p.Observable((function(e){var t=a.formData.location;t?a.calendarService.searchLocation(t,(function(t){return e.next(t.map((function(e){return e.content})))})):e.next([])})).pipe(u.debounceTime(200),u.distinctUntilChanged()),this.calendarService.ready((function(){var e=a.route.snapshot.paramMap;if(e.get("id"))a.calendarService.loadEvent({element:e.get("id")},(function(e){e?(a.event=e,a.attendees=e.attendees,e.members&&(a.event.myAttendee=e.members.find((function(e){return"CREATOR"!==e.role&&e.username===iNet.username}))),a._initForm()):a.eventNotFound=!0}));else{var t;try{(t=JSON.parse(atob(e.get("data")))).start=new Date(t.start),t.end=new Date(t.end)}catch(e){(t={}).start=new Date,t.start.setHours(t.start.getHours()+1,0,0,0),t.end=new Date(t.start.getTime()+36e5)}a.event=t,a._initForm()}})),this.calendarService.loadAttendees((function(e){return a._attendees=e}))}return e.prototype.ngAfterViewInit=function(){this.titleInput.nativeElement.focus()},e.prototype._initForm=function(){var e={title:this.event.subject||"",date:this.event.start,startTime:K(this.event.start).format("HH:mm"),toTime:K(this.event.end).format("HH:mm"),location:this.event.location||"",summary:this.event.summary||"",_allday:this.event.attribute&&"true"===this.event.attribute.allday||!1,state:"NEEDS_ACTION",notes:"",repeat:!1};this.event.myAttendee&&(e.state=this.event.myAttendee.state,e.notes=this.event.myAttendee.notes||""),Object.assign(this.formData,e),this.event.repeat&&this.setRepeatData(this.event.repeat)},e.prototype.createEvent=function(){var e=this,t=this._getFormData();t&&(this.http.showLoading("Đang xử lý..."),t.element?(this.calendarService.updateEvent(t,(function(t){t?e._onSuccess():e.notify.showMessage("Cập nhật lịch không thành công","error")})),this._updateMyState()):this.calendarService.createEvent(t,(function(t){t?e._onSuccess():e.notify.showMessage("Tạo lịch không thành công","error")})))},e.prototype._onSuccess=function(){this.router.navigate(["/calendar"])},e.prototype._getFormData=function(){if(this._validate()){var e=this.formData,t={subject:e.title,summary:e.summary,location:e.location,startTime:this.getMinutes(e._allday?"00:00":e.startTime),toTime:this.getMinutes(e._allday?"23:59":e.toTime),_allday:e._allday},n=K(e.date);return t.day=n.dayOfYear(),t.year=n.year(),this.event.uuid&&(t.element=this.event.uuid),e.repeat&&this.event.repeat&&(Object.assign(t,this.event.repeat),t.wkdays&&(t.wkdays=t.wkdays.join(","))),this.fileList.files.forEach((function(e,n){e.id||(t["file"+n]=e)})),t.location&&this.calendarService.saveLocation(t.location,(function(){})),t.attendee=this.attendees,S.modifyDataUpdate(t,this.event),t}},e.prototype._hasAttendee=function(e){for(var t=0;t<this.attendees.length;t++)if(this.attendees[t].username===e.username)return!0;return!1},e.prototype.addAttendee=function(e){var t=e.item;this.attendeeModal="",this._hasAttendee(t)||(t.type=_.USER,this.attendees.push(t))},e.prototype._validate=function(){return!(!this.formData.title.trim()||!this.formData.date)&&(!this.formData._allday&&this.getMinutes(this.formData.startTime)>=this.getMinutes(this.formData.toTime)?(this.timeError=!0,!1):(this.timeError=!1,!0))},e.prototype.setRepeatData=function(e){e?(this.event.repeat=e,this.repeatText=U.getRepeatText(e),this.formData.repeat=!0):this._clearRepeat()},e.prototype.openRepeat=function(e){e&&this.repeatModal.openRepeat({lstart:this.event.lstart}),this._clearRepeat()},e.prototype.onEditRepeat=function(e){e.preventDefault(),e.stopPropagation(),this.repeatModal.openRepeat(this.event.repeat)},e.prototype._clearRepeat=function(){this.repeatText="",this.formData.repeat=!1},e.prototype._updateMyState=function(){this.event.myAttendee&&this.calendarService.loadEvent({state:this.formData.state,notes:this.formData.notes,element:this.event.uuid},(function(){}))},e.prototype.goBack=function(){history.back()},e.prototype.onRemoveEvent=function(e){e&&(e.preventDefault(),e.stopPropagation()),this.viewDeleteModal.show()},e.prototype.getMinutes=function(e){var t=e.split(":");return 60*Number(t[0])+Number(t[1])},e.decorators=[{type:t.Component,args:[{selector:"app-calendar-form",template:'<div class="admin-layout">\n    <div class="container-fluid nav-fixed-top cp-toolbar">\n        <button (click)="goBack()" class="btn btn-sm btn-primary mr-1 ng-star-inserted" data-toggle="tooltip" type="button" title="Trở về">\n            <i class="fa fa-arrow-left"></i>\n        </button>\n        <button *ngIf="event.isCreator || !event.uuid" (click)="createEvent()" class="btn btn-sm btn-primary ng-star-inserted mr-1" data-toggle="tooltip" type="button" title="Lưu sự kiện">\n            <i class="fa fa-save"></i>\n        </button>\n        <button *ngIf="event.isCreator" (click)="onRemoveEvent($event)" class="btn btn-sm btn-danger ng-star-inserted" data-toggle="tooltip" type="button" title="Xóa sự kiện">\n            <i class="fa fa-trash"></i>\n        </button>\n    </div>\n    <div class="cp-content p-3">\n        <div class="card" *ngIf="eventNotFound">\n            <div class="card-body text-center">\n                Không tìm thấy lịch\n            </div>\n        </div>\n        <div [ngClass]="{\'hide\': eventNotFound}" class="row">\n                <div class="col-md-6">\n                    <div class="form-group">\n                        <label class="font-weight-bold">Tiêu đề (<span class="text-danger">*</span>):</label>\n                        <input #titleInput type="text" class="form-control"\n                               [(ngModel)]="formData.title"\n                               [ngClass]="{\'is-invalid\': titleInput.value.trim().length === 0}">\n                    </div>\n                    <div class="form-group row">\n                        <div class="col-6" style="padding-right:5px">\n                            <label class="font-weight-bold">Ngày sự kiện (<span class="text-danger">*</span>):</label>\n                            <input type="text" class="form-control"\n                                   [(ngModel)]="formData.date"\n                                   [ngClass]="{\'is-invalid\': formData.date.length === 0}"\n                                   #dp="bsDatepicker"\n                                   bsDatepicker\n                                   [bsConfig]="{dateInputFormat: \'DD/MM/YYYY\'}">\n                        </div>\n                        <div *ngIf="!allDay.checked" class="col-3" style="padding-right:5px;padding-left:5px">\n                            <label class="font-weight-bold">Từ giờ (<span class="text-danger">*</span>):</label>\n                            <input type="text" class="form-control"\n                                   [(ngModel)]="formData.startTime"\n                                   [ngClass]="{\'is-invalid\': (timeError || formData.startTime.length === 0)}"\n                                   timePicker\n                                   [timePickerModal]="timeStartModal">\n                            <time-picker-modal #timeStartModal></time-picker-modal>\n                        </div>\n                        <div *ngIf="!allDay.checked" class="col-3" style="padding-left:5px">\n                            <label class="font-weight-bold">Đến giờ (<span class="text-danger">*</span>):</label>\n                            <input type="text" class="form-control"\n                                   [(ngModel)]="formData.toTime"\n                                   [ngClass]="{\'is-invalid\': (timeError || formData.toTime.length === 0)}"\n                                   timePicker\n                                   [timePickerModal]="timeEndModal">\n                            <time-picker-modal #timeEndModal></time-picker-modal>\n                        </div>\n                    </div>\n                    <div class="form-group form-check">\n                        <input #allDay [(ngModel)]="formData._allday" type="checkbox" id="_allday" class="form-check-input" value="true"/>\n                        <label class="form-check-label font-weight-bold" for="_allday">Cả ngày</label>\n                    </div>\n                    <div class="form-group form-check">\n                        <input (click)="openRepeat(repeat.checked)"\n                               #repeat\n                               [(ngModel)]="formData.repeat"\n                               class="form-check-input"\n                               id="repeat" type="checkbox" value="true"/>\n                        <label class="form-check-label font-weight-bold" for="repeat">Lặp lịch</label>\n                        <span *ngIf="repeatText">\n                            <b>:</b> {{repeatText}}\n                            <i (click)="onEditRepeat($event)" class="fa fa-pencil" style="padding: 5px;margin: -5px 0;cursor: pointer;" title="Chỉnh sửa"></i>\n                        </span>\n                    </div>\n                    <div class="form-group">\n                        <button (click)="fileAttachment.click()" title="Tập tin đính kèm" type="button" class="btn btn-primary btn-sm rounded">\n                            <i class="fa fa-cloud-upload pr-1" aria-hidden="true"></i>\n                            <span>Đính kèm</span>\n                            <input #fileAttachment type="file" multiple style="display:none">\n                        </button>\n                        <div style="margin-top: 10px">\n                            <calendar-attachment-list\n                                    [calEvent]="event"\n                                    [removable]="true"\n                                    [fileEl]="fileAttachment"></calendar-attachment-list>\n                        </div>\n                    </div>\n                    <div class="form-group">\n                        <label class="font-weight-bold">Địa điểm:</label>\n                        <input type="text" class="form-control"\n                               [(ngModel)]="formData.location"\n                               [typeahead]="locationSearch">\n                    </div>\n                    <div class="form-group">\n                        <label class="font-weight-bold">Mô tả:</label>\n                        <textarea (keydown.enter)="$event.stopPropagation()" type="text" class="form-control"\n                                  [(ngModel)]="formData.summary"></textarea>\n                    </div>\n                </div>\n                <div class="col-md-6">\n                    <div [hidden]="!event.myAttendee" class="form-group">\n                        <label class="font-weight-bold">Bạn có tham dự không?</label>\n                        <div class="input-group">\n                            <select [(ngModel)]="formData.state" class="attendee-select form-control" style="margin-right:-3px">\n                                <option value="ACCEPTED">Có</option>\n                                <option value="DECLINED">Không</option>\n                                <option value="NEEDS_ACTION">Có thể</option>\n                            </select>\n                            <input [(ngModel)]="formData.notes" type="text" class="form-control" placeholder="Ghi chú">\n                        </div>\n                    </div>\n                    <div class="form-group">\n                        <label class="font-weight-bold">Thành phần: </label>\n                        <ng-template #attendeeTemplate let-attendee="item">\n                            <div class="attendee-item">\n                                <img userAvatar [usercode]="attendee.username">\n                                <div>{{attendee.fullname}}</div>\n                            </div>\n                        </ng-template>\n                        <input type="text" class="form-control"\n                               #attendeeInput\n                               [(ngModel)]="attendeeModal"\n                               [typeahead]="attendeeSearch"\n                               [typeaheadItemTemplate]="attendeeTemplate"\n                               (typeaheadOnSelect)="addAttendee($event)"/>\n                    </div>\n                    <div class="form-group">\n                        <calendar-attendee-list [attendees]="attendees" [editable]="true"></calendar-attendee-list>\n                    </div>\n                </div>\n            </div>\n    </div>\n    <calendar-repeat-modal #repeatModal (onRepeat)="setRepeatData($event)"></calendar-repeat-modal>\n</div>\n<calendar-dialog-delete #dialogRemove [calEvent]="event" (onDelete)="goBack()" hidden></calendar-dialog-delete>\n',styles:[".attendee-select{background:#e9ecef;width:90px;padding-right:5px;padding-left:5px;flex:none}.attendee-list-container{overflow:auto;max-height:200px;box-shadow:rgba(0,0,0,.14) 0 8px 10px 1px,rgba(0,0,0,.12) 0 3px 14px 2px,rgba(0,0,0,.2) 0 5px 5px -3px;border-radius:4px;margin-top:5px}.form-check-input{opacity:1!important;margin-top:1px}.attendee-item{display:flex;margin:0 -10px;align-items:center}.attendee-item>img{width:30px;height:30px;border-radius:50%;margin-right:10px}"]}]}],e.ctorParameters=function(){return[{type:i.ActivatedRoute},{type:F},{type:r.NotificationService},{type:i.Router},{type:r.HttpClientService}]},e.propDecorators={repeatModal:[{type:t.ViewChild,args:["repeatModal"]}],viewDeleteModal:[{type:t.ViewChild,args:["dialogRemove"]}],titleInput:[{type:t.ViewChild,args:["titleInput"]}],attendeeInput:[{type:t.ViewChild,args:["attendeeInput"]}],fileList:[{type:t.ViewChild,args:[z]}]},e}();var X=a,Q=function(){function e(){this.dateFormat="MMMM/YYYY",this.locale="vi",this.firstDay=1,this.limitEvent=3,this.view=Z.MONTH,this.onChange=new t.EventEmitter,this.onActive=new t.EventEmitter,this.dates=[],this.weekDates=[]}return Object.defineProperty(e.prototype,"date",{get:function(){return new Date(this._date)},set:function(e){var t;(t=e&&e.getTime()?new Date(e):new Date).setHours(0,0,0,0),this.view===Z.MONTH&&t.setDate(1),this._date&&t.getTime()===this._date.getTime()||(this._date=t,this._render())},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this._date||(this.date=new Date)},e.prototype.setEvents=function(e,t){var n=this._getDateViewer(t);n&&(n.events=e)},e.prototype.clearEvents=function(){this.dates.forEach((function(e){return e.events=null}))},e.prototype.toDay=function(){this.date=new Date},e.prototype.prev=function(){this.view===Z.MONTH?this._prevMonth():this._prevWeek(),this._render()},e.prototype.next=function(){this.view===Z.MONTH?this._nextMonth():this._nextWeek(),this._render()},e.prototype.activeDate=function(e){this.dateActive=e,e.outOfRange&&(this.date=e.date),this.onActive.emit(e)},e.prototype.focusDate=function(e){var t=this._getDateViewer(e);t&&this.activeDate(t)},e.prototype._nextMonth=function(){this._date.setMonth(this._date.getMonth()+1)},e.prototype._prevMonth=function(){this._date.setMonth(this._date.getMonth()-1)},e.prototype._nextWeek=function(){this._date.setDate(this._date.getDate()+7)},e.prototype._prevWeek=function(){this._date.setDate(this._date.getDate()-7)},e.prototype._render=function(){this.view===Z.MONTH?this._renderMonth():this._renderWeek(),this.onChange.emit(this.date)},e.prototype._renderMonth=function(){var e=this._getDateStartWeek();for(this.dates=[],this.weekDates=[];this.weekDates.length<=6&&(this.weekDates.push(this._createWeekDate(e)),e.getMonth()===this._date.getMonth()););this._renderTitle(),this._renderWeekTitle(this.weekDates[0])},e.prototype._renderWeek=function(){var e=this._getDateStartWeek();this.dates=[],this.weekDates=[this._createWeekDate(e)],this.weekDates[0].forEach((function(e){return e.outOfRange=!1})),this._renderTitle(),this._renderWeekTitle(this.weekDates[0])},e.prototype._createWeekDate=function(e){for(var t=[],n=0;n<7;n++){var i={date:new Date(e),time:e.getTime(),outOfRange:this._date.getMonth()!==e.getMonth(),today:this._isToday(e)};t.push(i),this.dates.push(i),e.setDate(e.getDate()+1)}return t},e.prototype._renderWeekTitle=function(e){var t=this;this.weekTitles=[],e.forEach((function(e){t.weekTitles.push(X(e.date).locale(t.locale).format("dd"))}))},e.prototype._renderTitle=function(){this.dateTitle=X(this._date).locale(this.locale).format(this.dateFormat)},e.prototype._getDateStartWeek=function(){var e=new Date(this._date),t=e.getDay()-this.firstDay;return e.getDay()<this.firstDay&&(t+=7),e.setDate(e.getDate()-t),e},e.prototype._isToday=function(e){var t=new Date;return t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()},e.prototype._getDateViewer=function(e){var t=new Date(e);t.setHours(0,0,0,0);for(var n=0;n<this.dates.length;n++)if(this.dates[n].time===t.getTime())return this.dates[n]},e.decorators=[{type:t.Component,args:[{selector:"calendar-viewer",template:'<div class="calendar-viewer">\n\n  <div role="row" class="calendar-viewer__head">\n    <i (click)="next()" class="calendar-viewer__button fa fa-chevron-right"></i>\n    <i (click)="toDay()" class="calendar-viewer__button fa fa-circle" style="font-size:10px"></i>\n    <i (click)="prev()" class="calendar-viewer__button fa fa-chevron-left"></i>\n    <div class="calendar-viewer__title">{{dateTitle}}</div>\n  </div>\n\n  <div role="grid" class="calendar-viewer__body">\n    <div role="row" class="calendar-viewer__row">\n      <div class="calendar-viewer__th" *ngFor="let title of weekTitles">{{title}}</div>\n    </div>\n    <div *ngFor="let week of weekDates" role="row" class="calendar-viewer__row">\n      <div *ngFor="let dateViewer of week"\n           [ngClass]="{\'light-cell\': dateViewer.outOfRange, \'today-cell\': dateViewer.today}" class="calendar-viewer__td">\n        <div (click)="activeDate(dateViewer)" class="calendar-viewer__date" [ngClass]="{\'active\': dateViewer.time === dateActive?.time}">\n          <span>{{dateViewer.date.getDate()}}</span>\n          <div *ngIf="dateViewer.events" class="calendar-viewer__events">\n            <div *ngFor="let event of dateViewer.events" [ngStyle]="event.style"></div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n</div>\n',styles:[".calendar-viewer{padding:10px 0}.calendar-viewer__head{font-size:14px;padding:0 5px 0 15px;height:40px;color:#757575}.calendar-viewer__title{overflow:hidden;line-height:40px;font-weight:700;text-transform:uppercase}.calendar-viewer__button{float:right;margin:2px 0;text-align:center}.calendar-viewer__body{display:table;table-layout:fixed;width:100%;text-align:center;color:#212121;font-size:14px}.calendar-viewer__row{display:table-row}.calendar-viewer__th{display:table-cell;vertical-align:middle;height:24px;font-size:12px;color:#757575;font-weight:700}.calendar-viewer__td{display:table-cell;vertical-align:middle;height:44px}.calendar-viewer__td.light-cell{opacity:.2}.calendar-viewer__td.today-cell .calendar-viewer__button,.calendar-viewer__td.today-cell .calendar-viewer__date{color:#dc3545}.calendar-viewer__button,.calendar-viewer__date{height:36px;width:36px;line-height:36px;border-radius:50%;cursor:pointer;display:inline-block;position:relative}.calendar-viewer__button:hover,.calendar-viewer__date:hover{background-color:rgba(0,0,0,.1)}.active.calendar-viewer__button,.calendar-viewer__date.active{background-color:#438eb9!important;color:#fff!important}.active.calendar-viewer__button .calendar-viewer__events div,.calendar-viewer__date.active .calendar-viewer__events div{background-color:#fff!important}.calendar-viewer__events{position:absolute;left:5px;right:5px;bottom:4px;text-align:center;overflow:hidden;line-height:0;height:6px}.calendar-viewer__events div{width:4px;height:4px;border-radius:50%;margin:0 1px;background-color:#438eb9;display:inline-block}"]}]}],e.ctorParameters=function(){return[]},e.propDecorators={dateFormat:[{type:t.Input}],locale:[{type:t.Input}],firstDay:[{type:t.Input}],limitEvent:[{type:t.Input}],view:[{type:t.Input}],date:[{type:t.Input}],onChange:[{type:t.Output}],onActive:[{type:t.Output}]},e}();var Z={MONTH:"month",WEEK:"week"},ee=function(){function e(e){this.calendarService=e,this.locale="vi",this.dateFormat="dddd, D/M/YYYY",this.colors=["#438EB9","#3CA54A","#FF9800","#EF5B49","#77901B","#7D5392","#808080"]}return e.prototype.ngOnInit=function(){this.loadEvents()},e.prototype.changeMonth=function(e){this._date=e,this.calendarViewer.clearEvents(),this.loadEvents()},e.prototype.activeDate=function(e){this.activeDateViewer=e,this.activeDateTitle=S.formatDate(e.date,this.dateFormat)},e.prototype.loadEvents=function(){var e=this;this._date&&this.calendarService.loadMonthEvents(this._date,(function(t){t.sort((function(e,t){return e.day-t.day})),e._groupEventByDate(t).forEach((function(t){e.calendarViewer.setEvents(t.events,t.date)})),e.activeDateViewer||e.calendarViewer.focusDate(new Date)}))},e.prototype.onViewEvent=function(e,t,n){var i=this;this.calendarService.viewEvent(e,t,n,(function(){return i.loadEvents()}))},e.prototype._groupEventByDate=function(e){var t=this,n=[];return e.forEach((function(e){var i,r=new Date(e.from);r.setHours(0,0,0,0);for(var a=0;a<n.length;a++)if(n[a].date.getTime()===r.getTime()){i=n[a];break}i||(i={events:[],date:r},n.push(i)),t._initEventStatus(e),i.events.push(e)})),n.forEach((function(e){e.events.sort((function(e,t){return e.startTime-t.startTime}))})),n},e.prototype._initEventStatus=function(e){var t=new Date;e.progressing=e.start<t&&e.end>t,e.ended=e.end<t,e.pending=e.start>t,e.progressing?(e.statusText="Đang diễn ra",e.statusColor=this.colors[0]):e.pending?(e.statusText="Chưa diễn ra",e.statusColor=this.colors[5]):(e.statusText="Kết thúc",e.statusColor=this.colors[6]),e.style={"background-color":this.colors[e.mode]}},e.decorators=[{type:t.Component,args:[{selector:"calendar-widget",template:'<calendar-viewer #calendarViewer [locale]="locale" (onChange)="changeMonth($event)" (onActive)="activeDate($event)"></calendar-viewer>\n<div class="calendar-container" *ngIf="activeDateViewer?.events?.length">\n    <div class="calendar-event__date">{{activeDateTitle}}</div>\n    <div #viewToggle class="calendar-body">\n        <div *ngFor="let event of activeDateViewer.events" #targetEl (click)="onViewEvent(event, $event, targetEl)"  class="calendar-event">\n            <div  class="calendar-event__state" [ngStyle]="event.style"></div>\n            <div class="calendar-event__content">\n                <div class="calendar-event__title">\n                    {{event.subject}}\n                    <div class="calendar-event__progress" [style.color]="event.statusColor">{{event.statusText}}</div>\n                </div>\n                <div class="calendar-event__text">\n                    <i class="fa fa-clock-o calendar-event__icon"></i>\n                    {{event.hourStr}}\n                </div>\n                <div *ngIf="event.location" class="calendar-event__text">\n                    <i class="fa fa-map-marker calendar-event__icon"></i>\n                    {{event.location}}\n                </div>\n            </div>\n        </div>\n    </div>\n</div>',styles:[".calendar-container{padding-bottom:15px}.calendar-event__date{font-size:12px;color:#757575;font-weight:700;margin:0 15px 5px;padding-top:15px;text-transform:uppercase;border-top:1px solid #ddd}.calendar-body{max-height:300px;overflow:hidden auto}.calendar-event{padding:5px 15px;color:#212121;cursor:pointer}.calendar-event:hover{background-color:rgba(0,0,0,.05)}.calendar-event__state{width:8px;height:8px;border-radius:50%;margin:5px 10px 0 0;float:left}.calendar-event__content{overflow:hidden}.calendar-event__title{font-size:14px;line-height:18px;margin-bottom:3px}.calendar-event__progress{font-size:11px;text-transform:uppercase;font-weight:700}.calendar-event__text{font-size:12px;line-height:18px;color:#757575}.calendar-event__icon{width:12px}"]}]}],e.ctorParameters=function(){return[{type:F}]},e.propDecorators={calendarViewer:[{type:t.ViewChild,args:["calendarViewer"]}],viewToggle:[{type:t.ViewChild,args:["viewToggle"]}],locale:[{type:t.Input}],dateFormat:[{type:t.Input}]},e}();var te=function(){function e(e){this.attendees=[],this.editable=!1,this.expandable=!1,this.onDelete=new t.EventEmitter,this.expandEnable=!0,this.expanded=!0,this.differ=e.find([]).create(null)}return e.prototype.ngDoCheck=function(){this.differ.diff(this.attendees)&&this.generateDetail()},e.prototype.removeAttendee=function(e){var t=this.attendees.indexOf(e);t>-1&&(this.attendees.splice(t,1),this.onDelete.emit())},e.prototype.generateDetail=function(){var e=0,t=0,n=0,i=[];this.attendees.forEach((function(i){i.state===k.ACCEPTED?(i._stateText="Tham dự",e++):i.state===k.DECLINED?(i._stateText="Không tham dự",t++):i.state===k.NEEDS_ACTION&&(i._stateText="Chưa quyết định",n++)})),e&&i.push(e+" có"),t&&i.push(t+" không"),n&&i.push(n+" chưa quyết định"),this.stateText=i.join(", ")},e.prototype.expandAttendees=function(){this.expandEnable&&(this.expanded=!this.expanded)},e.prototype.getStateIcon=function(e){var t;switch(e.state){case"ACCEPTED":case"DECLINED":t="fa-check accept";break;default:t="fa-check unknown"}return"attendee-info fa "+t},e.decorators=[{type:t.Component,args:[{selector:"calendar-attendee-list",template:'<div *ngIf="attendees?.length" (click)="expandAttendees()" [ngClass]="expandEnable ? \'expandable\' : \'\'"\n     class="attendee-detail">\n    <span class="attendee-number">{{attendees.length}} khách</span>\n    <i *ngIf="expandEnable" class="fa fa-angle-{{expanded ? \'up\' : \'down\'}}" style="padding-left: 10px"></i>\n    <div class="attendee-desc">{{stateText}}</div>\n</div>\n<div [ngClass]="{\'hide\': !expanded}">\n    <div class="attendee-item" *ngFor="let attendee of attendees">\n        <div>\n            <img *ngIf="attendee.username; else aliasAvatar"\n                 class="attendee-avatar"\n                 userAvatar [usercode]="attendee.username">\n            <ng-template #aliasAvatar>\n                <i class="attendee-avatar fa fa-question"></i>\n            </ng-template>\n        </div>\n        <i *ngIf="attendee.state" [title]="attendee._stateText" [ngClass]="getStateIcon(attendee)"></i>\n        <div class="attendee-content">\n            <b>{{attendee.fullname || attendee.alias}} </b>\n            <span> {{attendee.notes}}</span>\n        </div>\n        <div *ngIf="editable">\n            <i class="attendee-remove fa fa-times" (click)="removeAttendee(attendee)"></i>\n        </div>\n    </div>\n</div>',styles:[".attendee-detail{margin-bottom:2px;line-height:16px;display:inline-block}.attendee-detail.expandable{cursor:pointer}.attendee-detail.expandable:hover{background:rgba(0,0,0,.04)}.attendee-number{font-size:14px}.attendee-desc{font-size:13px;color:rgba(0,0,0,.5)}.attendee-item{position:relative;padding:4px 0;overflow:hidden;display:flex;align-items:center}.attendee-item:hover{background:rgba(0,0,0,.04)}.attendee-item:hover .attendee-remove{display:block}.attendee-item .attendee-remove{flex-grow:0;color:rgba(0,0,0,.3);width:24px;height:24px;line-height:24px;cursor:pointer;text-align:center;display:none;font-size:12px}.attendee-avatar{flex-grow:0;width:24px;height:24px;border-radius:50%;margin-right:15px}i.attendee-avatar{text-align:center;line-height:24px;font-size:20px;background:#6c757d;color:#fff}.attendee-content{flex-grow:1;overflow:hidden;font-size:13px;line-height:16px;color:rgba(0,0,0,.5)}.attendee-content b{color:rgba(0,0,0,.7)}.attendee-info{position:absolute;top:50%;left:18px;font-size:8px;width:14px;height:14px;line-height:12px;border-radius:50%;border:1px solid #fff;color:#fff;text-align:center}.attendee-info.accept{background:#28a745}.attendee-info.reject{background:#dc3545}.attendee-info.unknown{background:#6c757d}"]}]}],e.ctorParameters=function(){return[{type:t.IterableDiffers}]},e.propDecorators={attendees:[{type:t.Input}],editable:[{type:t.Input}],expandable:[{type:t.Input}],onDelete:[{type:t.Output}]},e}();var ne=[{path:"calendar/v",children:[{path:"**",component:Y}]},{path:"calendar/event",children:[{path:":id",component:J},{path:"**",redirectTo:"create",pathMatch:"full"}]},{path:"calendar/create",children:[{path:":data",component:J},{path:"**",component:J}]},{path:"calendar",redirectTo:"calendar/v",pathMatch:"full"}],ie=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[i.RouterModule.forChild(ne)],exports:[i.RouterModule]}]}],e}(),re=["unknown","text","archive","audio","video","png","jpg","gif","tiff","svg","ai","psd","dwg","avi","fla","mp2","mp3","mp4","aac","flac","wma","wav","mxf","iso","mdf","nrg","zip","7z","arj","rar","pdf","doc","rtf","txt","xls","ppt","css","csv","html","json","js","xml","dbf","exe"],ae=["doc","docx","odt","ods","xls","xlsx","ppt","pps","pptm","pptx","pot","potx","dot","dotx","docm","dotx","csv","sxw"],oe=["pdf","png","jpg","jpeg","gif"],se=function(){function e(){}return e.prototype.getImagePath=function(){var e=iNet.commonImageFolder,t=e.lastIndexOf("/");return t===e.length-1?e.substring(0,t):e},e.prototype.getFileFormatPath=function(){return this.getImagePath()+"/format"},e.prototype.getUrlByExt=function(e){var t=this.getFileFormatPath();return re.indexOf(e)>-1?t+"/"+e.toLowerCase()+".svg":t+"/unknown.svg"},e.prototype.getUrlByName=function(e){return this.getUrlByExt(this.getExtByName(e))},e.prototype.getExtByName=function(e){return e.split(".").pop().toLowerCase()||"unknown"},e.prototype.getEditFormats=function(){return ae},e.prototype.getViewFormats=function(){return oe},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[]},e}(),le=function(){function e(e){this.formatService=e}return e.prototype.transform=function(e){return this.formatService.getExtByName(e)},e.decorators=[{type:t.Pipe,args:[{name:"fileExt"}]}],e.ctorParameters=function(){return[{type:se}]},e}();var de=function(){function e(e){this.formatService=e}return e.prototype.transform=function(e){return this.formatService.getUrlByName(e)},e.decorators=[{type:t.Pipe,args:[{name:"fileIcon"}]}],e.ctorParameters=function(){return[{type:se}]},e}();var ce=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[f.CommonModule],declarations:[de,le,G],exports:[de,le,G],providers:[se]}]}],e}(),ue=function(){function e(e){this.el=e,this.arrowkeys=!0,this.hourStep=1,this.minuteStep=15,this.mousewheel=!0,this.readonlyInput=!1,this.secondsStep=10,this.showMinutes=!0,this.showSpinners=!0,this.onChange=new t.EventEmitter}return Object.defineProperty(e.prototype,"time",{get:function(){return this._timeDate},set:function(t){this._timeDate=t,this.timeStr=e._formatDate(t),this.onChange.emit(this.timeStr)},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var e=this;this.$modal=$(this.el.nativeElement).detach().addClass("modal"),this.$modalContent=this.$modal.find(".time-picker-modal"),this.$modal.on("mousedown click",(function(t){t.target.isSameNode(e.$modal[0])&&e.close()}))},e.prototype.ngOnDestroy=function(){this.$modal.remove()},e.prototype.close=function(){this.$modal.detach()},e.prototype.open=function(e){this.$modalContent.css(e),document.body.appendChild(this.$modal[0])},e._formatDate=function(e){return e&&e.getTime()?("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2):""},e.decorators=[{type:t.Component,args:[{selector:"time-picker-modal",template:'<div class="time-picker-modal">\n    <timepicker #timePicker [(ngModel)]="time"\n                [arrowkeys]="arrowkeys"\n                [max]="max"\n                [min]="min"\n                [minuteStep]="minuteStep"\n                [mousewheel]="mousewheel"\n                [readonlyInput]="readonlyInput"\n                [secondsStep]="secondsStep"\n                [showMeridian]="showMeridian"\n                [showMinutes]="showMinutes"\n                [showSeconds]="showSeconds"\n                [showSpinners]="showSpinners">\n\n    </timepicker>\n</div>',styles:[":host(.modal){display:block;z-index:1101}.time-picker-modal{position:absolute;border:1px solid rgba(0,0,0,.2);background:#fff;border-radius:4px;padding:10px}"]}]}],e.ctorParameters=function(){return[{type:t.ElementRef}]},e.propDecorators={arrowkeys:[{type:t.Input}],hourStep:[{type:t.Input}],max:[{type:t.Input}],min:[{type:t.Input}],minuteStep:[{type:t.Input}],mousewheel:[{type:t.Input}],readonlyInput:[{type:t.Input}],secondsStep:[{type:t.Input}],showMeridian:[{type:t.Input}],showMinutes:[{type:t.Input}],showSeconds:[{type:t.Input}],showSpinners:[{type:t.Input}],time:[{type:t.Input}],onChange:[{type:t.Output}],timePicker:[{type:t.ViewChild,args:["timePicker"]}]},e}();var pe={provide:n.NG_VALUE_ACCESSOR,useExisting:t.forwardRef((function(){return he})),multi:!0},he=function(){function e(e){this.el=e,this.valueChange=new t.EventEmitter}return e.prototype.onFocus=function(){this.open(),this.onChange()},e.prototype.onChange=function(){this.timePickerModal.time=this.getDateInput()},e.prototype.ngOnInit=function(){var e=this;this.timePickerModal||console.error("[TimePickerModalDirective] Missing timePickerModal"),this.timePickerModal.onChange.subscribe((function(t){e.writeValue(t),e.propagateChange&&e.propagateChange(t)}))},e.prototype.writeValue=function(e){this.el.nativeElement.value=e,this.valueChange.emit(e)},e.prototype.registerOnChange=function(e){this.propagateChange=e},e.prototype.registerOnTouched=function(e){},e.prototype.open=function(){var e=this.el.nativeElement.getBoundingClientRect(),t={left:e.left};e.top+150<innerHeight?t.top=e.top+e.height+2:t.bottom=e.top-2,this.timePickerModal.open(t)},e.prototype.close=function(){this.timePickerModal.close()},e.prototype.getDateInput=function(){var e=this.getValue();if(!e)return null;var t,n=new Date;if(n.setMinutes(0),e.indexOf(":")>-1)t=e.split(":");else{t=[];for(var i=0;i<e.length+1;i+=2)t.push(e.substr(i,2))}return t[0]=Number(t[0]),t[1]=Number(t[1])||0,t[0]||0===t[0]?(n.setHours(t[0]),n.setMinutes(t[1]),n):null},e.prototype.getValue=function(){return this.el.nativeElement.value.trim()},e.decorators=[{type:t.Directive,args:[{selector:"[timePicker]",providers:[pe]}]}],e.ctorParameters=function(){return[{type:t.ElementRef}]},e.propDecorators={valueChange:[{type:t.Output}],timePickerModal:[{type:t.Input}],onFocus:[{type:t.HostListener,args:["focus"]}],onChange:[{type:t.HostListener,args:["change"]}]},e}();var fe=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[o.TimepickerModule.forRoot(),f.CommonModule,n.FormsModule],declarations:[he,ue],exports:[he,ue]}]}],e}(),ge=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[o.BsDatepickerModule.forRoot(),o.TimepickerModule.forRoot(),o.ModalModule.forRoot(),o.TypeaheadModule.forRoot(),n.ReactiveFormsModule,f.CommonModule,n.FormsModule,r.CoreModule,ce,f.CommonModule,fe,h.HttpClientModule,ie],exports:[Y,q,J,B,ee,L,te,N,z,Q],declarations:[Y,q,J,B,ee,L,te,N,z,Q],providers:[F,r.ResourceLoaderService,r.SuggestionService],entryComponents:[L]}]}],e}();e.CalendarComponent=Y,e.CalendarFormComponent=J,e.CalendarMode=j,e.CalendarModule=ge,e.CalendarService=F,e.CalendarViewMode=W,e.ɵa=ce,e.ɵb=de,e.ɵc=se,e.ɵd=le,e.ɵe=G,e.ɵf=fe,e.ɵg=pe,e.ɵh=he,e.ɵi=ue,e.ɵj=ie,e.ɵk=B,e.ɵl=z,e.ɵm=q,e.ɵn=ee,e.ɵo=L,e.ɵp=te,e.ɵq=N,e.ɵr=Q,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=inet-calendar.umd.min.js.map