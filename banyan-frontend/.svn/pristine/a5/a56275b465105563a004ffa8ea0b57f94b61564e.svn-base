/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EXT_ACTION, EXT_HASH_ALG } from "./Constants";
import * as JSEncryptModule from "jsencrypt";
/** @type {?} */
const JSEncrypt = JSEncryptModule.JSEncrypt;
export class TokenSimulator {
    /**
     * @param {?} action
     * @param {?=} data
     * @return {?}
     */
    static postToExtension(action, data) {
        /** @type {?} */
        const promise = new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        (resolve) => {
            switch (action) {
                case EXT_ACTION.GET_INFO:
                    resolve({ data: {
                            version: '0.0.1',
                            nativeVersion: 1,
                            nativeLatestVersion: 1,
                        } });
                    break;
                case EXT_ACTION.SIGN_HASH:
                    this._sign(data, resolve);
                    break;
                case EXT_ACTION.GET_CERTS:
                    resolve({ data: this._certs });
                    break;
            }
        }));
        return promise;
    }
    /**
     * @param {?} data
     * @param {?} resolve
     * @return {?}
     */
    static _sign(data, resolve) {
        try {
            /** @type {?} */
            const cert = this._getCert(data.serial);
            /** @type {?} */
            const response = {
                serial: cert.serial,
                cert: cert.cert,
                hashAlg: data.hashAlg || EXT_HASH_ALG.SHA1
            };
            /** @type {?} */
            const jsEncrypt = new JSEncrypt(null);
            jsEncrypt.setPrivateKey(cert.pk);
            if (data.hashs) {
                response.signatures = [];
                data.hashs.forEach((/**
                 * @param {?} hash
                 * @return {?}
                 */
                (hash) => {
                    response.signatures.push(jsEncrypt.sign(hash, (/**
                     * @param {?} str
                     * @return {?}
                     */
                    (str) => this._base64toHEX(str)), data.hashAlg.toLocaleLowerCase()));
                }));
            }
            else {
                response.signature = jsEncrypt.sign(data.hash, (/**
                 * @param {?} str
                 * @return {?}
                 */
                (str) => {
                    return this._base64toHEX(str);
                }), data.hashAlg.toLocaleLowerCase());
            }
            resolve((/** @type {?} */ ({
                data: response
            })));
        }
        catch (e) {
            resolve((/** @type {?} */ ({
                error: "SIGN_ERROR",
                errorMsg: e.message
            })));
        }
    }
    /**
     * @param {?} serial
     * @return {?}
     */
    static _getCert(serial) {
        for (let i = 0; i < this._certs.length; i++) {
            if (this._certs[i].serial === serial) {
                return this._certs[i];
            }
        }
        return this._certs[0];
    }
    /**
     * @param {?} base64
     * @return {?}
     */
    static _base64toHEX(base64) {
        /** @type {?} */
        var raw = atob(base64);
        /** @type {?} */
        var HEX = '';
        for (let i = 0; i < raw.length; i++) {
            /** @type {?} */
            var _hex = raw.charCodeAt(i).toString(16);
            HEX += (_hex.length == 2 ? _hex : '0' + _hex);
        }
        return HEX;
    }
}
TokenSimulator._certs = [
    {
        subject: "C=VN, ST=HCM, L=HCM, O=Calista, OU=Calista, , CN=iNet Solutions Corporation",
        issuer: "C=VN, CN=Viettel-CA, O=iNet, OU=iNet Solutions",
        validFrom: "2019-07-06",
        validTo: "2030-07-07",
        serial: "843F1DF405009A62",
        cert: "MIICezCCAeQCCQCEPx30BQCaYjANBgkqhkiG9w0BAQsFADCBgTELMAkGA1UEBhMC" +
            "Vk4xDDAKBgNVBAgMA0hDTTEMMAoGA1UEBwwDSENNMRAwDgYDVQQKDAdDYWxpc3Rh" +
            "MRAwDgYDVQQLDAdDYWxpc3RhMRAwDgYDVQQDDAdDYWxpc3RhMSAwHgYJKoZIhvcN" +
            "AQkBFhFpbmZvQGluZXRjbG91ZC52bjAeFw0xOTA3MDgwNjM2MDNaFw0yMDA3MDcw" +
            "NjM2MDNaMIGBMQswCQYDVQQGEwJWTjEMMAoGA1UECAwDSENNMQwwCgYDVQQHDANI" +
            "Q00xEDAOBgNVBAoMB0NhbGlzdGExEDAOBgNVBAsMB0NhbGlzdGExEDAOBgNVBAMM" +
            "B0NhbGlzdGExIDAeBgkqhkiG9w0BCQEWEWluZm9AaW5ldGNsb3VkLnZuMIGfMA0G" +
            "CSqGSIb3DQEBAQUAA4GNADCBiQKBgQCxetXFs9aXIX89WX/cqc6pvAqfA1bSTwEC" +
            "Qchv7Te/gHQJanYXBPOCpihJwa9jnKnI/S6y5KK+A6Ud/xO3CS6XWrJkd2AfGv1B" +
            "o5of/4S3Y+AXiygimG9h/UOqZVgQQgkQbQd/c1uBEBznL0nvfZcUsTPI1DpDC9UK" +
            "ZiUEWsaCTQIDAQABMA0GCSqGSIb3DQEBCwUAA4GBAITGgS2WPloMGmY6Z2zYyS3y" +
            "as+/B59nevh6so3JRmFduQ1Qu9OwTWU0pySd4g/5ZpuUPZkhlUzFOX+VKOxYmqpr" +
            "4T2u9yXtNau94NYFPOpvzQGsEaR5OP14Oy2u/RXUoucPsZ1GPX8QggsOTK1I4xXs" +
            "sOVgB1hlg0hdAKFQuXTC",
        pk: "MIICXAIBAAKBgQCxetXFs9aXIX89WX/cqc6pvAqfA1bSTwECQchv7Te/gHQJanYX" +
            "BPOCpihJwa9jnKnI/S6y5KK+A6Ud/xO3CS6XWrJkd2AfGv1Bo5of/4S3Y+AXiygi" +
            "mG9h/UOqZVgQQgkQbQd/c1uBEBznL0nvfZcUsTPI1DpDC9UKZiUEWsaCTQIDAQAB" +
            "AoGAM3xy73uQUR+CjgWctiL8tPi8DA0n7rLElCcJQo8KkR9uihy8TUk+azRQk7UA" +
            "cGFOT+RC29q/62ebSuxoh7y+KuZObhNT2wkqE7cjbB97HlAgZrQOf4rYG+vGN3nB" +
            "a3ZIzGq/NK+lxmpY7ZvAnA4v3yUWUmSsmbD3c5v/LzBSWgECQQDj1RSkFs27anTb" +
            "HfKW2IDbDwL/l2zHPiRdd4v7DUlzhsoKEA/YgqSM+b/jsJ5i3JrKmqftFYvNhQUo" +
            "SDcBXxjhAkEAx2wXaNTknWP7rfF++AGcqh61lSLkxABMRqEKU1XbAihmHd5KZw3H" +
            "V+VgN4hoOhOLOyPF5E1nE9rdm4rkFcm67QJBAMFKeP2Rvy9+7O8tZC/oNMIk5UVV" +
            "Aduz9AQ8NU1kA2n49BY/dEIa7GISTWNt56I2STkUpt10xyww66Q2SDxoouECQDKq" +
            "CYB+pd4+qpBUjFdhwXWO+7758HjDQp2nCEKHy25O6TKpaOmpnH1+LuWs6B3pHTRX" +
            "ME2CRK/MqQR9UtkeOTkCQBV7PYWgWshl/vz6pvu4bDtIwL1IxAd4+Ig50gYHPZtG" +
            "whnZfWGcgraHy6W7GHhfskABTC9nm9DgdYLO6XpfvVQ="
    },
    {
        subject: "C=VN, ST=HCM, L=HCM, O=Vinaco, OU=Vinaco, CN=Vinaco Corporation",
        issuer: "C=VN, CN=Viettel-CA, O=iNet, OU=iNet Solutions",
        validFrom: "2019-07-06",
        validTo: "2030-07-07",
        serial: "99184098D6747AFA",
        cert: "MIICczCCAdwCCQCZGECY1nR6+jANBgkqhkiG9w0BAQsFADB+MQswCQYDVQQGEwJW" +
            "TjEMMAoGA1UECAwDSENNMQwwCgYDVQQHDANIQ00xDzANBgNVBAoMBlZpbmFjbzEP" +
            "MA0GA1UECwwGVmluYWNvMQ8wDQYDVQQDDAZWaW5hY28xIDAeBgkqhkiG9w0BCQEW" +
            "EWluZm9AaW5ldGNsb3VkLnZuMB4XDTE5MDcwODA2MzQxMFoXDTIwMDcwNzA2MzQx" +
            "MFowfjELMAkGA1UEBhMCVk4xDDAKBgNVBAgMA0hDTTEMMAoGA1UEBwwDSENNMQ8w" +
            "DQYDVQQKDAZWaW5hY28xDzANBgNVBAsMBlZpbmFjbzEPMA0GA1UEAwwGVmluYWNv" +
            "MSAwHgYJKoZIhvcNAQkBFhFpbmZvQGluZXRjbG91ZC52bjCBnzANBgkqhkiG9w0B" +
            "AQEFAAOBjQAwgYkCgYEA3K8A4TKSOGQQepR0ZWPIdi0ABnLXtYKqUdS84XIvCbCD" +
            "60v7Rj8x/0YpLd99MMVfS1B3ZBF2XoCeE/qAg8BdtjSgnvHpyQX4vy9DRnKj56jJ" +
            "TR0PX5njeG3xpToXjubusB70LVDqDSNERsmBga66oBbIDOtQj58dm3Dms4cyfCcC" +
            "AwEAATANBgkqhkiG9w0BAQsFAAOBgQDPHQKecmW65R1Sng0A/HWHC71UvEGdshgK" +
            "fODIlICjo0bX3n67Eu+m+VRFCKjWas9bYoPLQRx2m2F0qkdiim3iuKZf+0wYvXBk" +
            "iDuPpoKG2Zq+aAFIh7H1qjgR34H96g3frl8dN5BQK4PFibrq24lxQuW2OvVwSOiz" +
            "bar1/bl+jw==",
        pk: "MIICWwIBAAKBgQDcrwDhMpI4ZBB6lHRlY8h2LQAGcte1gqpR1Lzhci8JsIPrS/tG" +
            "PzH/Rikt330wxV9LUHdkEXZegJ4T+oCDwF22NKCe8enJBfi/L0NGcqPnqMlNHQ9f" +
            "meN4bfGlOheO5u6wHvQtUOoNI0RGyYGBrrqgFsgM61CPnx2bcOazhzJ8JwIDAQAB" +
            "AoGAKKkJ5XQ24rL1IlC1/XRcHAIAji+ctPHFRdyHjJZIOmXOeI0AWBoOsTURI0WZ" +
            "QGItQ6gox0Q8Zf8WoSG3ig7odPEswLVqH/cr/0IsQ4yIMKlsw5JqizLq5Opcik61" +
            "dH6wpLjVrNRcv2h/JVvmKdAo5K+KEwZ8UNmmEZK5O5cAssECQQD1qubI7/y4OWwQ" +
            "PUYD9ZCocLWDLn34oBxN8ayNnLp/N4/D78jhpsDKSSPIcTFFSZVf4FplcEZS8f94" +
            "fikFZmKHAkEA5fcZkwad0z/w5OahX0YHFRe3vNt7up4KEocXXgVETM79Yp6tiMbE" +
            "+aEOtslBSfGAPiEIm46tXb9f0/ffid5hYQJAFm1uukNmf+8GFYlyfeQKO8ZmW75/" +
            "05XSX69DgH4hbIHHBy052pfdm9oHgUIMLHYmQ+V4ezA/y0y6dOaXmh2ZuwJAN815" +
            "UDsXyy5F51WrrPHSQCUMOfDMmmFFMm/DlNYUV8sWo3q7w2fwXl7dsi8t/6JxqyHa" +
            "89xwZ0JMH6STguIKoQJAV/UVZO/8kpxbygpR4jlyA4cSrbb7bId8fk421CXivjcI" +
            "JPRTHaTtJleJhITyPf48F/wwr0d62ENnuLLLv2QiRw=="
    }
];
if (false) {
    /** @type {?} */
    TokenSimulator._certs;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVG9rZW5TaW11bGF0b3IuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9pbmV0LXVpLyIsInNvdXJjZXMiOlsic3JjL3dlYi10b2tlbi9saWIvVG9rZW5TaW11bGF0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBQyxVQUFVLEVBQUUsWUFBWSxFQUFDLE1BQU0sYUFBYSxDQUFDO0FBR3JELE9BQU8sS0FBSyxlQUFlLE1BQU0sV0FBVyxDQUFDOztNQUt2QyxTQUFTLEdBQUcsZUFBZSxDQUFDLFNBQVM7QUFFM0MsTUFBTSxPQUFPLGNBQWM7Ozs7OztJQXlFdkIsTUFBTSxDQUFDLGVBQWUsQ0FBQyxNQUFrQixFQUFFLElBQVU7O2NBQzNDLE9BQU8sR0FBRyxJQUFJLE9BQU87Ozs7UUFBQyxDQUFDLE9BQU8sRUFBRSxFQUFFO1lBQ3BDLFFBQVEsTUFBTSxFQUFFO2dCQUNaLEtBQUssVUFBVSxDQUFDLFFBQVE7b0JBQ3BCLE9BQU8sQ0FBQyxFQUFDLElBQUksRUFBRTs0QkFDWCxPQUFPLEVBQUUsT0FBTzs0QkFDaEIsYUFBYSxFQUFFLENBQUM7NEJBQ2hCLG1CQUFtQixFQUFFLENBQUM7eUJBQ3pCLEVBQUMsQ0FBQyxDQUFDO29CQUNKLE1BQU07Z0JBQ1YsS0FBSyxVQUFVLENBQUMsU0FBUztvQkFDckIsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7b0JBQzFCLE1BQU07Z0JBQ1YsS0FBSyxVQUFVLENBQUMsU0FBUztvQkFDckIsT0FBTyxDQUFDLEVBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUMsQ0FBQyxDQUFDO29CQUM3QixNQUFNO2FBQ2I7UUFDTCxDQUFDLEVBQUM7UUFDRixPQUFPLE9BQU8sQ0FBQztJQUNuQixDQUFDOzs7Ozs7SUFFRCxNQUFNLENBQUMsS0FBSyxDQUFDLElBQXFCLEVBQUUsT0FBTztRQUN2QyxJQUFJOztrQkFDTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FB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Ozs7SUFyRUYsc0JBcUVFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtFWFRfQUNUSU9OLCBFWFRfSEFTSF9BTEd9IGZyb20gXCIuL0NvbnN0YW50c1wiO1xuaW1wb3J0IHtSZXBseURhdGF9IGZyb20gXCIuL21vZGVsL1JlcGx5RGF0YVwiO1xuaW1wb3J0IHtDZXJ0RGF0YX0gZnJvbSBcIi4vbW9kZWwvQ2VydERhdGFcIjtcbmltcG9ydCAqIGFzIEpTRW5jcnlwdE1vZHVsZSBmcm9tIFwianNlbmNyeXB0XCI7XG5pbXBvcnQgKiBhcyBTSEExIGZyb20gXCJjcnlwdG8tanMvc2hhMVwiO1xuaW1wb3J0IHtTaWduZWREYXRhLCBTaWduZWRSZXBseURhdGF9IGZyb20gXCIuL21vZGVsL1NpZ25lZFJlcGx5RGF0YVwiO1xuaW1wb3J0IHtNZXNzYWdlU2lnbkhhc2h9IGZyb20gXCIuL21vZGVsL01lc3NhZ2VTaWduSGFzaFwiO1xuXG5jb25zdCBKU0VuY3J5cHQgPSBKU0VuY3J5cHRNb2R1bGUuSlNFbmNyeXB0O1xuXG5leHBvcnQgY2xhc3MgVG9rZW5TaW11bGF0b3Ige1xuXG4gICAgc3RhdGljIF9jZXJ0czogQ2VydERhdGFbXSA9IFtcbiAgICAgICAge1xuICAgICAgICAgICAgc3ViamVjdDogXCJDPVZOLCBTVD1IQ00sIEw9SENNLCBPPUNhbGlzdGEsIE9VPUNhbGlzdGEsICwgQ049aU5ldCBTb2x1dGlvbnMgQ29ycG9yYXRpb25cIixcbiAgICAgICAgICAgIGlzc3VlcjogXCJDPVZOLCBDTj1WaWV0dGVsLUNBLCBPPWlOZXQsIE9VPWlOZXQgU29sdXRpb25zXCIsXG4gICAgICAgICAgICB2YWxpZEZyb206IFwiMjAxOS0wNy0wNlwiLFxuICAgICAgICAgICAgdmFsaWRUbzogXCIyMDMwLTA3LTA3XCIsXG4gICAgICAgICAgICBzZXJpYWw6IFwiODQzRjFERjQwNTAwOUE2MlwiLFxuICAgICAgICAgICAgY2VydDogXCJNSUlDZXpDQ0FlUUNDUUNFUHgzMEJRQ2FZakFOQmdrcWhraUc5dzBCQVFzRkFEQ0JnVEVMTUFrR0ExVUVCaE1DXCIgK1xuICAgICAgICAgICAgICAgIFwiVms0eEREQUtCZ05WQkFnTUEwaERUVEVNTUFvR0ExVUVCd3dEU0VOTk1SQXdEZ1lEVlFRS0RBZERZV3hwYzNSaFwiICtcbiAgICAgICAgICAgICAgICBcIk1SQXdEZ1lEVlFRTERBZERZV3hwYzNSaE1SQXdEZ1lEVlFRRERBZERZV3hwYzNSaE1TQXdIZ1lKS29aSWh2Y05cIiArXG4gICAgICAgICAgICAgICAgXCJBUWtCRmhGcGJtWnZRR2x1WlhSamJHOTFaQzUyYmpBZUZ3MHhPVEEzTURnd05qTTJNRE5hRncweU1EQTNNRGN3XCIgK1xuICAgICAgICAgICAgICAgIFwiTmpNMk1ETmFNSUdCTVFzd0NRWURWUVFHRXdKV1RqRU1NQW9HQTFVRUNBd0RTRU5OTVF3d0NnWURWUVFIREFOSVwiICtcbiAgICAgICAgICAgICAgICBcIlEwMHhFREFPQmdOVkJBb01CME5oYkdsemRHRXhFREFPQmdOVkJBc01CME5oYkdsemRHRXhFREFPQmdOVkJBTU1cIiArXG4gICAgICAgICAgICAgICAgXCJCME5oYkdsemRHRXhJREFlQmdrcWhraUc5dzBCQ1FFV0VXbHVabTlBYVc1bGRHTnNiM1ZrTG5adU1JR2ZNQTBHXCIgK1xuICAgICAgICAgICAgICAgIFwiQ1NxR1NJYjNEUUVCQVFVQUE0R05BRENCaVFLQmdRQ3hldFhGczlhWElYODlXWC9jcWM2cHZBcWZBMWJTVHdFQ1wiICtcbiAgICAgICAgICAgICAgICBcIlFjaHY3VGUvZ0hRSmFuWVhCUE9DcGloSndhOWpuS25JL1M2eTVLSytBNlVkL3hPM0NTNlhXckprZDJBZkd2MUJcIiArXG4gICAgICAgICAgICAgICAgXCJvNW9mLzRTM1krQVhpeWdpbUc5aC9VT3FaVmdRUWdrUWJRZC9jMXVCRUJ6bkwwbnZmWmNVc1RQSTFEcERDOVVLXCIgK1xuICAgICAgICAgICAgICAgIFwiWmlVRVdzYUNUUUlEQVFBQk1BMEdDU3FHU0liM0RRRUJDd1VBQTRHQkFJVEdnUzJXUGxvTUdtWTZaMnpZeVMzeVwiICtcbiAgICAgICAgICAgICAgICBcImFzKy9CNTluZXZoNnNvM0pSbUZkdVExUXU5T3dUV1UwcHlTZDRnLzVacHVVUFpraGxVekZPWCtWS094WW1xcHJcIiArXG4gICAgICAgICAgICAgICAgXCI0VDJ1OXlYdE5hdTk0TllGUE9wdnpRR3NFYVI1T1AxNE95MnUvUlhVb3VjUHNaMUdQWDhRZ2dzT1RLMUk0eFhzXCIgK1xuICAgICAgICAgICAgICAgIFwic09WZ0IxaGxnMGhkQUtGUXVYVENcIixcbiAgICAgICAgICAgIHBrOiBcIk1JSUNYQUlCQUFLQmdRQ3hldFhGczlhWElYODlXWC9jcWM2cHZBcWZBMWJTVHdFQ1FjaHY3VGUvZ0hRSmFuWVhcIiArXG4gICAgICAgICAgICAgICAgXCJCUE9DcGloSndhOWpuS25JL1M2eTVLSytBNlVkL3hPM0NTNlhXckprZDJBZkd2MUJvNW9mLzRTM1krQVhpeWdpXCIgK1xuICAgICAgICAgICAgICAgIFwibUc5aC9VT3FaVmdRUWdrUWJRZC9jMXVCRUJ6bkwwbnZmWmNVc1RQSTFEcERDOVVLWmlVRVdzYUNUUUlEQVFBQlwiICtcbiAgICAgICAgICAgICAgICBcIkFvR0FNM3h5NzN1UVVSK0NqZ1djdGlMOHRQaThEQTBuN3JMRWxDY0pRbzhLa1I5dWloeThUVWsrYXpSUWs3VUFcIiArXG4gICAgICAgICAgICAgICAgXCJjR0ZPVCtSQzI5cS82MmViU3V4b2g3eStLdVpPYmhOVDJ3a3FFN2NqYkI5N0hsQWdaclFPZjRyWUcrdkdOM25CXCIgK1xuICAgICAgICAgICAgICAgIFwiYTNaSXpHcS9OSytseG1wWTdadkFuQTR2M3lVV1VtU3NtYkQzYzV2L0x6QlNXZ0VDUVFEajFSU2tGczI3YW5UYlwiICtcbiAgICAgICAgICAgICAgICBcIkhmS1cySURiRHdML2wyekhQaVJkZDR2N0RVbHpoc29LRUEvWWdxU00rYi9qc0o1aTNKckttcWZ0Rll2TmhRVW9cIiArXG4gICAgICAgICAgICAgICAgXCJTRGNCWHhqaEFrRUF4MndYYU5Ua25XUDdyZkYrK0FHY3FoNjFsU0xreEFCTVJxRUtVMVhiQWlobUhkNUtadzNIXCIgK1xuICAgICAgICAgICAgICAgIFwiVitWZ040aG9PaE9MT3lQRjVFMW5FOXJkbTRya0ZjbTY3UUpCQU1GS2VQMlJ2eTkrN084dFpDL29OTUlrNVVWVlwiICtcbiAgICAgICAgICAgICAgICBcIkFkdXo5QVE4TlUxa0EybjQ5QlkvZEVJYTdHSVNUV050NTZJMlNUa1VwdDEweHl3dzY2UTJTRHhvb3VFQ1FES3FcIiArXG4gICAgICAgICAgICAgICAgXCJDWUIrcGQ0K3FwQlVqRmRod1hXTys3NzU4SGpEUXAybkNFS0h5MjVPNlRLcGFPbXBuSDErTHVXczZCM3BIVFJYXCIgK1xuICAgICAgICAgICAgICAgIFwiTUUyQ1JLL01xUVI5VXRrZU9Ua0NRQlY3UFlXZ1dzaGwvdno2cHZ1NGJEdEl3TDFJeEFkNCtJZzUwZ1lIUFp0R1wiICtcbiAgICAgICAgICAgICAgICBcIndoblpmV0djZ3JhSHk2VzdHSGhmc2tBQlRDOW5tOURnZFlMTzZYcGZ2VlE9XCJcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgc3ViamVjdDogXCJDPVZOLCBTVD1IQ00sIEw9SENNLCBPPVZpbmFjbywgT1U9VmluYWNvLCBDTj1WaW5hY28gQ29ycG9yYXRpb25cIixcbiAgICAgICAgICAgIGlzc3VlcjogXCJDPVZOLCBDTj1WaWV0dGVsLUNBLCBPPWlOZXQsIE9VPWlOZXQgU29sdXRpb25zXCIsXG4gICAgICAgICAgICB2YWxpZEZyb206IFwiMjAxOS0wNy0wNlwiLFxuICAgICAgICAgICAgdmFsaWRUbzogXCIyMDMwLTA3LTA3XCIsXG4gICAgICAgICAgICBzZXJpYWw6IFwiOTkxODQwOThENjc0N0FGQVwiLFxuICAgICAgICAgICAgY2VydDogXCJNSUlDY3pDQ0Fkd0NDUUNaR0VDWTFuUjYrakFOQmdrcWhraUc5dzBCQVFzRkFEQitNUXN3Q1FZRFZRUUdFd0pXXCIgK1xuICAgICAgICAgICAgICAgIFwiVGpFTU1Bb0dBMVVFQ0F3RFNFTk5NUXd3Q2dZRFZRUUhEQU5JUTAweER6QU5CZ05WQkFvTUJsWnBibUZqYnpFUFwiICtcbiAgICAgICAgICAgICAgICBcIk1BMEdBMVVFQ3d3R1ZtbHVZV052TVE4d0RRWURWUVFEREFaV2FXNWhZMjh4SURBZUJna3Foa2lHOXcwQkNRRVdcIiArXG4gICAgICAgICAgICAgICAgXCJFV2x1Wm05QWFXNWxkR05zYjNWa0xuWnVNQjRYRFRFNU1EY3dPREEyTXpReE1Gb1hEVEl3TURjd056QTJNelF4XCIgK1xuICAgICAgICAgICAgICAgIFwiTUZvd2ZqRUxNQWtHQTFVRUJoTUNWazR4RERBS0JnTlZCQWdNQTBoRFRURU1NQW9HQTFVRUJ3d0RTRU5OTVE4d1wiICtcbiAgICAgICAgICAgICAgICBcIkRRWURWUVFLREFaV2FXNWhZMjh4RHpBTkJnTlZCQXNNQmxacGJtRmpiekVQTUEwR0ExVUVBd3dHVm1sdVlXTnZcIiArXG4gICAgICAgICAgICAgICAgXCJNU0F3SGdZSktvWklodmNOQVFrQkZoRnBibVp2UUdsdVpYUmpiRzkxWkM1MmJqQ0JuekFOQmdrcWhraUc5dzBCXCIgK1xuICAgICAgICAgICAgICAgIFwiQVFFRkFBT0JqUUF3Z1lrQ2dZRUEzSzhBNFRLU09HUVFlcFIwWldQSWRpMEFCbkxYdFlLcVVkUzg0WEl2Q2JDRFwiICtcbiAgICAgICAgICAgICAgICBcIjYwdjdSajh4LzBZcExkOTlNTVZmUzFCM1pCRjJYb0NlRS9xQWc4QmR0alNnbnZIcHlRWDR2eTlEUm5LajU2akpcIiArXG4gICAgICAgICAgICAgICAgXCJUUjBQWDVuamVHM3hwVG9YanVidXNCNzBMVkRxRFNORVJzbUJnYTY2b0JiSURPdFFqNThkbTNEbXM0Y3lmQ2NDXCIgK1xuICAgICAgICAgICAgICAgIFwiQXdFQUFUQU5CZ2txaGtpRzl3MEJBUXNGQUFPQmdRRFBIUUtlY21XNjVSMVNuZzBBL0hXSEM3MVV2RUdkc2hnS1wiICtcbiAgICAgICAgICAgICAgICBcImZPRElsSUNqbzBiWDNuNjdFdSttK1ZSRkNLaldhczliWW9QTFFSeDJtMkYwcWtkaWltM2l1S1pmKzB3WXZYQmtcIiArXG4gICAgICAgICAgICAgICAgXCJpRHVQcG9LRzJacSthQUZJaDdIMXFqZ1IzNEg5NmczZnJsOGRONUJRSzRQRmlicnEyNGx4UXVXMk92VndTT2l6XCIgK1xuICAgICAgICAgICAgICAgIFwiYmFyMS9ibCtqdz09XCIsXG4gICAgICAgICAgICBwazogXCJNSUlDV3dJQkFBS0JnUURjcndEaE1wSTRaQkI2bEhSbFk4aDJMUUFHY3RlMWdxcFIxTHpoY2k4SnNJUHJTL3RHXCIgK1xuICAgICAgICAgICAgICAgIFwiUHpIL1Jpa3QzMzB3eFY5TFVIZGtFWFplZ0o0VCtvQ0R3RjIyTktDZThlbkpCZmkvTDBOR2NxUG5xTWxOSFE5ZlwiICtcbiAgICAgICAgICAgICAgICBcIm1lTjRiZkdsT2hlTzV1NndIdlF0VU9vTkkwUkd5WUdCcnJxZ0ZzZ002MUNQbngyYmNPYXpoeko4SndJREFRQUJcIiArXG4gICAgICAgICAgICAgICAgXCJBb0dBS0trSjVYUTI0ckwxSWxDMS9YUmNIQUlBamkrY3RQSEZSZHlIakpaSU9tWE9lSTBBV0JvT3NUVVJJMFdaXCIgK1xuICAgICAgICAgICAgICAgIFwiUUdJdFE2Z294MFE4WmY4V29TRzNpZzdvZFBFc3dMVnFIL2NyLzBJc1E0eUlNS2xzdzVKcWl6THE1T3BjaWs2MVwiICtcbiAgICAgICAgICAgICAgICBcImRINndwTGpWck5SY3YyaC9KVnZtS2RBbzVLK0tFd1o4VU5tbUVaSzVPNWNBc3NFQ1FRRDFxdWJJNy95NE9Xd1FcIiArXG4gICAgICAgICAgICAgICAgXCJQVVlEOVpDb2NMV0RMbjM0b0J4TjhheU5uTHAvTjQvRDc4amhwc0RLU1NQSWNURkZTWlZmNEZwbGNFWlM4Zjk0XCIgK1xuICAgICAgICAgICAgICAgIFwiZmlrRlptS0hBa0VBNWZjWmt3YWQwei93NU9haFgwWUhGUmUzdk50N3VwNEtFb2NYWGdWRVRNNzlZcDZ0aU1iRVwiICtcbiAgICAgICAgICAgICAgICBcIithRU90c2xCU2ZHQVBpRUltNDZ0WGI5ZjAvZmZpZDVoWVFKQUZtMXV1a05tZis4R0ZZbHlmZVFLTzhabVc3NS9cIiArXG4gICAgICAgICAgICAgICAgXCIwNVhTWDY5RGdINGhiSUhIQnkwNTJwZmRtOW9IZ1VJTUxIWW1RK1Y0ZXpBL3kweTZkT2FYbWgyWnV3SkFOODE1XCIgK1xuICAgICAgICAgICAgICAgIFwiVURzWHl5NUY1MVdyclBIU1FDVU1PZkRNbW1GRk1tL0RsTllVVjhzV28zcTd3MmZ3WGw3ZHNpOHQvNkp4cXlIYVwiICtcbiAgICAgICAgICAgICAgICBcIjg5eHdaMEpNSDZTVGd1SUtvUUpBVi9VVlpPLzhrcHhieWdwUjRqbHlBNGNTcmJiN2JJZDhmazQyMUNYaXZqY0lcIiArXG4gICAgICAgICAgICAgICAgXCJKUFJUSGFUdEpsZUpoSVR5UGY0OEYvd3dyMGQ2MkVObnVMTEx2MlFpUnc9PVwiXG4gICAgICAgIH1cbiAgICBdO1xuXG4gICAgc3RhdGljIHBvc3RUb0V4dGVuc2lvbihhY3Rpb246IEVYVF9BQ1RJT04sIGRhdGE/OiBhbnkpOiBQcm9taXNlPFJlcGx5RGF0YT4ge1xuICAgICAgICBjb25zdCBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgIHN3aXRjaCAoYWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBFWFRfQUNUSU9OLkdFVF9JTkZPOlxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHtkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiAnMC4wLjEnLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmF0aXZlVmVyc2lvbjogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hdGl2ZUxhdGVzdFZlcnNpb246IDEsXG4gICAgICAgICAgICAgICAgICAgIH19KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBFWFRfQUNUSU9OLlNJR05fSEFTSDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2lnbihkYXRhLCByZXNvbHZlKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBFWFRfQUNUSU9OLkdFVF9DRVJUUzpcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh7ZGF0YTogdGhpcy5fY2VydHN9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICB9XG5cbiAgICBzdGF0aWMgX3NpZ24oZGF0YTogTWVzc2FnZVNpZ25IYXNoLCByZXNvbHZlKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBjZXJ0ID0gdGhpcy5fZ2V0Q2VydChkYXRhLnNlcmlhbCk7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZTogU2lnbmVkRGF0YSA9IHtcbiAgICAgICAgICAgICAgICBzZXJpYWw6IGNlcnQuc2VyaWFsLFxuICAgICAgICAgICAgICAgIGNlcnQ6IGNlcnQuY2VydCxcbiAgICAgICAgICAgICAgICBoYXNoQWxnOiBkYXRhLmhhc2hBbGcgfHwgRVhUX0hBU0hfQUxHLlNIQTFcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjb25zdCBqc0VuY3J5cHQgPSBuZXcgSlNFbmNyeXB0KG51bGwpO1xuICAgICAgICAgICAganNFbmNyeXB0LnNldFByaXZhdGVLZXkoY2VydC5wayk7XG5cbiAgICAgICAgICAgIGlmIChkYXRhLmhhc2hzKSB7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2Uuc2lnbmF0dXJlcyA9IFtdO1xuICAgICAgICAgICAgICAgIGRhdGEuaGFzaHMuZm9yRWFjaCgoaGFzaCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5zaWduYXR1cmVzLnB1c2goanNFbmNyeXB0LnNpZ24oaGFzaCwgKHN0cikgPT4gdGhpcy5fYmFzZTY0dG9IRVgoc3RyKSwgZGF0YS5oYXNoQWxnLnRvTG9jYWxlTG93ZXJDYXNlKCkpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2Uuc2lnbmF0dXJlID0ganNFbmNyeXB0LnNpZ24oZGF0YS5oYXNoLCAoc3RyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9iYXNlNjR0b0hFWChzdHIpO1xuICAgICAgICAgICAgICAgIH0sIGRhdGEuaGFzaEFsZy50b0xvY2FsZUxvd2VyQ2FzZSgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc29sdmUoPFNpZ25lZFJlcGx5RGF0YT57XG4gICAgICAgICAgICAgICAgZGF0YTogcmVzcG9uc2VcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZXNvbHZlKDxTaWduZWRSZXBseURhdGE+e1xuICAgICAgICAgICAgICAgIGVycm9yOiBcIlNJR05fRVJST1JcIixcbiAgICAgICAgICAgICAgICBlcnJvck1zZzogZS5tZXNzYWdlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyBfZ2V0Q2VydChzZXJpYWwpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl9jZXJ0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2NlcnRzW2ldLnNlcmlhbCA9PT0gc2VyaWFsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NlcnRzW2ldO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9jZXJ0c1swXTtcbiAgICB9XG5cbiAgICBzdGF0aWMgX2Jhc2U2NHRvSEVYKGJhc2U2NCkge1xuXG4gICAgICAgIHZhciByYXcgPSBhdG9iKGJhc2U2NCk7XG5cbiAgICAgICAgdmFyIEhFWCA9ICcnO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmF3Lmxlbmd0aDsgaSsrICkge1xuXG4gICAgICAgICAgICB2YXIgX2hleCA9IHJhdy5jaGFyQ29kZUF0KGkpLnRvU3RyaW5nKDE2KTtcblxuICAgICAgICAgICAgSEVYICs9IChfaGV4Lmxlbmd0aD09Mj9faGV4OicwJytfaGV4KTtcblxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBIRVg7XG4gICAgfVxufVxuIl19