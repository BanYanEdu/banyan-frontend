/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EXT_ACTION, EXT_HASH_ALG } from "./Constants";
import * as JSEncryptModule from "jsencrypt";
/** @type {?} */
var JSEncrypt = JSEncryptModule.JSEncrypt;
var TokenSimulator = /** @class */ (function () {
    function TokenSimulator() {
    }
    /**
     * @param {?} action
     * @param {?=} data
     * @return {?}
     */
    TokenSimulator.postToExtension = /**
     * @param {?} action
     * @param {?=} data
     * @return {?}
     */
    function (action, data) {
        var _this = this;
        /** @type {?} */
        var promise = new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        function (resolve) {
            switch (action) {
                case EXT_ACTION.GET_INFO:
                    resolve({ data: {
                            version: '0.0.1',
                            nativeVersion: 1,
                            nativeLatestVersion: 1,
                        } });
                    break;
                case EXT_ACTION.SIGN_HASH:
                    _this._sign(data, resolve);
                    break;
                case EXT_ACTION.GET_CERTS:
                    resolve({ data: _this._certs });
                    break;
            }
        }));
        return promise;
    };
    /**
     * @param {?} data
     * @param {?} resolve
     * @return {?}
     */
    TokenSimulator._sign = /**
     * @param {?} data
     * @param {?} resolve
     * @return {?}
     */
    function (data, resolve) {
        var _this = this;
        try {
            /** @type {?} */
            var cert = this._getCert(data.serial);
            /** @type {?} */
            var response_1 = {
                serial: cert.serial,
                cert: cert.cert,
                hashAlg: data.hashAlg || EXT_HASH_ALG.SHA1
            };
            /** @type {?} */
            var jsEncrypt_1 = new JSEncrypt(null);
            jsEncrypt_1.setPrivateKey(cert.pk);
            if (data.hashs) {
                response_1.signatures = [];
                data.hashs.forEach((/**
                 * @param {?} hash
                 * @return {?}
                 */
                function (hash) {
                    response_1.signatures.push(jsEncrypt_1.sign(hash, (/**
                     * @param {?} str
                     * @return {?}
                     */
                    function (str) { return _this._base64toHEX(str); }), data.hashAlg.toLocaleLowerCase()));
                }));
            }
            else {
                response_1.signature = jsEncrypt_1.sign(data.hash, (/**
                 * @param {?} str
                 * @return {?}
                 */
                function (str) {
                    return _this._base64toHEX(str);
                }), data.hashAlg.toLocaleLowerCase());
            }
            resolve((/** @type {?} */ ({
                data: response_1
            })));
        }
        catch (e) {
            resolve((/** @type {?} */ ({
                error: "SIGN_ERROR",
                errorMsg: e.message
            })));
        }
    };
    /**
     * @param {?} serial
     * @return {?}
     */
    TokenSimulator._getCert = /**
     * @param {?} serial
     * @return {?}
     */
    function (serial) {
        for (var i = 0; i < this._certs.length; i++) {
            if (this._certs[i].serial === serial) {
                return this._certs[i];
            }
        }
        return this._certs[0];
    };
    /**
     * @param {?} base64
     * @return {?}
     */
    TokenSimulator._base64toHEX = /**
     * @param {?} base64
     * @return {?}
     */
    function (base64) {
        /** @type {?} */
        var raw = atob(base64);
        /** @type {?} */
        var HEX = '';
        for (var i = 0; i < raw.length; i++) {
            /** @type {?} */
            var _hex = raw.charCodeAt(i).toString(16);
            HEX += (_hex.length == 2 ? _hex : '0' + _hex);
        }
        return HEX;
    };
    TokenSimulator._certs = [
        {
            subject: "C=VN, ST=HCM, L=HCM, O=Calista, OU=Calista, , CN=iNet Solutions Corporation",
            issuer: "C=VN, CN=Viettel-CA, O=iNet, OU=iNet Solutions",
            validFrom: "2019-07-06",
            validTo: "2030-07-07",
            serial: "843F1DF405009A62",
            cert: "MIICezCCAeQCCQCEPx30BQCaYjANBgkqhkiG9w0BAQsFADCBgTELMAkGA1UEBhMC" +
                "Vk4xDDAKBgNVBAgMA0hDTTEMMAoGA1UEBwwDSENNMRAwDgYDVQQKDAdDYWxpc3Rh" +
                "MRAwDgYDVQQLDAdDYWxpc3RhMRAwDgYDVQQDDAdDYWxpc3RhMSAwHgYJKoZIhvcN" +
                "AQkBFhFpbmZvQGluZXRjbG91ZC52bjAeFw0xOTA3MDgwNjM2MDNaFw0yMDA3MDcw" +
                "NjM2MDNaMIGBMQswCQYDVQQGEwJWTjEMMAoGA1UECAwDSENNMQwwCgYDVQQHDANI" +
                "Q00xEDAOBgNVBAoMB0NhbGlzdGExEDAOBgNVBAsMB0NhbGlzdGExEDAOBgNVBAMM" +
                "B0NhbGlzdGExIDAeBgkqhkiG9w0BCQEWEWluZm9AaW5ldGNsb3VkLnZuMIGfMA0G" +
                "CSqGSIb3DQEBAQUAA4GNADCBiQKBgQCxetXFs9aXIX89WX/cqc6pvAqfA1bSTwEC" +
                "Qchv7Te/gHQJanYXBPOCpihJwa9jnKnI/S6y5KK+A6Ud/xO3CS6XWrJkd2AfGv1B" +
                "o5of/4S3Y+AXiygimG9h/UOqZVgQQgkQbQd/c1uBEBznL0nvfZcUsTPI1DpDC9UK" +
                "ZiUEWsaCTQIDAQABMA0GCSqGSIb3DQEBCwUAA4GBAITGgS2WPloMGmY6Z2zYyS3y" +
                "as+/B59nevh6so3JRmFduQ1Qu9OwTWU0pySd4g/5ZpuUPZkhlUzFOX+VKOxYmqpr" +
                "4T2u9yXtNau94NYFPOpvzQGsEaR5OP14Oy2u/RXUoucPsZ1GPX8QggsOTK1I4xXs" +
                "sOVgB1hlg0hdAKFQuXTC",
            pk: "MIICXAIBAAKBgQCxetXFs9aXIX89WX/cqc6pvAqfA1bSTwECQchv7Te/gHQJanYX" +
                "BPOCpihJwa9jnKnI/S6y5KK+A6Ud/xO3CS6XWrJkd2AfGv1Bo5of/4S3Y+AXiygi" +
                "mG9h/UOqZVgQQgkQbQd/c1uBEBznL0nvfZcUsTPI1DpDC9UKZiUEWsaCTQIDAQAB" +
                "AoGAM3xy73uQUR+CjgWctiL8tPi8DA0n7rLElCcJQo8KkR9uihy8TUk+azRQk7UA" +
                "cGFOT+RC29q/62ebSuxoh7y+KuZObhNT2wkqE7cjbB97HlAgZrQOf4rYG+vGN3nB" +
                "a3ZIzGq/NK+lxmpY7ZvAnA4v3yUWUmSsmbD3c5v/LzBSWgECQQDj1RSkFs27anTb" +
                "HfKW2IDbDwL/l2zHPiRdd4v7DUlzhsoKEA/YgqSM+b/jsJ5i3JrKmqftFYvNhQUo" +
                "SDcBXxjhAkEAx2wXaNTknWP7rfF++AGcqh61lSLkxABMRqEKU1XbAihmHd5KZw3H" +
                "V+VgN4hoOhOLOyPF5E1nE9rdm4rkFcm67QJBAMFKeP2Rvy9+7O8tZC/oNMIk5UVV" +
                "Aduz9AQ8NU1kA2n49BY/dEIa7GISTWNt56I2STkUpt10xyww66Q2SDxoouECQDKq" +
                "CYB+pd4+qpBUjFdhwXWO+7758HjDQp2nCEKHy25O6TKpaOmpnH1+LuWs6B3pHTRX" +
                "ME2CRK/MqQR9UtkeOTkCQBV7PYWgWshl/vz6pvu4bDtIwL1IxAd4+Ig50gYHPZtG" +
                "whnZfWGcgraHy6W7GHhfskABTC9nm9DgdYLO6XpfvVQ="
        },
        {
            subject: "C=VN, ST=HCM, L=HCM, O=Vinaco, OU=Vinaco, CN=Vinaco Corporation",
            issuer: "C=VN, CN=Viettel-CA, O=iNet, OU=iNet Solutions",
            validFrom: "2019-07-06",
            validTo: "2030-07-07",
            serial: "99184098D6747AFA",
            cert: "MIICczCCAdwCCQCZGECY1nR6+jANBgkqhkiG9w0BAQsFADB+MQswCQYDVQQGEwJW" +
                "TjEMMAoGA1UECAwDSENNMQwwCgYDVQQHDANIQ00xDzANBgNVBAoMBlZpbmFjbzEP" +
                "MA0GA1UECwwGVmluYWNvMQ8wDQYDVQQDDAZWaW5hY28xIDAeBgkqhkiG9w0BCQEW" +
                "EWluZm9AaW5ldGNsb3VkLnZuMB4XDTE5MDcwODA2MzQxMFoXDTIwMDcwNzA2MzQx" +
                "MFowfjELMAkGA1UEBhMCVk4xDDAKBgNVBAgMA0hDTTEMMAoGA1UEBwwDSENNMQ8w" +
                "DQYDVQQKDAZWaW5hY28xDzANBgNVBAsMBlZpbmFjbzEPMA0GA1UEAwwGVmluYWNv" +
                "MSAwHgYJKoZIhvcNAQkBFhFpbmZvQGluZXRjbG91ZC52bjCBnzANBgkqhkiG9w0B" +
                "AQEFAAOBjQAwgYkCgYEA3K8A4TKSOGQQepR0ZWPIdi0ABnLXtYKqUdS84XIvCbCD" +
                "60v7Rj8x/0YpLd99MMVfS1B3ZBF2XoCeE/qAg8BdtjSgnvHpyQX4vy9DRnKj56jJ" +
                "TR0PX5njeG3xpToXjubusB70LVDqDSNERsmBga66oBbIDOtQj58dm3Dms4cyfCcC" +
                "AwEAATANBgkqhkiG9w0BAQsFAAOBgQDPHQKecmW65R1Sng0A/HWHC71UvEGdshgK" +
                "fODIlICjo0bX3n67Eu+m+VRFCKjWas9bYoPLQRx2m2F0qkdiim3iuKZf+0wYvXBk" +
                "iDuPpoKG2Zq+aAFIh7H1qjgR34H96g3frl8dN5BQK4PFibrq24lxQuW2OvVwSOiz" +
                "bar1/bl+jw==",
            pk: "MIICWwIBAAKBgQDcrwDhMpI4ZBB6lHRlY8h2LQAGcte1gqpR1Lzhci8JsIPrS/tG" +
                "PzH/Rikt330wxV9LUHdkEXZegJ4T+oCDwF22NKCe8enJBfi/L0NGcqPnqMlNHQ9f" +
                "meN4bfGlOheO5u6wHvQtUOoNI0RGyYGBrrqgFsgM61CPnx2bcOazhzJ8JwIDAQAB" +
                "AoGAKKkJ5XQ24rL1IlC1/XRcHAIAji+ctPHFRdyHjJZIOmXOeI0AWBoOsTURI0WZ" +
                "QGItQ6gox0Q8Zf8WoSG3ig7odPEswLVqH/cr/0IsQ4yIMKlsw5JqizLq5Opcik61" +
                "dH6wpLjVrNRcv2h/JVvmKdAo5K+KEwZ8UNmmEZK5O5cAssECQQD1qubI7/y4OWwQ" +
                "PUYD9ZCocLWDLn34oBxN8ayNnLp/N4/D78jhpsDKSSPIcTFFSZVf4FplcEZS8f94" +
                "fikFZmKHAkEA5fcZkwad0z/w5OahX0YHFRe3vNt7up4KEocXXgVETM79Yp6tiMbE" +
                "+aEOtslBSfGAPiEIm46tXb9f0/ffid5hYQJAFm1uukNmf+8GFYlyfeQKO8ZmW75/" +
                "05XSX69DgH4hbIHHBy052pfdm9oHgUIMLHYmQ+V4ezA/y0y6dOaXmh2ZuwJAN815" +
                "UDsXyy5F51WrrPHSQCUMOfDMmmFFMm/DlNYUV8sWo3q7w2fwXl7dsi8t/6JxqyHa" +
                "89xwZ0JMH6STguIKoQJAV/UVZO/8kpxbygpR4jlyA4cSrbb7bId8fk421CXivjcI" +
                "JPRTHaTtJleJhITyPf48F/wwr0d62ENnuLLLv2QiRw=="
        }
    ];
    return TokenSimulator;
}());
export { TokenSimulator };
if (false) {
    /** @type {?} */
    TokenSimulator._certs;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVG9rZW5TaW11bGF0b3IuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9pbmV0LXVpLyIsInNvdXJjZXMiOlsic3JjL3dlYi10b2tlbi9saWIvVG9rZW5TaW11bGF0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBQyxVQUFVLEVBQUUsWUFBWSxFQUFDLE1BQU0sYUFBYSxDQUFDO0FBR3JELE9BQU8sS0FBSyxlQUFlLE1BQU0sV0FBVyxDQUFDOztJQUt2QyxTQUFTLEdBQUcsZUFBZSxDQUFDLFNBQVM7QUFFM0M7SUFBQTtJQXNKQSxDQUFDOzs7Ozs7SUE3RVUsOEJBQWU7Ozs7O0lBQXRCLFVBQXVCLE1BQWtCLEVBQUUsSUFBVTtRQUFyRCxpQkFtQkM7O1lBbEJTLE9BQU8sR0FBRyxJQUFJLE9BQU87Ozs7UUFBQyxVQUFDLE9BQU87WUFDaEMsUUFBUSxNQUFNLEVBQUU7Z0JBQ1osS0FBSyxVQUFVLENBQUMsUUFBUTtvQkFDcEIsT0FBTyxDQUFDLEVBQUMsSUFBSSxFQUFFOzRCQUNYLE9BQU8sRUFBRSxPQUFPOzRCQUNoQixhQUFhLEVBQUUsQ0FBQzs0QkFDaEIsbUJBQW1CLEVBQUUsQ0FBQzt5QkFDekIsRUFBQyxDQUFDLENBQUM7b0JBQ0osTUFBTTtnQkFDVixLQUFLLFVBQVUsQ0FBQyxTQUFTO29CQUNyQixLQUFJLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztvQkFDMUIsTUFBTTtnQkFDVixLQUFLLFVBQVUsQ0FBQyxTQUFTO29CQUNyQixPQUFPLENBQUMsRUFBQyxJQUFJLEVBQUUsS0FBSSxDQUFDLE1BQU0sRUFBQyxDQUFDLENBQUM7b0JBQzdCLE1BQU07YUFDYjtRQUNMLENBQUMsRUFBQztRQUNGLE9BQU8sT0FBTyxDQUFDO0lBQ25CLENBQUM7Ozs7OztJQUVNLG9CQUFLOzs7OztJQUFaLFVBQWEsSUFBcUIsRUFBRSxPQUFPO1FBQTNDLGlCQThCQztRQTdCRyxJQUFJOztnQkFDTSxJQUFJLEdBQUcs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QUNsRSxrRUFBa0U7Z0JBQ2xFLGtFQUFrRTtnQkFDbEUsOENBQThDO1NBQ3JEO0tBQ0osQ0FBQztJQStFTixxQkFBQztDQUFBLEFBdEpELElBc0pDO1NBdEpZLGNBQWM7OztJQUV2QixzQkFxRUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0VYVF9BQ1RJT04sIEVYVF9IQVNIX0FMR30gZnJvbSBcIi4vQ29uc3RhbnRzXCI7XG5pbXBvcnQge1JlcGx5RGF0YX0gZnJvbSBcIi4vbW9kZWwvUmVwbHlEYXRhXCI7XG5pbXBvcnQge0NlcnREYXRhfSBmcm9tIFwiLi9tb2RlbC9DZXJ0RGF0YVwiO1xuaW1wb3J0ICogYXMgSlNFbmNyeXB0TW9kdWxlIGZyb20gXCJqc2VuY3J5cHRcIjtcbmltcG9ydCAqIGFzIFNIQTEgZnJvbSBcImNyeXB0by1qcy9zaGExXCI7XG5pbXBvcnQge1NpZ25lZERhdGEsIFNpZ25lZFJlcGx5RGF0YX0gZnJvbSBcIi4vbW9kZWwvU2lnbmVkUmVwbHlEYXRhXCI7XG5pbXBvcnQge01lc3NhZ2VTaWduSGFzaH0gZnJvbSBcIi4vbW9kZWwvTWVzc2FnZVNpZ25IYXNoXCI7XG5cbmNvbnN0IEpTRW5jcnlwdCA9IEpTRW5jcnlwdE1vZHVsZS5KU0VuY3J5cHQ7XG5cbmV4cG9ydCBjbGFzcyBUb2tlblNpbXVsYXRvciB7XG5cbiAgICBzdGF0aWMgX2NlcnRzOiBDZXJ0RGF0YVtdID0gW1xuICAgICAgICB7XG4gICAgICAgICAgICBzdWJqZWN0OiBcIkM9Vk4sIFNUPUhDTSwgTD1IQ00sIE89Q2FsaXN0YSwgT1U9Q2FsaXN0YSwgLCBDTj1pTmV0IFNvbHV0aW9ucyBDb3Jwb3JhdGlvblwiLFxuICAgICAgICAgICAgaXNzdWVyOiBcIkM9Vk4sIENOPVZpZXR0ZWwtQ0EsIE89aU5ldCwgT1U9aU5ldCBTb2x1dGlvbnNcIixcbiAgICAgICAgICAgIHZhbGlkRnJvbTogXCIyMDE5LTA3LTA2XCIsXG4gICAgICAgICAgICB2YWxpZFRvOiBcIjIwMzAtMDctMDdcIixcbiAgICAgICAgICAgIHNlcmlhbDogXCI4NDNGMURGNDA1MDA5QTYyXCIsXG4gICAgICAgICAgICBjZXJ0OiBcIk1JSUNlekNDQWVRQ0NRQ0VQeDMwQlFDYVlqQU5CZ2txaGtpRzl3MEJBUXNGQURDQmdURUxNQWtHQTFVRUJoTUNcIiArXG4gICAgICAgICAgICAgICAgXCJWazR4RERBS0JnTlZCQWdNQTBoRFRURU1NQW9HQTFVRUJ3d0RTRU5OTVJBd0RnWURWUVFLREFkRFlXeHBjM1JoXCIgK1xuICAgICAgICAgICAgICAgIFwiTVJBd0RnWURWUVFMREFkRFlXeHBjM1JoTVJBd0RnWURWUVFEREFkRFlXeHBjM1JoTVNBd0hnWUpLb1pJaHZjTlwiICtcbiAgICAgICAgICAgICAgICBcIkFRa0JGaEZwYm1adlFHbHVaWFJqYkc5MVpDNTJiakFlRncweE9UQTNNRGd3TmpNMk1ETmFGdzB5TURBM01EY3dcIiArXG4gICAgICAgICAgICAgICAgXCJOak0yTUROYU1JR0JNUXN3Q1FZRFZRUUdFd0pXVGpFTU1Bb0dBMVVFQ0F3RFNFTk5NUXd3Q2dZRFZRUUhEQU5JXCIgK1xuICAgICAgICAgICAgICAgIFwiUTAweEVEQU9CZ05WQkFvTUIwTmhiR2x6ZEdFeEVEQU9CZ05WQkFzTUIwTmhiR2x6ZEdFeEVEQU9CZ05WQkFNTVwiICtcbiAgICAgICAgICAgICAgICBcIkIwTmhiR2x6ZEdFeElEQWVCZ2txaGtpRzl3MEJDUUVXRVdsdVptOUFhVzVsZEdOc2IzVmtMblp1TUlHZk1BMEdcIiArXG4gICAgICAgICAgICAgICAgXCJDU3FHU0liM0RRRUJBUVVBQTRHTkFEQ0JpUUtCZ1FDeGV0WEZzOWFYSVg4OVdYL2NxYzZwdkFxZkExYlNUd0VDXCIgK1xuICAgICAgICAgICAgICAgIFwiUWNodjdUZS9nSFFKYW5ZWEJQT0NwaWhKd2E5am5LbkkvUzZ5NUtLK0E2VWQveE8zQ1M2WFdySmtkMkFmR3YxQlwiICtcbiAgICAgICAgICAgICAgICBcIm81b2YvNFMzWStBWGl5Z2ltRzloL1VPcVpWZ1FRZ2tRYlFkL2MxdUJFQnpuTDBudmZaY1VzVFBJMURwREM5VUtcIiArXG4gICAgICAgICAgICAgICAgXCJaaVVFV3NhQ1RRSURBUUFCTUEwR0NTcUdTSWIzRFFFQkN3VUFBNEdCQUlUR2dTMldQbG9NR21ZNloyell5UzN5XCIgK1xuICAgICAgICAgICAgICAgIFwiYXMrL0I1OW5ldmg2c28zSlJtRmR1UTFRdTlPd1RXVTBweVNkNGcvNVpwdVVQWmtobFV6Rk9YK1ZLT3hZbXFwclwiICtcbiAgICAgICAgICAgICAgICBcIjRUMnU5eVh0TmF1OTROWUZQT3B2elFHc0VhUjVPUDE0T3kydS9SWFVvdWNQc1oxR1BYOFFnZ3NPVEsxSTR4WHNcIiArXG4gICAgICAgICAgICAgICAgXCJzT1ZnQjFobGcwaGRBS0ZRdVhUQ1wiLFxuICAgICAgICAgICAgcGs6IFwiTUlJQ1hBSUJBQUtCZ1FDeGV0WEZzOWFYSVg4OVdYL2NxYzZwdkFxZkExYlNUd0VDUWNodjdUZS9nSFFKYW5ZWFwiICtcbiAgICAgICAgICAgICAgICBcIkJQT0NwaWhKd2E5am5LbkkvUzZ5NUtLK0E2VWQveE8zQ1M2WFdySmtkMkFmR3YxQm81b2YvNFMzWStBWGl5Z2lcIiArXG4gICAgICAgICAgICAgICAgXCJtRzloL1VPcVpWZ1FRZ2tRYlFkL2MxdUJFQnpuTDBudmZaY1VzVFBJMURwREM5VUtaaVVFV3NhQ1RRSURBUUFCXCIgK1xuICAgICAgICAgICAgICAgIFwiQW9HQU0zeHk3M3VRVVIrQ2pnV2N0aUw4dFBpOERBMG43ckxFbENjSlFvOEtrUjl1aWh5OFRVaythelJRazdVQVwiICtcbiAgICAgICAgICAgICAgICBcImNHRk9UK1JDMjlxLzYyZWJTdXhvaDd5K0t1Wk9iaE5UMndrcUU3Y2piQjk3SGxBZ1pyUU9mNHJZRyt2R04zbkJcIiArXG4gICAgICAgICAgICAgICAgXCJhM1pJekdxL05LK2x4bXBZN1p2QW5BNHYzeVVXVW1Tc21iRDNjNXYvTHpCU1dnRUNRUURqMVJTa0ZzMjdhblRiXCIgK1xuICAgICAgICAgICAgICAgIFwiSGZLVzJJRGJEd0wvbDJ6SFBpUmRkNHY3RFVsemhzb0tFQS9ZZ3FTTStiL2pzSjVpM0pyS21xZnRGWXZOaFFVb1wiICtcbiAgICAgICAgICAgICAgICBcIlNEY0JYeGpoQWtFQXgyd1hhTlRrbldQN3JmRisrQUdjcWg2MWxTTGt4QUJNUnFFS1UxWGJBaWhtSGQ1S1p3M0hcIiArXG4gICAgICAgICAgICAgICAgXCJWK1ZnTjRob09oT0xPeVBGNUUxbkU5cmRtNHJrRmNtNjdRSkJBTUZLZVAyUnZ5OSs3Tzh0WkMvb05NSWs1VVZWXCIgK1xuICAgICAgICAgICAgICAgIFwiQWR1ejlBUThOVTFrQTJuNDlCWS9kRUlhN0dJU1RXTnQ1NkkyU1RrVXB0MTB4eXd3NjZRMlNEeG9vdUVDUURLcVwiICtcbiAgICAgICAgICAgICAgICBcIkNZQitwZDQrcXBCVWpGZGh3WFdPKzc3NThIakRRcDJuQ0VLSHkyNU82VEtwYU9tcG5IMStMdVdzNkIzcEhUUlhcIiArXG4gICAgICAgICAgICAgICAgXCJNRTJDUksvTXFRUjlVdGtlT1RrQ1FCVjdQWVdnV3NobC92ejZwdnU0YkR0SXdMMUl4QWQ0K0lnNTBnWUhQWnRHXCIgK1xuICAgICAgICAgICAgICAgIFwid2huWmZXR2NncmFIeTZXN0dIaGZza0FCVEM5bm05RGdkWUxPNlhwZnZWUT1cIlxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBzdWJqZWN0OiBcIkM9Vk4sIFNUPUhDTSwgTD1IQ00sIE89VmluYWNvLCBPVT1WaW5hY28sIENOPVZpbmFjbyBDb3Jwb3JhdGlvblwiLFxuICAgICAgICAgICAgaXNzdWVyOiBcIkM9Vk4sIENOPVZpZXR0ZWwtQ0EsIE89aU5ldCwgT1U9aU5ldCBTb2x1dGlvbnNcIixcbiAgICAgICAgICAgIHZhbGlkRnJvbTogXCIyMDE5LTA3LTA2XCIsXG4gICAgICAgICAgICB2YWxpZFRvOiBcIjIwMzAtMDctMDdcIixcbiAgICAgICAgICAgIHNlcmlhbDogXCI5OTE4NDA5OEQ2NzQ3QUZBXCIsXG4gICAgICAgICAgICBjZXJ0OiBcIk1JSUNjekNDQWR3Q0NRQ1pHRUNZMW5SNitqQU5CZ2txaGtpRzl3MEJBUXNGQURCK01Rc3dDUVlEVlFRR0V3SldcIiArXG4gICAgICAgICAgICAgICAgXCJUakVNTUFvR0ExVUVDQXdEU0VOTk1Rd3dDZ1lEVlFRSERBTklRMDB4RHpBTkJnTlZCQW9NQmxacGJtRmpiekVQXCIgK1xuICAgICAgICAgICAgICAgIFwiTUEwR0ExVUVDd3dHVm1sdVlXTnZNUTh3RFFZRFZRUUREQVpXYVc1aFkyOHhJREFlQmdrcWhraUc5dzBCQ1FFV1wiICtcbiAgICAgICAgICAgICAgICBcIkVXbHVabTlBYVc1bGRHTnNiM1ZrTG5adU1CNFhEVEU1TURjd09EQTJNelF4TUZvWERUSXdNRGN3TnpBMk16UXhcIiArXG4gICAgICAgICAgICAgICAgXCJNRm93ZmpFTE1Ba0dBMVVFQmhNQ1ZrNHhEREFLQmdOVkJBZ01BMGhEVFRFTU1Bb0dBMVVFQnd3RFNFTk5NUTh3XCIgK1xuICAgICAgICAgICAgICAgIFwiRFFZRFZRUUtEQVpXYVc1aFkyOHhEekFOQmdOVkJBc01CbFpwYm1GamJ6RVBNQTBHQTFVRUF3d0dWbWx1WVdOdlwiICtcbiAgICAgICAgICAgICAgICBcIk1TQXdIZ1lKS29aSWh2Y05BUWtCRmhGcGJtWnZRR2x1WlhSamJHOTFaQzUyYmpDQm56QU5CZ2txaGtpRzl3MEJcIiArXG4gICAgICAgICAgICAgICAgXCJBUUVGQUFPQmpRQXdnWWtDZ1lFQTNLOEE0VEtTT0dRUWVwUjBaV1BJZGkwQUJuTFh0WUtxVWRTODRYSXZDYkNEXCIgK1xuICAgICAgICAgICAgICAgIFwiNjB2N1JqOHgvMFlwTGQ5OU1NVmZTMUIzWkJGMlhvQ2VFL3FBZzhCZHRqU2dudkhweVFYNHZ5OURSbktqNTZqSlwiICtcbiAgICAgICAgICAgICAgICBcIlRSMFBYNW5qZUczeHBUb1hqdWJ1c0I3MExWRHFEU05FUnNtQmdhNjZvQmJJRE90UWo1OGRtM0RtczRjeWZDY0NcIiArXG4gICAgICAgICAgICAgICAgXCJBd0VBQVRBTkJna3Foa2lHOXcwQkFRc0ZBQU9CZ1FEUEhRS2VjbVc2NVIxU25nMEEvSFdIQzcxVXZFR2RzaGdLXCIgK1xuICAgICAgICAgICAgICAgIFwiZk9ESWxJQ2pvMGJYM242N0V1K20rVlJGQ0tqV2FzOWJZb1BMUVJ4Mm0yRjBxa2RpaW0zaXVLWmYrMHdZdlhCa1wiICtcbiAgICAgICAgICAgICAgICBcImlEdVBwb0tHMlpxK2FBRkloN0gxcWpnUjM0SDk2ZzNmcmw4ZE41QlFLNFBGaWJycTI0bHhRdVcyT3ZWd1NPaXpcIiArXG4gICAgICAgICAgICAgICAgXCJiYXIxL2JsK2p3PT1cIixcbiAgICAgICAgICAgIHBrOiBcIk1JSUNXd0lCQUFLQmdRRGNyd0RoTXBJNFpCQjZsSFJsWThoMkxRQUdjdGUxZ3FwUjFMemhjaThKc0lQclMvdEdcIiArXG4gICAgICAgICAgICAgICAgXCJQekgvUmlrdDMzMHd4VjlMVUhka0VYWmVnSjRUK29DRHdGMjJOS0NlOGVuSkJmaS9MME5HY3FQbnFNbE5IUTlmXCIgK1xuICAgICAgICAgICAgICAgIFwibWVONGJmR2xPaGVPNXU2d0h2UXRVT29OSTBSR3lZR0JycnFnRnNnTTYxQ1BueDJiY09hemh6SjhKd0lEQVFBQlwiICtcbiAgICAgICAgICAgICAgICBcIkFvR0FLS2tKNVhRMjRyTDFJbEMxL1hSY0hBSUFqaStjdFBIRlJkeUhqSlpJT21YT2VJMEFXQm9Pc1RVUkkwV1pcIiArXG4gICAgICAgICAgICAgICAgXCJRR0l0UTZnb3gwUThaZjhXb1NHM2lnN29kUEVzd0xWcUgvY3IvMElzUTR5SU1LbHN3NUpxaXpMcTVPcGNpazYxXCIgK1xuICAgICAgICAgICAgICAgIFwiZEg2d3BMalZyTlJjdjJoL0pWdm1LZEFvNUsrS0V3WjhVTm1tRVpLNU81Y0Fzc0VDUVFEMXF1Ykk3L3k0T1d3UVwiICtcbiAgICAgICAgICAgICAgICBcIlBVWUQ5WkNvY0xXRExuMzRvQnhOOGF5Tm5McC9ONC9ENzhqaHBzREtTU1BJY1RGRlNaVmY0RnBsY0VaUzhmOTRcIiArXG4gICAgICAgICAgICAgICAgXCJmaWtGWm1LSEFrRUE1ZmNaa3dhZDB6L3c1T2FoWDBZSEZSZTN2TnQ3dXA0S0VvY1hYZ1ZFVE03OVlwNnRpTWJFXCIgK1xuICAgICAgICAgICAgICAgIFwiK2FFT3RzbEJTZkdBUGlFSW00NnRYYjlmMC9mZmlkNWhZUUpBRm0xdXVrTm1mKzhHRllseWZlUUtPOFptVzc1L1wiICtcbiAgICAgICAgICAgICAgICBcIjA1WFNYNjlEZ0g0aGJJSEhCeTA1MnBmZG05b0hnVUlNTEhZbVErVjRlekEveTB5NmRPYVhtaDJadXdKQU44MTVcIiArXG4gICAgICAgICAgICAgICAgXCJVRHNYeXk1RjUxV3JyUEhTUUNVTU9mRE1tbUZGTW0vRGxOWVVWOHNXbzNxN3cyZndYbDdkc2k4dC82SnhxeUhhXCIgK1xuICAgICAgICAgICAgICAgIFwiODl4d1owSk1INlNUZ3VJS29RSkFWL1VWWk8vOGtweGJ5Z3BSNGpseUE0Y1NyYmI3YklkOGZrNDIxQ1hpdmpjSVwiICtcbiAgICAgICAgICAgICAgICBcIkpQUlRIYVR0SmxlSmhJVHlQZjQ4Ri93d3IwZDYyRU5udUxMTHYyUWlSdz09XCJcbiAgICAgICAgfVxuICAgIF07XG5cbiAgICBzdGF0aWMgcG9zdFRvRXh0ZW5zaW9uKGFjdGlvbjogRVhUX0FDVElPTiwgZGF0YT86IGFueSk6IFByb21pc2U8UmVwbHlEYXRhPiB7XG4gICAgICAgIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICAgICAgc3dpdGNoIChhY3Rpb24pIHtcbiAgICAgICAgICAgICAgICBjYXNlIEVYVF9BQ1RJT04uR0VUX0lORk86XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoe2RhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZlcnNpb246ICcwLjAuMScsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYXRpdmVWZXJzaW9uOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmF0aXZlTGF0ZXN0VmVyc2lvbjogMSxcbiAgICAgICAgICAgICAgICAgICAgfX0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIEVYVF9BQ1RJT04uU0lHTl9IQVNIOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zaWduKGRhdGEsIHJlc29sdmUpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIEVYVF9BQ1RJT04uR0VUX0NFUlRTOlxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHtkYXRhOiB0aGlzLl9jZXJ0c30pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgIH1cblxuICAgIHN0YXRpYyBfc2lnbihkYXRhOiBNZXNzYWdlU2lnbkhhc2gsIHJlc29sdmUpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGNlcnQgPSB0aGlzLl9nZXRDZXJ0KGRhdGEuc2VyaWFsKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlOiBTaWduZWREYXRhID0ge1xuICAgICAgICAgICAgICAgIHNlcmlhbDogY2VydC5zZXJpYWwsXG4gICAgICAgICAgICAgICAgY2VydDogY2VydC5jZXJ0LFxuICAgICAgICAgICAgICAgIGhhc2hBbGc6IGRhdGEuaGFzaEFsZyB8fCBFWFRfSEFTSF9BTEcuU0hBMVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IGpzRW5jcnlwdCA9IG5ldyBKU0VuY3J5cHQobnVsbCk7XG4gICAgICAgICAgICBqc0VuY3J5cHQuc2V0UHJpdmF0ZUtleShjZXJ0LnBrKTtcblxuICAgICAgICAgICAgaWYgKGRhdGEuaGFzaHMpIHtcbiAgICAgICAgICAgICAgICByZXNwb25zZS5zaWduYXR1cmVzID0gW107XG4gICAgICAgICAgICAgICAgZGF0YS5oYXNocy5mb3JFYWNoKChoYXNoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLnNpZ25hdHVyZXMucHVzaChqc0VuY3J5cHQuc2lnbihoYXNoLCAoc3RyKSA9PiB0aGlzLl9iYXNlNjR0b0hFWChzdHIpLCBkYXRhLmhhc2hBbGcudG9Mb2NhbGVMb3dlckNhc2UoKSkpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXNwb25zZS5zaWduYXR1cmUgPSBqc0VuY3J5cHQuc2lnbihkYXRhLmhhc2gsIChzdHIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Jhc2U2NHRvSEVYKHN0cik7XG4gICAgICAgICAgICAgICAgfSwgZGF0YS5oYXNoQWxnLnRvTG9jYWxlTG93ZXJDYXNlKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzb2x2ZSg8U2lnbmVkUmVwbHlEYXRhPntcbiAgICAgICAgICAgICAgICBkYXRhOiByZXNwb25zZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJlc29sdmUoPFNpZ25lZFJlcGx5RGF0YT57XG4gICAgICAgICAgICAgICAgZXJyb3I6IFwiU0lHTl9FUlJPUlwiLFxuICAgICAgICAgICAgICAgIGVycm9yTXNnOiBlLm1lc3NhZ2VcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RhdGljIF9nZXRDZXJ0KHNlcmlhbCkge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX2NlcnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fY2VydHNbaV0uc2VyaWFsID09PSBzZXJpYWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY2VydHNbaV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX2NlcnRzWzBdO1xuICAgIH1cblxuICAgIHN0YXRpYyBfYmFzZTY0dG9IRVgoYmFzZTY0KSB7XG5cbiAgICAgICAgdmFyIHJhdyA9IGF0b2IoYmFzZTY0KTtcblxuICAgICAgICB2YXIgSEVYID0gJyc7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByYXcubGVuZ3RoOyBpKysgKSB7XG5cbiAgICAgICAgICAgIHZhciBfaGV4ID0gcmF3LmNoYXJDb2RlQXQoaSkudG9TdHJpbmcoMTYpO1xuXG4gICAgICAgICAgICBIRVggKz0gKF9oZXgubGVuZ3RoPT0yP19oZXg6JzAnK19oZXgpO1xuXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIEhFWDtcbiAgICB9XG59XG4iXX0=