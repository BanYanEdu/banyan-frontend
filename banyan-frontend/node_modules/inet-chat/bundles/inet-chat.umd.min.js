!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("inet-core"),require("rxjs"),require("moment"),require("@angular/forms"),require("ngx-autosize")):"function"==typeof define&&define.amd?define("inet-chat",["exports","@angular/core","@angular/common","inet-core","rxjs","moment","@angular/forms","ngx-autosize"],t):t((e=e||self)["inet-chat"]={},e.ng.core,e.ng.common,e.inetCore,e.rxjs,e._moment,e.ng.forms,e.ngxAutosize)}(this,(function(e,t,i,s,n,o,a,r){"use strict";var c=function(){function e(t){this.fullname="",this.usercode="",this.lastmsg=0,this.message="",this.online=!1,this.unread=0,this._indexSearch="",Object.assign(this,t),this._indexSearch=e._accent.viToEn(this.fullname.toLowerCase())+" ",this._indexSearch+=e._accent.viToEn(this.usercode.slice(0,this.usercode.indexOf("@")))}return e.prototype.isMatch=function(t){return void 0===t&&(t=""),this._indexSearch.indexOf(e._accent.viToEn(t))>-1},e._accent=new s.AccentService,e}();var l=o,p=function(){function e(e){this.date=new Date(e)}return e.prototype.formatFullYear=function(){return l(this.date).format("DD/MM/YYYY, H:mm")},e.prototype.formatYear=function(){return l(this.date).format("DD/MM/YYYY")},e.prototype.formatMonth=function(){return l(this.date).format("DD/MM, H:mm")},e.prototype.formatDate=function(){return l(this.date).format("DD/MM, H:mm")},e.prototype.formatTime=function(){return l(this.date).format("H:mm")},e.prototype.format=function(){if(!this.date.getTime())return"";var e=new Date,t=e.getFullYear()===this.date.getFullYear(),i=e.getMonth()===this.date.getMonth(),s=e.getDate()===this.date.getDate();return t&&i&&s?this.formatTime():t&&i?this.formatDate():t?this.formatMonth():this.formatYear()},e}();var d=function(){function e(t){this.isSent=!1,this.attachments=[];var i=new p(t.sent||new Date);this.message=t,this.isSent=this.message.sender===iNet.username,this.attachments=e.parseAttachments(t),this.displayText=s.HtmlUtils.formatHtmlDisplay(t.message.alert||t.message.content),this.shortTime=i.formatTime(),this.longTime=i.formatFullYear(),this.date=i.date}return e.parseAttachments=function(e){var t=[];for(var i in e.message)if(i.startsWith("uuid://")){var s=e.message[i],n=/(png|jpg|jpeg|pdf)$/i.test(s),o=/(png|jpg|jpeg|gif)$/i.test(s),a=iNet.getPUrl(n?"message/binaryinline":"message/binary")+"?uuid="+e.uuid+"&uploadID="+i;t.push({url:a,id:i,name:s,image:o,canViewInline:n})}return t},e}();var h=function(){function e(t,i){var s=this;if(this.httpService=t,this.socketService=i,this._messageSubject=new n.Subject,this._unreadSubject=new n.Subject,this.contacts=[],this.messageReceived=this._messageSubject.asObservable(),this.unreadMessageChange=this._unreadSubject.asObservable(),e._instance)return e._instance;e._instance=this,this._socketObserver=this.socketService.onMessage.subscribe((function(e){"iChat"===e.application&&(s.updateLastMessage(e.sender,e),s._messageSubject.next(new d(e)))}))}return e.prototype.destroy=function(){this._socketObserver.unsubscribe(),this._messageSubject.unsubscribe(),this._unreadSubject.unsubscribe()},e.prototype.loadFriends=function(){var e=this;return new n.Observable((function(t){e.httpService.getJSON(iNet.getPUrl("unifiedpush/list")).subscribe((function(e){t.next((e||[]).map((function(e){return new c(e)}))),t.complete()}))}))},e.prototype.loadContacts=function(e){var t=this;this.contacts.length>0?e(this.contacts):this.loadFriends().subscribe((function(i){t.contacts=i.filter((function(e){return e.usercode!==iNet.usercode})),t.updateUnreadMessage(),e(t.contacts)}),(function(){return e([])}))},e.prototype.updateUnreadMessage=function(){var e=0;this.contacts.forEach((function(t){return e+=t.unread})),this._unreadSubject.next(e)},e.prototype.getContactByUserCode=function(e,t){var i=this;"news-feed"!==e&&e!==iNet.usercode&&this.loadContacts((function(s){for(var n=0;n<s.length;n++)if(s[n].usercode===e)return t(s[n]);var o=new c({usercode:e,fullname:e,unread:1});i.contacts.unshift(o),t(o)}))},e.prototype.hasContact=function(e){for(var t=0;t<this.contacts.length;t++)if(this.contacts[t].usercode===e)return!0;return!1},e.prototype.send=function(e,t){return this.socketService.send(e,t,"iChat")},e.prototype.sendEnvelop=function(e){return this.socketService.sendEnvelop(e)},e.prototype.buildEnvelop=function(e,t,i){return i?this.socketService.buildEnvelop(e,t,"iChat",i):this.socketService.buildEnvelop(e,t,"iChat")},e.prototype.pushMessage=function(e,t){var i=this,s=this.httpService.convertToFormData(e);this.httpService.post(iNet.getPUrl("message/upload"),s).subscribe((function(s){var n=i.socketService.buildEnvelop(e.alias,e.content,"iChat");n.body.message=s.message,n.body.message.content=n.body.message.alert=e.content,n.body.uuid=s.uuid,i.socketService.sendEnvelop(n),t(n.body)}))},e.prototype.loadMessages=function(e,t){var i=this;this.httpService.postJSON(iNet.getPUrl("message/query"),e).subscribe((function(s){(s=s||{}).items=s.items||[],s.total=s.total||0,s.items.sort((function(e,t){return e.sent-t.sent})),s.items=s.items.map((function(e){return new d(e)})),i.resetUnreadMessage(e.sender),t(s)}))},e.prototype.updateLastMessage=function(e,t){var i=this;this.getContactByUserCode(e,(function(e){var s=i.contacts.indexOf(e);s>-1&&i.contacts.splice(s,1),i.contacts.unshift(e);var n=t.message.alert.split(":");if(n.length>2)if("uri_message"===n[0]&&"video_conference"===n[1])e.message='<i class="fa fa-phone pr-1" aria-hidden="true"></i> Cuộc gọi thoại';else{var o=i.revertMessageDisplay(t.message.alert)||"";"uri_message"===n[0]&&"link_preview"===n[1]&&(e.message=o)}else e.message=t.message.alert;t.sender!==iNet.usercode&&(e.unread++,i.updateUnreadMessage())}))},e.prototype.decodeBase64=function(e){return decodeURIComponent(escape(window.atob(e)))},e.prototype.resetUnreadMessage=function(e){var t=this;this.getContactByUserCode(e,(function(e){e.unread=0,t.updateUnreadMessage()}))},e.prototype.searchContacts=function(e,t){var i=this;this.loadContacts((function(s){return t(i._filterUsers(e,s))}))},e.prototype._filterUsers=function(e,t){return e?t.filter((function(t){return t.isMatch(e)})):t},e.prototype.revertMessage=function(e){var t=e.indexOf("uri_message")||0;return e.substring(t)},e.prototype.revertMessageDisplay=function(e){var t=e.indexOf("uri_message")||0;return e.substring(0,t)},e.prototype.reconnetSocket=function(){this.socketService.close()},e.prototype.checkJoinVideoCall=function(e){},e._instance=null,e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:s.HttpClientService},{type:s.WebSocketClientService}]},e}();var g=function(){function e(e,i){this.messageService=e,this.webSocketService=i,this.contactSelected=new t.EventEmitter,this.roomSelected=new t.EventEmitter,this.callTo=new t.EventEmitter,this.contacts=[],this.userInteract=!1,this.lastPage=!1,this.username=iNet.username,this.fullname=iNet.displayName,this._pageNumber=0,this._pageSize=20,this._loading=!1}return e.prototype.ngAfterViewInit=function(){var e=this;this._contactEl=$(this.contactRef.nativeElement),this._detectUserInteract(),this.searchContacts(),this._statusObserver=this.messageService.socketService.onStateChange.subscribe((function(){e.messageService.socketService.closed?e.statusText="Kết nối không thành công":e.messageService.socketService.connecting?e.statusText="Đang kết nối":e.messageService.socketService.connected&&(e.statusText="")})),this._contactEl.on("scroll",(function(t){e._loading||e.lastPage||t.target.scrollTop+t.target.clientHeight>t.target.scrollHeight-100&&e.loadContacts()}))},e.prototype.ngOnDestroy=function(){this._statusObserver&&(this._statusObserver.unsubscribe(),this._statusObserver=null)},e.prototype.selectContact=function(e){this.contactSelected.emit(e)},e.prototype.searchContacts=function(e){var t=this;void 0===e&&(e=""),(e=e.toLowerCase().trim())!==this._keyword&&(this._keyword=e,this.messageService.searchContacts(e,(function(e){t._pageNumber=0,t._loading=!1,t._contacts=e,t.contacts.length=0,t.loadContacts()})))},e.prototype.loadContacts=function(){var e=this;if(this.userInteract&&!this._loading&&this._contacts){var t=this._pageNumber*this._pageSize;this.lastPage=this._contacts&&this._contacts.length<t,this.lastPage||(this._loading=!0,this.contacts=this.contacts.concat(this._contacts.slice(t,t+this._pageSize)),this.contacts.forEach((function(t){var i=e.messageService.revertMessage(t.message)||"",s=e.messageService.revertMessageDisplay(t.message)||"",n=i.split(":");if(n.length>0)return"uri_message"!==n[0]||"video_conference..."!==n[1]&&"video_conference"!==n[1]?"uri_message"===n[0]&&"link_preview..."===n[1]?(t.message=s,t):t:(t.message='<i class="fa fa-phone pr-1" aria-hidden="true"></i> Cuộc gọi thoại',t)})),setTimeout((function(){e._loading=!1,e._pageNumber++}),300),this.selectContact(this.contacts[0]))}},e.prototype.decodeBase64=function(e){return decodeURIComponent(escape(window.atob(e)))},e.prototype._detectUserInteract=function(){var e=this;this._timer=setInterval((function(){e._contactEl.is(":visible")&&(e.userInteract=!0,e.loadContacts(),clearInterval(e._timer),e._timer=null)}),100)},e.prototype.selectRoom=function(e){this.roomSelected.emit(e)},e.prototype.callToContact=function(e){this.callTo.emit(e)},e.decorators=[{type:t.Component,args:[{selector:"message-contact-list",template:'<div  class="contact bg-white" role="button">\n    <div  class="contact-online online" >\n        <img class="contact-image" userAvatar [usercode]="username">\n    </div>\n    <div  class="contact-content">\n        <div  class="contact-name">{{fullname}}</div>\n    </div>\n    <div  style="white-space: nowrap"><i  class="message-chat__action fa fa-ellipsis-v"></i>\n    </div>\n</div>\n\n<div class="contact-list__search">\n    <search-input [placeholder]="\'Tìm kiếm ...\'" (onChanged)="searchContacts($event)"></search-input>\n    \x3c!--    <div class="text-center m-1">--\x3e\n    \x3c!--        <button (click)="selectRoom(\'company\')" type="button" class="btn btn-block btn-light">--\x3e\n    \x3c!--            <i class="fa fa-video-camera"></i> Cuộc họp công ty</button>--\x3e\n    \x3c!--    </div>--\x3e\n</div>\n<div #contactRef class="contact-list__body">\n    <div *ngFor="let contact of contacts" class="contact" role="button" (click)="selectContact(contact)">\n        <div class="contact-online" [ngClass]="{\'online\': contact.online,\'offline\': !contact.online }">\n            <img class="contact-image" userAvatar [usercode]="contact.usercode">\n        </div>\n        <div class="contact-content">\n            <div class="contact-name">{{contact.fullname || contact.usercode}}</div>\n            <div class="contact-detail" [innerHTML]="contact.message"></div>\n        </div>\n        <div *ngIf="contact.unread" class="contact-icon badge badge-danger" style="margin-right: 5px">\n            {{contact.unread}}\n        </div>\n        <div *ngIf="contact.usercode !== username" (click)="callToContact(contact)" style="white-space: nowrap"><i\n                class="message-chat__action fa fa-phone"></i></div>\n        \x3c!--        <i class="contact-icon fa fa-circle text-secondary" [ngClass]="{\'text-success\': contact.online}"></i>--\x3e\n    </div>\n</div>\n\x3c!--<ul class="chat-main">--\x3e\n\x3c!--    <li data-to="blank">--\x3e\n\x3c!--        <div class="chat-box">--\x3e\n\x3c!--            <div class="profile offline bg-size" style="background-image: url(&quot;../assets/images/contact/1.jpg&quot;); background-size: cover; background-position: center center; display: block;"><img class="bg-img" src="../assets/images/contact/1.jpg" alt="Avatar" style="display: none;"></div>--\x3e\n\x3c!--            <div class="details">--\x3e\n\x3c!--                <h5>Josephin water</h5>--\x3e\n\x3c!--                <h6>Hi, i am josephin. How are you.. ! There are many variations of passages.</h6>--\x3e\n\x3c!--            </div>--\x3e\n\x3c!--            <div class="date-status"><i class="ti-pin2"></i>--\x3e\n\x3c!--                <h6>22/10/19</h6>--\x3e\n\x3c!--                <h6 class="font-success status"> Seen</h6>--\x3e\n\x3c!--            </div>--\x3e\n\x3c!--        </div>--\x3e\n\x3c!--    </li>--\x3e\n\x3c!--    <li class="active" data-to="chating">--\x3e\n\x3c!--        <div class="chat-box">--\x3e\n\x3c!--            <div class="profile online bg-size" style="background-image: url(&quot;../assets/images/contact/2.jpg&quot;); background-size: cover; background-position: center center; display: block;"><img class="bg-img" src="../assets/images/contact/2.jpg" alt="Avatar" style="display: none;"></div>--\x3e\n\x3c!--            <div class="details">--\x3e\n\x3c!--                <h5>Jony Lynetin</h5>--\x3e\n\x3c!--                <h6>Typing................</h6>--\x3e\n\x3c!--            </div>--\x3e\n\x3c!--            <div class="date-status"><i class="ti-pin2"></i>--\x3e\n\x3c!--                <h6>30/11/19</h6>--\x3e\n\x3c!--                <div class="badge badge-primary sm">8</div>--\x3e\n\x3c!--            </div>--\x3e\n\x3c!--        </div>--\x3e\n\x3c!--    </li>--\x3e\n\x3c!--    <li data-to="blank">--\x3e\n\x3c!--        <div class="chat-box">--\x3e\n\x3c!--            <div class="profile unreachable bg-size" style="background-image: url(&quot;../assets/images/contact/3.jpg&quot;); background-size: cover; background-position: center center; display: block;"><img class="bg-img" src="../assets/images/contact/3.jpg" alt="Avatar" style="display: none;"></div>--\x3e\n\x3c!--            <div class="details">--\x3e\n\x3c!--                <h5>Sufiya Elija</h5>--\x3e\n\x3c!--                <h6>I need job, please help me.</h6>--\x3e\n\x3c!--            </div>--\x3e\n\x3c!--            <div class="date-status"><i class="ti-pin2"></i>--\x3e\n\x3c!--                <h6>15/06/19</h6>--\x3e\n\x3c!--                <h6 class="font-dark status"> Sending</h6>--\x3e\n\x3c!--            </div>--\x3e\n\x3c!--        </div>--\x3e\n\x3c!--    </li>--\x3e\n\x3c!--    <li data-to="blank">--\x3e\n\x3c!--        <div class="chat-box">--\x3e\n\x3c!--            <div class="profile busy bg-size" style="background-image: url(&quot;../assets/images/contact/4.jpg&quot;); background-size: cover; background-position: center center; display: block;"><img class="bg-img" src="../assets/images/contact/4.jpg" alt="Avatar" style="display: none;"></div>--\x3e\n\x3c!--            <div class="details">--\x3e\n\x3c!--                <h5>Mukrani Pabelo</h5>--\x3e\n\x3c!--                <h6>Hi, i am josephin. How are you.. ! There are many variations of passages.</h6>--\x3e\n\x3c!--            </div>--\x3e\n\x3c!--            <div class="date-status"><i class="ti-pin2"></i>--\x3e\n\x3c!--                <h6>04/06/19</h6>--\x3e\n\x3c!--                <h6 class="font-danger status"> Failed</h6>--\x3e\n\x3c!--            </div>--\x3e\n\x3c!--        </div>--\x3e\n\x3c!--    </li>--\x3e\n\x3c!--    <li data-to="blank">--\x3e\n\x3c!--        <div class="chat-box">--\x3e\n\x3c!--            <div class="profile busy bg-size" style="background-image: url(&quot;../assets/images/contact/2.jpg&quot;); background-size: cover; background-position: center center; display: block;"><img class="bg-img" src="../assets/images/contact/2.jpg" alt="Avatar" style="display: none;"></div>--\x3e\n\x3c!--            <div class="details">--\x3e\n\x3c!--                <h5>Jhon Deo</h5>--\x3e\n\x3c!--                <h6>Hi, i am josephin. How are you.. ! There are many variations of passages.</h6>--\x3e\n\x3c!--            </div>--\x3e\n\x3c!--            <div class="date-status"><i class="ti-pin2"></i>--\x3e\n\x3c!--                <h6>04/06/19</h6>--\x3e\n\x3c!--                <h6 class="font-danger status"> Failed</h6>--\x3e\n\x3c!--            </div>--\x3e\n\x3c!--        </div>--\x3e\n\x3c!--    </li>--\x3e\n\x3c!--    <li data-to="blank">--\x3e\n\x3c!--        <div class="chat-box">--\x3e\n\x3c!--            <div class="profile busy bg-size" style="background-image: url(&quot;../assets/images/contact/1.jpg&quot;); background-size: cover; background-position: center center; display: block;"><img class="bg-img" src="../assets/images/contact/1.jpg" alt="Avatar" style="display: none;"></div>--\x3e\n\x3c!--            <div class="details">--\x3e\n\x3c!--                <h5>Pabelo Mukrani</h5>--\x3e\n\x3c!--                <h6>Hi, i am josephin. How are you.. ! There are many variations of passages.</h6>--\x3e\n\x3c!--            </div>--\x3e\n\x3c!--            <div class="date-status"><i class="ti-pin2"></i>--\x3e\n\x3c!--                <h6>04/06/19</h6>--\x3e\n\x3c!--                <h6 class="font-danger status"> Failed</h6>--\x3e\n\x3c!--            </div>--\x3e\n\x3c!--        </div>--\x3e\n\x3c!--    </li>--\x3e\n\x3c!--</ul>--\x3e',styles:['.message-chat__action{min-width:34px;width:34px;height:34px;line-height:34px;font-size:17px;text-align:center;border-radius:50%;background:#eff7fe;color:#1c9dea;margin-left:10px;cursor:pointer}.message-chat__action:hover{background:#1c9dea;color:#fff}.subject-text,.watermark .leftwatermark{display:none!important}:host{display:block;position:relative;height:100%}.contact-list__search{position:absolute;top:50px;left:0;width:100%;height:50px;padding:10px;background:#fff;border-bottom:1px solid #d3d3d3}.contact-list__body{position:absolute;top:100px;left:0;bottom:0;width:100%;overflow:auto;background:#fff}.contact-list__body::-webkit-scrollbar{width:5px}.contact-list__body::-webkit-scrollbar-track{background:#f1f1f1}.contact-list__body::-webkit-scrollbar-thumb{background:#d6eaf7}.contact-list__body::-webkit-scrollbar-thumb:hover{background:#d6eaf7}.contact{padding:10px;cursor:pointer;display:flex;align-items:center}.contact:active,.contact:hover{background:#eff7fe}.contact:last-child{border-bottom:1px solid #ddd}.contact-image{min-width:40px;width:40px;height:40px;line-height:40px;font-size:20px;text-align:center;border-radius:50%;margin-right:10px;background:rgba(0,0,0,.1)}.contact-content{flex-grow:1;overflow:hidden;font-size:16px;line-height:20px}.contact-name{margin-bottom:2px;color:rgba(0,0,0,.7);font-weight:700;font-size:14px}.contact-detail{font-size:13px;color:rgba(0,0,0,.5);height:14px;line-height:14px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.contact-icon{font-size:9px}.contact-online.offline::before,.contact-online.online::before{content:"";position:absolute;height:13px;width:13px;border-radius:100%;border:2px solid #fff;left:44px}.contact-online.online::before{background:#28a745}.contact-online.offline::before{background:#6c757d}']}]}],e.ctorParameters=function(){return[{type:h},{type:s.WebSocketClientService}]},e.propDecorators={contactSelected:[{type:t.Output}],roomSelected:[{type:t.Output}],callTo:[{type:t.Output}],contactRef:[{type:t.ViewChild,args:["contactRef"]}]},e}();var u=function(){function e(e){this.messages=[],this.date=new Date(e),this.date.setHours(0,0,0,0),this.display=new p(this.date).formatYear()}return e.prototype.isSameDate=function(e){var t=new Date(e);return t.setHours(0,0,0,0),this.date.getTime()===t.getTime()},e}();var m=function(){function e(){this.files=[],this.removable=!0,this.onClick=new t.EventEmitter,this.onRemove=new t.EventEmitter}return e.prototype.ngOnInit=function(){this._initFileEl()},e.prototype.clickFile=function(e,t){this.onClick.emit({file:e,event:t})},e.prototype.removeFile=function(e){var t=this.files.indexOf(e);t>-1&&(this.files.splice(t,1),this.onRemove.emit(e))},e.prototype.addFiles=function(e){for(var t=0;t<e.length;t++){var i=e[t];this._fileIsImage(i)&&(i.image=!0,this._readImageBase64(i)),this.files.push(i)}},e.prototype._initFileEl=function(){var e=this;this.fileEl&&this.fileEl.addEventListener("change",(function(t){var i=e.fileEl.files;i.length>0&&(e.addFiles(i),e.fileEl.value="")}))},e.prototype._readImageBase64=function(e){var t=new FileReader;t.readAsDataURL(e),t.onload=function(){e.url=t.result}},e.prototype._fileIsImage=function(e){return e.type&&e.type.indexOf("image")>-1},e.decorators=[{type:t.Component,args:[{selector:"file-list",template:'<ng-container *ngFor="let file of files">\n    <ng-template *ngTemplateOutlet="template ? template : fileItem; context: {file: file}">\n    </ng-template>\n</ng-container>\n<ng-template #fileItem let-file="file">\n    <div class="file-item" [title]="file.name" (click)="clickFile(file, $event)">\n        <img *ngIf="file.image; else icon" [src]="file.url" class="file-item__image">\n        <ng-template #icon>\n            <img [src]="file.name | fileIcon" class="file-item__image_type">\n            <div class="file-item__name">{{file.name}}</div>\n        </ng-template>\n        <i *ngIf="removable" (click)="removeFile(file)" class="fa fa-times file-item__remove"></i>\n    </div>\n</ng-template>',styles:[":host{display:block}.file-item{display:flex;align-items:center;width:auto;height:100%;border-radius:2px;position:relative;margin-right:5px;margin-bottom:5px;overflow:hidden;padding:0 5px;cursor:pointer}.file-item__image_type{max-width:36px;max-height:36px;margin-bottom:5px;margin-top:5px;margin-right:5px}.file-item__name{font-size:12px;line-height:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.file-item__remove{position:absolute;right:3px;top:3px;cursor:pointer;width:24px;height:24px;line-height:24px;border-radius:50%;background:rgba(0,0,0,.2);color:#fff;text-align:center;font-size:12px}.file-item__remove:hover{background:rgba(0,0,0,.5)}"]}]}],e.propDecorators={fileEl:[{type:t.Input}],files:[{type:t.Input}],removable:[{type:t.Input}],template:[{type:t.Input}],onClick:[{type:t.Output}],onRemove:[{type:t.Output}]},e}();var f=function(){function e(t){return this.httpService=t,this.domain="jitsi.inetcloud.vn",this.messageJoin={app:"iChat",conferenceID:"",sender:"",joined:"",inAccess:""},e.instance=e.instance||this}return e.prototype.join=function(e,t,i,s,n){var o=this;if(void 0===i&&(i=!1),void 0===s&&(s=350),JitsiMeetExternalAPI){var a="";this.httpService.postJSON(iNet.getPUrl("conference/authorized"),{roomID:t}).subscribe((function(s){a=s.webdata||"",o.dispose();var r={roomName:t,width:"100%",height:"100%",parentNode:e,jwt:a};i&&(r.height="100%",r.configOverwrite={startAudioOnly:!0,startWithVideoMuted:!0}),o.api=new JitsiMeetExternalAPI(o.domain,r),n&&n(o.api),o.api.executeCommand("sendTones",{tones:"12345#",duration:200,pause:200})}))}},e.prototype.callTo=function(e,t,i,n,o){var a=this;void 0===i&&(i=!1),void 0===n&&(n=350);var r="";this.httpService.postJSON(iNet.getPUrl("conference/end2end"),{callTo:t}).subscribe((function(t){if(t.type!==s.ErrorMessage.TYPE&&(r=t.conferenceID||"",!iNet.isEmpty(r))){if(!JitsiMeetExternalAPI)return;var n="",c={sender:iNet.username,conferenceID:r},l="uri_message:video_conference:"+a.encodeBase64(JSON.stringify(c))||"";a.httpService.postJSON(iNet.getPUrl("conference/authorized"),{roomID:r}).subscribe((function(t){n=t.webdata||"",a.dispose();var s={roomName:r,width:"100%",height:"100%",parentNode:e,jwt:n};i&&(s.height="100%",s.configOverwrite={startAudioOnly:!0,startWithVideoMuted:!0}),a.api=new JitsiMeetExternalAPI(a.domain,s),a.messageJoin.sender=iNet.username,a.messageJoin.conferenceID=r,o&&o(a.api,l),a.api.executeCommand("sendTones",{tones:"12345#",duration:200,pause:200})}))}}))},e.prototype.getApi=function(){return this.api},e.prototype.dispose=function(){this.api&&(this.api.dispose(),delete this.api)},e.prototype.getMessageJoin=function(){return this.messageJoin},e.prototype.getRoomNameByReceiver=function(e){return iNet.username.split("@")[0]+"_"+e.split("@")[0]},e.prototype.isExistMeet=function(){return!!JitsiMeetExternalAPI},e.prototype.encodeBase64=function(e){return window.btoa(unescape(encodeURIComponent(e)))},e.instance=null,e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:s.HttpClientService}]},e}();var v=function(){function e(){this.regex=/(https?:\/\/[^\s]+)/}return e.prototype.loadPreviewLink=function(e,t){var i=this;e?this.isLink(e)?$.ajax({type:"post",url:iNet.getUrl("opengraph/fetch"),data:{url:e},success:function(s){t(i.convertOpenData(s,e))},error:function(e){t(null,e)}}):t(null,{error:"Link invalid"}):t(null,{error:"Link is empty"})},e.prototype.isLink=function(e){return this.regex.test(e)},e.prototype.loadImageInfo=function(e,t){var i=new Image;i.onload=i.onerror=function(e){var s={width:i.width,height:i.height};s.width&&s.height&&(s.available=!0,s.landscape=s.width/s.height>1.1),t(s)},i.src=e},e.prototype.convertOpenData=function(e,t){if(!(e.length<1)){var i={};return e.forEach((function(e){i[e.property]=e.content})),i.url||(i.url=t),i}},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[]},e}();var x=function(){function e(e,i,s,n){var o=this;this.openGraphService=e,this.messageService=i,this.videoService=s,this.element=n,this.audioCall=!1,this.videoCall=!1,this.closable=!1,this.onAudioCall=new t.EventEmitter,this.onVideoCall=new t.EventEmitter,this.onClose=new t.EventEmitter,this.videoPanelVisible=!1,this.linkRegex=/(https?:\/\/[^\s]+)/,this.holders=[],this.files=[],this.loading=!0,this.profile=iNet.username,this.messageJoinCall={},this._hasMoreMsg=!1,this._params={pageSize:20,pageNumber:0},this._messageObserver=this.messageService.messageReceived.subscribe((function(e){var t;e.message.sender!==iNet.username?e.message.sender===o.username?e.message.message.alert&&("uri_message"===(t=e.message.message.alert.split(":"))[0]?"video_conference"!==t[1]||iNet.isEmpty(t[2])||(o.__messageChat=JSON.parse(o.decodeBase64(t[2]))||{},"END"===o.__messageChat.action&&(1===e.message.message.joins.split(",").length?(e.displayText=o.messageMissCall(),o._sendSuccess(e)):(e.displayText=o.messageJoinedCall(e.message.message.duration),o._sendSuccess(e))),"LEFT"===o.__messageChat.action&&e.message.message.joins.split(",")[0]===iNet.username&&(1===e.message.message.joins.split(",").length?(e.displayText=o.messageMissCall(),e.message.sender=e.message.message.joins.split(",")[0],e.message.message.joins.split(",")[0]===iNet.username?e.isSent=!0:e.isSent=!1,o._sendSuccess(e)):(e.displayText=o.messageJoinedCallTo(e.message.message.duration),e.message.sender=e.message.message.joins.split(",")[0],e.message.message.joins.split(",")[0]===iNet.username?e.isSent=!0:e.isSent=!1,o._sendSuccess(e)))):o._sendSuccess(e)):(o.messageService.updateLastMessage(o.username,e.message),o.messageService.resetUnreadMessage(o.username)):"uri_message"===(t=e.message.message.alert.split(":"))[0]&&("video_conference"!==t[1]||iNet.isEmpty(t[2])||(o.__messageChat=JSON.parse(o.decodeBase64(t[2]))||{},"JOIN"===o.__messageChat.action||"LEFT"===o.__messageChat.action&&(o.videoService.dispose(),document.getElementById("meet").style.visibility="hidden",o._sendSuccess(e))))})),this.element.nativeElement.addEventListener("drop",(function(e){o.element.nativeElement.style.opacity="1",o._onDropFile(e)})),this.element.nativeElement.addEventListener("dragleave",(function(e){o.element.nativeElement.style.opacity="1"})),this.element.nativeElement.addEventListener("dragover",(function(e){o.element.nativeElement.style.opacity=".5",e.preventDefault()}))}return Object.defineProperty(e.prototype,"canSend",{get:function(){return this.files.length>0||this.message.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this.input&&this.input.nativeElement.value.trim()||""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollTop",{get:function(){return this.messageBody.nativeElement.scrollTop},set:function(e){this.messageBody.nativeElement.scrollTop=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollHeight",{get:function(){return this.messageBody.nativeElement.scrollHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollBottom",{get:function(){return this.scrollHeight-this.messageBody.nativeElement.scrollTop},set:function(e){this.scrollTop=this.scrollHeight-e},enumerable:!0,configurable:!0}),e.prototype._onDropFile=function(e){var t;if(e.preventDefault(),e.dataTransfer.items){t=[];for(var i=0;i<e.dataTransfer.items.length;i++)"file"===e.dataTransfer.items[i].kind&&t.push(e.dataTransfer.items[i].getAsFile())}else t=e.dataTransfer.files;t.length>0&&this.fileList.addFiles(t)},e.prototype.ngAfterContentChecked=function(){this._scrollNeedUpdate&&(this._lastScrollBottom=this.scrollBottom)},e.prototype.ngAfterViewChecked=function(){if(this._scrollNeedUpdate){var e=this.scrollBottom;this._scrollNeedUpdate=!1,this._lastScrollBottom!=e&&(this.scrollBottom=this._lastScrollBottom)}},e.prototype.ngOnInit=function(){var e=this;this._onLoad(),this.messageBody.nativeElement.addEventListener("scroll",(function(){return e._onBodyScroll()})),this.videoService.isExistMeet()||(this.videoPanelVisible=!1)},e.prototype._onBodyScroll=function(){var e=this.scrollBottom;this._scrollingTop=this._scrollBottom<=e,this._scrollBottom=e,!this.loading&&this._hasMoreMsg&&this._scrollingTop&&this.scrollTop<150&&this._loadMessages()},e.prototype.ngOnChanges=function(e){e.username&&!e.username.firstChange&&(this._onLoad(),this.messageJoinCall.joined=!1)},e.prototype.ngOnDestroy=function(){this._messageObserver.unsubscribe()},e.prototype.viewAttachment=function(e){window.open(e.file.url,"_blank")},e.prototype.sendMessage=function(){var e=this,t=this.message.trim(),i=this.messageService.revertMessage(t)||"",s=this.linkRegex.exec(i);s&&s.length>0?this.openGraphService.loadPreviewLink(this.message,(function(i){t=e.encodeBase64(JSON.stringify(e.convertLinks(i))),e.sendMessageSocket("uri_message:link_preview:"+t)})):this.sendMessageSocket(t)},e.prototype.sendMessageSocket=function(e){(e||this.files.length>0)&&(this.files.length>0?this._sendPush(e):this._sendSocket(e),this._clearInput())},e.prototype.convertLinks=function(e){var t={};return t.title=e.title,t.image=e.image,t.description=e.description,t.url=e.url,t.finalUrl=e.site_name.toUpperCase(),t},e.prototype._loadMessages=function(){var e=this;this.loading=!0,this._hasMoreMsg=!1,this.messageService.loadMessages(this._params,(function(t){e._addMessages(t.items),0===e._params.pageNumber&&e._scrollToBottom(),e._scrollNeedUpdate=!0,e._params.pageNumber+=1,e._hasMoreMsg=e._params.pageSize*e._params.pageNumber<t.total,setTimeout((function(){e.loading=!1,e._onBodyScroll()}),500)}))},e.prototype._focus=function(){this.input.nativeElement.focus()},e.prototype._scrollToBottom=function(){var e=this;setTimeout((function(){e.scrollTop=e.scrollHeight}),100)},e.prototype._clearInput=function(){this.files.length=0,this.input.nativeElement.value="",this._focus()},e.prototype._addMessages=function(e,t){var i=this;void 0===t&&(t=!1);var s=this.convertArrayMessage(JSON.stringify(e));s.sort((function(e,t){return t.date.getTime()-e.date.getTime()})),s.forEach((function(e){for(var s,n=0;n<i.holders.length;n++)if(i.holders[n].isSameDate(e.date)){s=i.holders[n];break}s||(s=new u(e.date),t?i.holders.push(s):i.holders.unshift(s)),t?s.messages.push(e):s.messages.unshift(e)}))},e.prototype.convertMessages=function(e){if(!iNet.isEmpty(e)){var t=this.messageService.revertMessage(e.displayText)||"",i=this.messageService.revertMessageDisplay(e.displayText)||"",s=t.split(":");if(s.length>=2){if("uri_message"===s[0]&&"video_conference"===s[1]){var n=JSON.parse(this.decodeBase64(s[2]))||{};return e.message.sender===this.username?"END"===n.action||"LEFT"===n.action&&e.message.message.joins.split(",")[0]===e.message.sender?1===e.message.message.joins.split(",").length?(e.displayText=this.messageMissCall(),e):(e.displayText=this.messageJoinedCall(e.message.message.duration),e):e:"END"===n.action?1===e.message.message.joins.split(",").length?(e.displayText=this.messageMissCall(),e):(e.displayText=this.messageJoinedCallTo(e.message.message.duration),e):this.messageJoinCall.joined?(e.displayText=this.messageJoinedCallTo(e.message.message.duration),e):(e.displayText=this.messageMissCall(),e)}if("uri_message"===s[0]&&"link_preview"===s[1]){var o=JSON.parse(this.decodeBase64(s[2]))||{};return e._openGraph=o,e.displayText=i,e}return e}return e}},e.prototype.messageMissCall=function(){return'<div class="contact d-flex my-1" role="button" style="">\n    <i class="message-chat__miss fa fa-phone ml-0"></i>\n    <div class="contact-content pl-2">\n        <div class="contact-name mb-1">Cuộc gọi bị nhỡ</div>\n        <div class="contact-detail">Gọi lại</div>\n    </div>\n</div>'},e.prototype.messageJoinedCall=function(e){return'<div class="contact d-flex my-1" role="button" style="">\n    <i class="message-chat__action fa fa-phone ml-0"></i>\n    <div class="contact-content pl-2">\n        <div class="contact-name mb-1">Cuộc gọi thoại đến</div>\n        <div class="contact-detail">'+e+" giây</div>\n    </div>\n</div>"},e.prototype.messageJoinedCallTo=function(e){return'<div class="contact d-flex my-1" role="button" style="">\n    <i class="message-chat__action fa fa-phone ml-0"></i>\n    <div class="contact-content pl-2">\n        <div class="contact-name mb-1">Cuộc gọi thoại đi</div>\n        <div class="contact-detail">'+e+" giây</div>\n    </div>\n</div>"},e.prototype.convertArrayMessage=function(e){var t=this,i=JSON.parse(e);return i.forEach((function(e){return(e=t.convertMessages(e)).date=new Date(e.date),e})),i},e.prototype.encodeBase64=function(e){return window.btoa(unescape(encodeURIComponent(e)))},e.prototype.decodeBase64=function(e){return decodeURIComponent(escape(window.atob(e)))},e.prototype._onLoad=function(){var e=this;this.disposeRoom(),this._params.sender=this.username,this._params.pageNumber=0,this._hasMoreMsg=!1,this.holders=[],this.loading=!0,this.files.length=0,this.messageService.getContactByUserCode(this.username,(function(t){return e.contact=t})),setTimeout((function(){e._loadMessages(),e._focus()}),500)},e.prototype._sendSocket=function(e){var t=this.messageService.buildEnvelop(this.username,e);this.messageService.sendEnvelop(t),this._sendSuccess(new d(t.body))},e.prototype._sendPush=function(e){var t=this,i={content:e,alert:e,application:"iChat",alias:this.username};this.files.forEach((function(e,t){i["file-"+t]=e})),this.messageService.pushMessage(i,(function(e){e&&t._sendSuccess(new d(e))}))},e.prototype._sendSuccess=function(e){this._addMessages([this.convertMessages(e)],!0),this.messageService.updateLastMessage(this.username,e.message),this.messageService.resetUnreadMessage(this.username),this._scrollToBottom()},e.prototype.joinRoom=function(e,t){var i=this;if(this.videoPanelVisible=!1,this.messageJoinCall.joined=!1,this.videoService.isExistMeet()){var s=document.querySelector("#meet");document.getElementById("meet").style.visibility="visible";var n="";n=t||this.contact.usercode,this.videoService.callTo(s,n,e,350,(function(e,t){e.addEventListener("readyToClose",(function(){if(i.videoService.dispose(),document.getElementById("meet").style.visibility="hidden",!i.messageJoinCall.joined){var e=i.messageService.buildEnvelop(i.username,t);i._sendSuccess(new d(e.body))}})),e.addEventListener("videoConferenceJoined",(function(){i.messageJoinCall=i.videoService.getMessageJoin(),i.messageJoinCall.joined=!0}))}))}else this.messageJoinCall.joined=!1},e.prototype.disposeRoom=function(){this.videoPanelVisible=!0,this.videoService.dispose()},e.decorators=[{type:t.Component,args:[{selector:"message-chat",template:'<div class="messenger-contact" *ngIf="contact">\n    <div class="messenger-contact-name">{{contact.fullname || contact.usercode}}</div>\n    <div style="white-space: nowrap">\n        <i class="message-chat__action fa fa-phone" *ngIf="audioCall && profile !== contact.usercode" (click)="joinRoom(true)"></i>\n\x3c!--        <i class="message-chat__action fa fa-video-camera" *ngIf="videoCall && profile !== contact.usercode" (click)="joinRoom(false)"></i>--\x3e\n        <i class="message-chat__action fa fa-times" *ngIf="closable" (click)="onClose.emit(contact)"></i>\n    </div>\n</div>\n<div #messageBody class="messenger-body">\n    <div class="message-video">\n        \x3c!--<div *ngIf="videoPanelVisible" class="container text-center mb-2" style="background: #000000;min-height: 200px;">--\x3e\n            \x3c!--<h5 class="text-white" style="padding: 40px;">Đang có cuộc trò chuyện</h5>--\x3e\n            \x3c!--<button class="btn btn-success" (click)="joinRoom(false)">Tham gia</button>--\x3e\n        \x3c!--</div>--\x3e\n        <div id="meet" class="container-video-meet" [ngClass]="{\'hide\': videoPanelVisible}"></div>\n    </div>\n    <div class="message-content">\n        <div *ngFor="let holder of holders">\n            <div class="messenger-date-group">{{holder.display}}</div>\n            <div *ngFor="let message of holder.messages" class="messenger-chat" [ngClass]="{\'sent\': message.isSent}" >\n                <img *ngIf="!message.isSent && message.displayText!==\'\'" class="messenger-chat-image" userAvatar [usercode]="message.message.sender">\n                <div class="messenger-chat-content" >\n                    <file-list [files]="message.attachments" [removable]="false" (onClick)="viewAttachment($event)" class="messenger-chat__file"></file-list>\n                    <app-link-preview *ngIf="message._openGraph" [openGraphData]="message._openGraph"\n                                      [removable]="false" class="social-block"></app-link-preview>\n                    <span *ngIf="!message._openGraph" [innerHTML]="message.displayText"></span>\n                    <div class="messenger-chat-time" [title]="message.longTime">{{message.shortTime}}</div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n<div class="messenger-footer">\n    <file-list #fileList fileList [fileEl]="fileEl" [files]="files"></file-list>\n    <div class="messenger-footer-inner">\n        <div class="messenger-footer-input">\n            <textarea type="text" #input autosize  (keyup.enter)="sendMessage()" placeholder="Nhập nội dung ..."></textarea>\n        </div>\n        <label class="message-chat__action fa fa-image" style="margin-bottom: 0;">\n            <input #fileEl type="file"  (change)="input.focus()" multiple style="display:none">\n        </label>\n        <i *ngIf="canSend" (click)="sendMessage()" class="messenger-footer-send message-chat__action fa fa-arrow-right" aria-hidden="true"></i>\n    </div>\n</div>\n<i *ngIf="loading" class="messenger-spinner fa fa-spinner fa-spin"></i>\n',encapsulation:t.ViewEncapsulation.None,styles:[":host{position:relative;display:block;width:100%;height:100%}.messenger-contact{top:0;left:0;width:100%;height:100px;display:flex;align-items:center;justify-content:space-between;padding:0 15px;border-bottom:1px solid #d3d3d3}.messenger-contact-name{max-height:36px;line-height:18px;overflow:hidden;color:#1c9dea;font-weight:700}.message-chat__miss{min-width:34px;width:34px;height:34px;line-height:34px;font-size:17px;text-align:center;border-radius:50%;background:red;color:#fff;margin-left:10px;cursor:pointer}.message-chat__miss:active,.message-chat__miss:hover{background:#8b1313;color:#fff}.message-chat__action{min-width:34px;width:34px;height:34px;line-height:34px;font-size:17px;text-align:center;border-radius:50%;background:#eff7fe;color:#1c9dea;margin-left:10px;cursor:pointer}.message-chat__action:active,.message-chat__action:hover{background:#1c9dea;color:#fff}.message-chat__action .sent_action{background:#046094!important}.messenger-body{background:#eff7fe;position:absolute;top:100px;bottom:65px;overflow-x:hidden;overflow-y:auto;width:100%}.messenger-body::-webkit-scrollbar{width:5px}.messenger-body::-webkit-scrollbar-track{background:#f1f1f1}.messenger-body::-webkit-scrollbar-thumb{background:#d6eaf7}.messenger-body::-webkit-scrollbar-thumb:hover{background:#d6eaf7}.message-video{display:flex;position:-webkit-sticky;position:sticky;top:0;left:0;right:0;z-index:10}.message-content{padding:15px}.messenger-date-group{width:100%;border-bottom:1px solid #ddd;margin:10px 0;padding:5px 0;text-align:center}.messenger-chat{margin-bottom:10px;overflow:hidden;display:flex}.messenger-chat.sent{flex-direction:row-reverse}.messenger-chat.sent .messenger-chat-content{background:#e5edf5;text-align:right;font-weight:700;color:#223645}.messenger-chat-image{min-width:32px;width:32px;height:32px;line-height:32px;font-size:16px;text-align:center;border-radius:50%;background:rgba(0,0,0,.1);margin-right:10px}.messenger-chat-content{background:#1c9dea;border-radius:25px;padding:7px 15px;overflow:hidden;max-width:80%;font-size:13px;line-height:1.2;word-break:break-word;font-weight:700;color:#fff}.messenger-chat-time{font-size:12px;color:#fff;margin-top:2px}.sent .messenger-chat-time{font-size:12px;color:#223645!important;margin-top:2px}.messenger-chat__file{margin-right:-5px}.messenger-chat__file /deep/ .file-item{width:76px;height:76px}.messenger-spinner{width:40px;height:40px;text-align:center;line-height:40px;position:absolute;top:50%;left:50%;font-size:40px;color:#666;margin-top:-20px;margin-left:-20px}.messenger-footer{position:absolute;left:0;bottom:0;width:100%;padding:10px 15px;background:#fff}.messenger-footer-inner{width:100%;display:flex;align-items:center}.messenger-footer-input{flex-grow:1;padding-top:6px}.messenger-footer-input textarea{border:0;outline:0;padding:10px 40px 0 10px;width:100%;font-size:14px;line-height:12px;border-radius:20px;background:#eff7fe;resize:none}.messenger-footer-send{color:#fff;background:#1c9dea}.messenger-footer-send:active,.messenger-footer-send:hover{background:#438eb9}.container-video-meet{height:100vh;width:100%}iframe{height:100vh!important}"]}]}],e.ctorParameters=function(){return[{type:v},{type:h},{type:f},{type:t.ElementRef}]},e.propDecorators={username:[{type:t.Input}],audioCall:[{type:t.Input}],videoCall:[{type:t.Input}],closable:[{type:t.Input}],onAudioCall:[{type:t.Output}],onVideoCall:[{type:t.Output}],onClose:[{type:t.Output}],input:[{type:t.ViewChild,args:["input"]}],messageBody:[{type:t.ViewChild,args:["messageBody"]}],fileList:[{type:t.ViewChild,args:["fileList"]}]},e}();var y=function(){function e(){this.placeholder="",this.keyword="",this.onSearch=new t.EventEmitter,this.onPressed=new t.EventEmitter,this.onChanged=new t.EventEmitter}return e.prototype.search=function(){this.onSearch.emit(this.keyword)},e.prototype.keyPressed=function(e){this.onPressed.emit(e),"Enter"===e.key&&this.search(),this.onChanged.emit(this.keyword)},e.prototype.clear=function(){this.keyword="",this.onChanged.emit(this.keyword)},e.decorators=[{type:t.Component,args:[{selector:"search-input",template:'<div class="search-input__container">\n  <input [(ngModel)]="keyword" (keyup)="keyPressed($event)" [placeholder]="placeholder" class="form-control form-control-sm search-input__text">\n  <i (click)="search()" class="fa fa-search search-input__icon" style="left:0"></i>\n  <i *ngIf="keyword.length" (click)="clear()" class="fa fa-times search-input__icon" style="right:0"></i>\n</div>\n',styles:[":host{display:block}.search-input__container{position:relative}.search-input__text{padding-left:30px;padding-right:30px}.search-input__icon{position:absolute;top:0;line-height:30px;width:30px;height:30px;text-align:center;color:#1c9dea;cursor:pointer}.search-input__icon:hover{color:#1c9dea}"]}]}],e.propDecorators={placeholder:[{type:t.Input}],keyword:[{type:t.Input}],onSearch:[{type:t.Output}],onPressed:[{type:t.Output}],onChanged:[{type:t.Output}]},e}();var b=function(){function e(e){var i=this;this.messageService=e,this.audioCall=!0,this.videoCall=!0,this.closable=!1,this.unreadMessageChange=new t.EventEmitter,this.chatOpen=!1,this.readyToChat=!1,this._socketSub=this.messageService.socketService.onStateChange.subscribe((function(){return i._stateChange()})),this._messageSub=this.messageService.unreadMessageChange.subscribe((function(e){return i.unreadMessageChange.emit(e)})),this._stateChange()}return e.prototype._stateChange=function(){this.readyToChat=this.messageService.socketService.connected,this.messageService.socketService.connected?this.stateMessage="":this.messageService.socketService.closed?this.stateMessage="Kết nối không thành công":this.stateMessage="Đang kết nối..."},e.prototype.ngOnDestroy=function(){this._socketSub.unsubscribe(),this._messageSub.unsubscribe()},e.prototype.openVideoCall=function(e){},e.prototype.openAudioCall=function(e){},e.prototype.openChatWith=function(e,t){var i=this;this.roomName=null,this.contact!==e&&(this.contact=e,e.unread=0),setTimeout((function(){i.chatOpen=!0,t&&(i.messageChatComponent.messageJoinCall.joined=!1,i.messageChatComponent.joinRoom(!0,e.usercode))}),100)},e.prototype.closeChat=function(){this.chatOpen=!1},e.prototype.openRoom=function(e){this.contact=null,this.roomName=e},e.prototype.callToContactSelected=function(e){this.openChatWith(e,!0)},e.decorators=[{type:t.Component,args:[{selector:"message-panel",template:'<div *ngIf="!readyToChat" class="message-panel__status">{{stateMessage}}</div>\n<div class="message-panel__container">\n  <message-contact-list class="message-panel__side" (contactSelected)="openChatWith($event)" (roomSelected)="openRoom($event)" (callTo)="callToContactSelected($event)"></message-contact-list>\n  <div class="message-panel__body" [ngClass]="{\'open\': chatOpen}">\n    <div *ngIf="!contact && !roomName" class="message-panel__welcome text-primary">\n      <div style="font-size: 151px;"><i class="fa fa-comments" aria-hidden="true"></i>\n      </div>\n      <div>Chào mừng đến với <b>Calista!</b></div>\n    </div>\n    <message-chat *ngIf="contact"\n                  [username]="contact.usercode"\n                  [audioCall]="audioCall"\n                  [videoCall]="videoCall"\n                  [closable]="closable"\n                  (onAudioCall)="openAudioCall($event)"\n                  (onVideoCall)="openVideoCall($event)"\n                  (onClose)="closeChat()"></message-chat>\n    <room-chat *ngIf="roomName" [roomName]="roomName"></room-chat>\n  </div>\n</div>\n',styles:[":host{display:flex;flex-direction:column;width:100%;height:100%;overflow:hidden;position:relative}.message-panel__status{text-align:center;width:100%;background:rgba(0,0,0,.8);color:#fff;font-size:16px;line-height:50px}.message-panel__container{width:100%;height:100%;position:relative;flex-grow:1}.message-panel__side{float:left;width:300px;background:#f1f1f4;border-right:1px solid #dedede}.message-panel__body{overflow:hidden;height:100%;position:relative;background:#fff;border-left:0}.message-panel__welcome{text-align:center;font-size:30px;position:absolute;padding:0 20px;width:100%;top:30%;margin-top:-20px}@media (max-width:768px){.message-panel__side{width:100%}.message-panel__body{position:absolute;right:0;bottom:0;left:0;width:100%;height:400px;border-left:1px;display:none}.message-panel__body.open{display:block}}"]}]}],e.ctorParameters=function(){return[{type:h}]},e.propDecorators={audioCall:[{type:t.Input}],videoCall:[{type:t.Input}],closable:[{type:t.Input}],unreadMessageChange:[{type:t.Output}],messageChatComponent:[{type:t.ViewChild,args:[x]}]},e}();var _=["unknown","text","archive","audio","video","png","jpg","gif","tiff","svg","ai","psd","dwg","avi","fla","mp2","mp3","mp4","aac","flac","wma","wav","mxf","iso","mdf","nrg","zip","7z","arj","rar","pdf","doc","rtf","txt","xls","ppt","css","csv","html","json","js","xml","dbf","exe"],w=["doc","docx","odt","ods","xls","xlsx","ppt","pps","pptm","pptx","pot","potx","dot","dotx","docm","dotx","csv","sxw"],k=["pdf","png","jpg","jpeg","gif"],C=function(){function e(){}return e.prototype.getImagePath=function(){var e=iNet.commonImageFolder,t=e.lastIndexOf("/");return t===e.length-1?e.substring(0,t):e},e.prototype.getFileFormatPath=function(){return this.getImagePath()+"/format"},e.prototype.getUrlByExt=function(e){var t=this.getFileFormatPath();return _.indexOf(e)>-1?t+"/"+e.toLowerCase()+".svg":t+"/unknown.svg"},e.prototype.getUrlByName=function(e){return this.getUrlByExt(this.getExtByName(e))},e.prototype.getExtByName=function(e){return e.split(".").pop().toLowerCase()||"unknown"},e.prototype.getEditFormats=function(){return w},e.prototype.getViewFormats=function(){return k},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[]},e}(),S=function(){function e(e){this.formatService=e}return e.prototype.transform=function(e){return this.formatService.getExtByName(e)},e.decorators=[{type:t.Pipe,args:[{name:"fileExt"}]}],e.ctorParameters=function(){return[{type:C}]},e}();var E=function(){function e(e){this.formatService=e}return e.prototype.transform=function(e){return this.formatService.getUrlByName(e)},e.decorators=[{type:t.Pipe,args:[{name:"fileIcon"}]}],e.ctorParameters=function(){return[{type:C}]},e}();var M=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[i.CommonModule],declarations:[E,S,m],exports:[E,S,m],providers:[C]}]}],e}(),I=function(){function e(e){this.videoService=e,this.videoPanelVisible=!0}return e.prototype.ngOnInit=function(){this.joinRoom()},e.prototype.ngOnDestroy=function(){this.disposeRoom()},e.prototype.joinRoom=function(){var e=this;this.videoPanelVisible=!1,this.videoService.isExistMeet()&&(this.disposeRoom(),this.videoService.join(document.querySelector("#meetRoom"),this.roomName,!1,600),this.videoService.getApi().addEventListener("readyToClose",(function(){e.disposeRoom()})))},e.prototype.disposeRoom=function(){this.videoPanelVisible=!0,this.videoService.dispose()},e.decorators=[{type:t.Component,args:[{selector:"room-chat",template:'<div class="message-video">\n    <div *ngIf="videoPanelVisible" class="container text-center mb-2" style="background: #000000;min-height: 250px;">\n        <h5 class="text-white" style="padding: 40px;">Cuộc họp công ty , ai cũng có thể tham gia</h5>\n        <button class="btn btn-success" (click)="joinRoom()">Tham gia</button>\n    </div>\n    <div id="meetRoom" style="width: 100%" [ngClass]="{\'hide\': videoPanelVisible}"></div>\n</div>\n',styles:[""]}]}],e.ctorParameters=function(){return[{type:f}]},e.propDecorators={roomName:[{type:t.Input}]},e}();var T=function(){function e(e){this.openGraphService=e,this.removable=!0,this.onLoad=new t.EventEmitter,this.onDelete=new t.EventEmitter,this._hidden=!1}return e.prototype.ngOnInit=function(){this.openGraphService.isLink(this.link)?this.loadPreview():this.openGraphData?this.loadImageInfo():this.setHidden(!0)},e.prototype.isPreview=function(){return!(this.isHidden()||!this.link&&!this.openGraphData)},e.prototype.setData=function(e){e&&e.title&&(this.openGraphData=e,this.loadImageInfo(),this.setHidden(!1))},e.prototype.getData=function(){return this.openGraphData},e.prototype.setLink=function(e){this.link!==e&&(this.link=e,this.loadPreview())},e.prototype.removePreView=function(){this.onDelete.emit(this),this.clearData()},e.prototype.getDomain=function(e){return e?(e.split("/")[2]||"").replace("www.",""):""},e.prototype.clearData=function(){this.link=null,this.openGraphData=null,this.setHidden(!0)},e.prototype.loadPreview=function(){var e=this;this.setHidden(!1),this.openGraphService.isLink(this.link)?this.openGraphService.loadPreviewLink(this.link,(function(t){t?e.setData(t):e.setHidden(!0)})):this.setHidden(!0)},e.prototype.loadImageInfo=function(){var e=this;this.openGraphData&&this.openGraphData.image&&this.openGraphService.loadImageInfo(this.openGraphData.image,(function(t){e.openGraphData.imageInfo=t}))},e.prototype.setHidden=function(e){this._hidden=e},e.prototype.isHidden=function(){return this._hidden},e.decorators=[{type:t.Component,args:[{selector:"app-link-preview",template:'<div *ngIf="!_hidden" class="link-preview">\n    <div *ngIf="!openGraphData; else preview">\n        <i class="fa fa-spinner fa-spin link-preview-spinner"></i>\n        <div class="link-preview-content">Đang tải chế độ xem trước...</div>\n    </div>\n    <ng-template #preview>\n        <div *ngIf="openGraphData?.imageInfo?.available"\n             [ngClass]="openGraphData.imageInfo.landscape ? \'landscape mb-0\' : \'portrait mb-0\'"\n             class="link-preview-image">\n            <img [src]="openGraphData.image">\n        </div>\n        <div class="link-preview-content bg-white">\n            <div class="link-preview-title">{{openGraphData.title}}</div>\n            <div class="link-preview-text">{{openGraphData.description}}</div>\n            <div class="link-preview-url">{{getDomain(openGraphData.url)}}</div>\n        </div>\n        <a [href]="openGraphData.url" target="_blank" rel="noopener nofollow" class="link-preview-anchor"></a>\n    </ng-template>\n    <i *ngIf="removable" (click)="removePreView()" class="fa fa-times link-preview-remove"></i>\n</div>',styles:[".link-preview{margin-bottom:15px;display:block;overflow:hidden;border:1px solid rgba(0,0,0,.1);position:relative;color:#555;width:300px}.link-preview-spinner{float:left;width:44px;height:44px;font-size:20px;line-height:44px;text-align:center}.link-preview-anchor{position:absolute;top:0;right:0;bottom:0;left:0;z-index:1;opacity:0;font-size:10px}.link-preview-remove{position:absolute;top:8px;right:8px;width:24px;height:24px;line-height:24px;border-radius:50%;background:rgba(0,0,0,.2);color:#fff;text-align:center;z-index:2;cursor:pointer;font-size:14px}.link-preview-remove:hover{background:rgba(0,0,0,.4)}.link-preview-image{overflow:hidden}.link-preview-image.landscape{margin-bottom:5px;border-bottom:1px solid rgba(0,0,0,.1);max-height:250px;width:330px}.link-preview-image.landscape img{width:100%;-o-object-fit:contain;object-fit:contain;height:100%}.link-preview-image.portrait{float:left;width:160px;height:160px;position:relative}.link-preview-image.portrait img{position:absolute;min-width:100%;min-height:100%;top:50%;left:50%;transform:translate3d(-50%,-50%,0)}.link-preview-content{overflow:hidden;padding:10px 30px 10px 15px}.link-preview-title{color:#333;font-size:15px;line-height:22px}.link-preview-text{overflow:hidden;margin-top:7px;font-size:10px;line-height:18px}.link-preview-url{margin-top:7px;text-transform:uppercase;font-size:12px;color:#888}"]}]}],e.ctorParameters=function(){return[{type:v}]},e.propDecorators={link:[{type:t.Input}],openGraphData:[{type:t.Input}],removable:[{type:t.Input}],onLoad:[{type:t.Output}],onDelete:[{type:t.Output}]},e}();var j=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[i.CommonModule],exports:[T],declarations:[T],providers:[v]}]}],e}(),D=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[i.CommonModule,a.FormsModule,s.CoreModule,r.AutosizeModule,M,j],exports:[x,g,y,b],declarations:[x,g,y,b,I],providers:[s.AccentService,h,f,s.WebSocketClientService]}]}],e}();e.ChatMessageModule=D,e.ChatMessageService=h,e.ContactListComponent=g,e.DateFormatter=p,e.MessageChatComponent=x,e.MessagePanelComponent=b,e.RoomChatComponent=I,e.VideoConferenceService=f,e.ɵa=M,e.ɵb=E,e.ɵc=C,e.ɵd=S,e.ɵe=m,e.ɵf=j,e.ɵg=T,e.ɵh=v,e.ɵi=y,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=inet-chat.umd.min.js.map